#!/bin/bash

# üöÄ –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–û–ï –†–ï–®–ï–ù–ò–ï: –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ Django –±–µ–∑ nginx

echo "üöÄ –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–û–ï –†–ï–®–ï–ù–ò–ï: –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ Django"
echo "=================================================="
echo ""
echo "üí° –ï—Å–ª–∏ nginx –Ω–µ —É–¥–∞–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Django –Ω–∞–ø—Ä—è–º—É—é"
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Django —Å–µ—Ä–≤–µ—Ä–∞
echo "1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Django —Å–µ—Ä–≤–µ—Ä–∞..."
if curl -s http://localhost:8000/ 2>/dev/null | grep -q "–¶–µ–Ω—Ç—Ä —Å–æ–æ–±—â–µ—Å—Ç–≤"; then
    echo "‚úÖ Django —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 8000"
else
    echo "‚ùå Django —Å–µ—Ä–≤–µ—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º..."
    pkill -f "python.*manage\.py.*runserver" 2>/dev/null
    sleep 2
    source venv/bin/activate && python manage.py runserver 0.0.0.0:8000 > django.log 2>&1 &
    sleep 5
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–¥–∂–µ—Ç–∞
echo ""
echo "2. –ü—Ä–æ–≤–µ—Ä–∫–∞ AI –≤–∏–¥–∂–µ—Ç–∞ –∏ API..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ AI API
if curl -s -X POST "http://localhost:8000/api/v1/ai/simplified/interactive/chat/" \
    -H "Content-Type: application/json" \
    -d '{"message": "–ü—Ä–∏–≤–µ—Ç", "user_email": "test@fan-club.kz", "state_id": null}' 2>/dev/null | grep -q "AI\|–ü—Ä–∏–≤–µ—Ç\|–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ\|–î–æ–±—Ä–æ"; then
    echo "‚úÖ AI API —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ http://localhost:8000"
    api_works=true
else
    echo "‚ùå AI API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ http://localhost:8000"
    api_works=false
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–¥–∂–µ—Ç–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
if curl -s http://localhost:8000/ 2>/dev/null | grep -q "ai-chat-widget\|AI.*–≤–∏–¥–∂–µ—Ç\|—á–∞—Ç.*–±–æ—Ç"; then
    echo "‚úÖ AI –≤–∏–¥–∂–µ—Ç –Ω–∞–π–¥–µ–Ω –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ"
    widget_found=true
else
    echo "‚ùå AI –≤–∏–¥–∂–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ"
    widget_found=false
fi

echo ""
echo "3. –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –î–û–°–¢–£–ü–ï:"
echo "========================="
echo "üåê –°–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8000"
echo "Ï±ó AI –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç: http://localhost:8000/working-ai-widget/"
echo "üîß Django admin: http://localhost:8000/admin/"
echo "üë• –ö–ª—É–±—ã: http://localhost:8000/clubs/"
echo ""

if [ $api_works = true ]; then
    echo "‚úÖ AI API —Ä–∞–±–æ—Ç–∞–µ—Ç: http://localhost:8000/api/v1/ai/simplified/interactive/chat/"
else
    echo "‚ùå AI API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
fi

echo ""
echo "4. –ï–°–õ–ò –ù–£–ñ–ï–ù –î–û–°–¢–£–ü –ò–ó –ò–ù–¢–ï–†–ù–ï–¢–ê:"
echo "===================================="
echo "üí° –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å nginx"
echo ""
echo "üìã –í–ê–ñ–ù–´–ï –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ù–ê–°–¢–†–û–ô–ö–ò NGINX:"
echo "======================================"
echo "sudo cp /var/www/myapp/eventsite/nginx_simple_working_config /etc/nginx/sites-available/fan-club.kz"
echo "sudo nginx -t"
echo "sudo systemctl reload nginx"
echo ""

echo "5. –ü–†–û–í–ï–†–ö–ê –í–ò–î–ñ–ï–¢–ê:"
echo "===================="
echo "üí° –ß—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∏–¥–∂–µ—Ç:"
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:8000"
echo "2. –ù–∞–π–¥–∏—Ç–µ –∫–Ω–æ–ø–∫—É AI –≤–∏–¥–∂–µ—Ç–∞ (–æ–±—ã—á–Ω–æ –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É)"
echo "3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ª–∏ —á–∞—Ç"
echo ""

echo "6. –ï–°–õ–ò –í–ò–î–ñ–ï–¢ –ù–ï –û–¢–ö–†–´–í–ê–ï–¢–°–Ø:"
echo "================================"
echo "üîç –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:"
echo "- JavaScript –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è"
echo "- –ü—Ä–æ–±–ª–µ–º—ã —Å CSS —Å—Ç–∏–ª—è–º–∏"
echo "- –û—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞"
echo ""
echo "üõ†Ô∏è –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:"
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (F12)"
echo "2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏ JavaScript"
echo "3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ª–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã"
echo "4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ AI API –ø–æ –∞–¥—Ä–µ—Å—É:"
echo "   http://localhost:8000/api/v1/ai/simplified/interactive/chat/"
echo ""

echo "7. –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï AI API –í–†–£–ß–ù–£–Æ:"
echo "================================="
echo "curl -X POST 'http://localhost:8000/api/v1/ai/simplified/interactive/chat/' \\"
echo "  -H 'Content-Type: application/json' \\"
echo "  -d '{\"message\": \"–°–æ–∑–¥–∞—Ç—å –∫–ª—É–±\", \"user_email\": \"test@fan-club.kz\", \"state_id\": null}'"
echo ""

echo "üéØ –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–°:"
echo "=================="
echo "Django —Å–µ—Ä–≤–µ—Ä: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 8000"
echo "AI API: $([ $api_works = true ] && echo '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç' || echo '‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç')"
echo "AI –≤–∏–¥–∂–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: $([ $widget_found = true ] && echo '‚úÖ –ù–∞–π–¥–µ–Ω' || echo '‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω')"
echo ""

echo "üèÅ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:"
echo "================"
echo "1. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8000"
echo "2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –≤–∏–¥–µ–Ω –ª–∏ AI –≤–∏–¥–∂–µ—Ç"
echo "3. –ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞"
echo "4. –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ nginx –∫–æ–º–∞–Ω–¥–∞–º–∏ –≤—ã—à–µ"