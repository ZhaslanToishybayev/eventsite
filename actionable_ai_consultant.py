#!/usr/bin/env python3
"""
ü§ñ –†–ê–°–ü–ò–°–ê–ù–ù–´–ô AI –ê–ì–ï–ù–¢ –° –§–£–ù–ö–¶–ò–Ø–ú–ò –î–õ–Ø –°–û–ó–î–ê–ù–ò–Ø –ö–õ–£–ë–û–í
"""

import os
import sys
import json
import re
from datetime import datetime
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ Django –ø—Ä–æ–µ–∫—Ç—É
sys.path.append(str(Path(__file__).parent))
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'core.settings')

import django
django.setup()

from clubs.models import Club, ClubCategory, City, ClubEvent
from accounts.models import User
from django.contrib.auth import get_user_model
import openai
from dotenv import load_dotenv

User = get_user_model()
load_dotenv()

class ActionableAIConsultant:
    def __init__(self):
        self.client = openai.OpenAI(api_key=os.getenv('OPENAI_API_KEY'))
        self.model = "gpt-4o-mini"
        self.conversation_history = []

    def extract_club_info(self, message):
        """–ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª—É–±–µ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        club_info = {
            'name': None,
            'description': None,
            'category': None,
            'city': None,
            'email': None,
            'phone': None,
            'address': None,
            'activities': None,
            'target_audience': None,
            'skills_developed': None,
            'tags': None
        }

        # –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        patterns = {
            'name': r'(?:–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª—É–±–∞|–ù–∞–∑–≤–∞–Ω–∏–µ)[:Ôºö]\s*"?([^"\n]+)"?',
            'description': r'(?:–û–ø–∏—Å–∞–Ω–∏–µ –∫–ª—É–±–∞|–û–ø–∏—Å–∞–Ω–∏–µ)[:Ôºö]\s*(.+?)(?=\n(?:–ö–∞—Ç–µ–≥–æ—Ä–∏—è|–ì–æ—Ä–æ–¥|Email|$))',
            'category': r'–ö–∞—Ç–µ–≥–æ—Ä–∏—è[:Ôºö]\s*([^"\n]+)',
            'city': r'–ì–æ—Ä–æ–¥[:Ôºö]\s*([^"\n]+)',
            'email': r'(?:Email –∫–ª—É–±–∞|Email)[:Ôºö]\s*([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})',
            'phone': r'–¢–µ–ª–µ—Ñ–æ–Ω[:Ôºö]\s*([+]?[0-9\s\-\(\)]{7,})',
            'address': r'–ê–¥—Ä–µ—Å[:Ôºö]\s*([^"\n]+)',
            'activities': r'(?:–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è|–î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å)[:Ôºö]\s*([^"\n]+)',
            'target_audience': r'–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è[:Ôºö]\s*([^"\n]+)',
            'skills_developed': r'–ù–∞–≤—ã–∫–∏[:Ôºö]\s*([^"\n]+)',
            'tags': r'–¢–µ–≥–∏[:Ôºö]\s*([^"\n]+)'
        }

        for field, pattern in patterns.items():
            match = re.search(pattern, message, re.IGNORECASE | re.MULTILINE)
            if match:
                club_info[field] = match.group(1).strip()

        return club_info

    def create_club_in_database(self, club_info, user_email=None):
        """–°–æ–∑–¥–∞–µ–º –∫–ª—É–± –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"""
        try:
            # –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            user = None
            if user_email:
                user = User.objects.filter(email=user_email).first()

            # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ email, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            if not user:
                user = User.objects.filter(is_staff=True).first()

            # –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ
            if not user:
                user = User.objects.create_user(
                    phone='+77010000001',
                    email='ai.system@fan-club.kz',
                    first_name='AI',
                    last_name='System'
                )
                user.is_staff = True
                user.save()

            # –ù–∞—Ö–æ–¥–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            if club_info.get('category'):
                category, created = ClubCategory.objects.get_or_create(
                    name=club_info['category']
                )
            else:
                category = ClubCategory.objects.first()

            # –ù–∞—Ö–æ–¥–∏–º –≥–æ—Ä–æ–¥
            if club_info.get('city'):
                city, created = City.objects.get_or_create(
                    name=club_info['city']
                )
            else:
                city = City.objects.first()

            # –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
            import uuid
            club_id = str(uuid.uuid4()).replace('-', '')[:32]

            # –°–æ–∑–¥–∞–µ–º –∫–ª—É–± —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏
            club = Club.objects.create(
                id=club_id,
                name=club_info['name'],
                description=club_info.get('description', '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'),
                email=club_info.get('email', f"{club_id[:8]}@fan-club.kz"),
                phone=club_info.get('phone', '+77010000001'),
                address=club_info.get('address', '–ê–ª–º–∞—Ç—ã, —Ü–µ–Ω—Ç—Ä –≥–æ—Ä–æ–¥–∞'),
                category=category,
                city=city,
                creater=user,
                activities=club_info.get('activities', '–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏ –∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è'),
                target_audience=club_info.get('target_audience', '–í—Å–µ –∂–µ–ª–∞—é—â–∏–µ'),
                skills_developed=club_info.get('skills_developed', '–†–∞–∑–≤–∏—Ç–∏–µ –Ω–∞–≤—ã–∫–æ–≤'),
                tags=club_info.get('tags', '–∫–ª—É–±, —Å–æ–æ–±—â–µ—Å—Ç–≤–æ'),
                is_active=True,
                is_private=False,
                members_count=0,
                likes_count=0,
                partners_count=0,
                recommendation_score=0,
                whatsapp_group_link='',
                is_featured=False
            )

            # –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–∑–¥–∞—Ç–µ–ª—è –∫–∞–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
            club.managers.add(user)

            return {
                "success": True,
                "club_id": str(club.id),
                "name": club.name,
                "city": club.city.name if club.city else '–ì–æ—Ä–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω',
                "category": club.category.name,
                "email": club.email,
                "phone": club.phone,
                "address": club.address
            }

        except Exception as e:
            return {
                "success": False,
                "error": str(e)
            }

    def get_club_creation_template(self):
        """–®–∞–±–ª–æ–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—É–±–∞"""
        return """üéØ –û—Ç–ª–∏—á–Ω–æ! –Ø –ø–æ–º–æ–≥—É —Ç–µ–±–µ —Å–æ–∑–¥–∞—Ç—å –∫–ª—É–±!

–î–ª—è –Ω–∞—á–∞–ª–∞, –∑–∞–ø–æ–ª–Ω–∏ —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:

**üìù –§–û–†–ú–ê –î–õ–Ø –°–û–ó–î–ê–ù–ò–Ø –ö–õ–£–ë–ê:**

–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª—É–±–∞: [–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ]
–û–ø–∏—Å–∞–Ω–∏–µ –∫–ª—É–±–∞ (200+ —Å–∏–º–≤–æ–ª–æ–≤): [–í–≤–µ–¥–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ]
–ö–∞—Ç–µ–≥–æ—Ä–∏—è: [–ú—É–∑—ã–∫–∞, –°–ø–æ—Ä—Ç, –ò–≥—Ä—ã, –ö–∏–Ω–æ, –ö–Ω–∏–≥–∏ –∏ —Ç.–¥.]
–ì–æ—Ä–æ–¥: [–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥]
Email –∫–ª—É–±–∞: [email@domain.com]
–¢–µ–ª–µ—Ñ–æ–Ω: [–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞]
–ê–¥—Ä–µ—Å: [–§–∏–∑–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å]
–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è: [–ß–µ–º –±—É–¥–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –∫–ª—É–±]
–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: [–ö—Ç–æ –≤–∞—à–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∏]
–ù–∞–≤—ã–∫–∏: [–ö–∞–∫–∏–µ –Ω–∞–≤—ã–∫–∏ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç–µ]
–¢–µ–≥–∏: [–∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é]

**üí° –ü—Ä–∏–º–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è:**
–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª—É–±–∞: –®–∞—Ö–º–∞—Ç–Ω–∞—è –ê–∫–∞–¥–µ–º–∏—è "–ì–∞–º–±–∏—Ç –ü—Ä–æ"
–û–ø–∏—Å–∞–Ω–∏–µ –∫–ª—É–±–∞: –ú–µ—Å—Ç–æ, –≥–¥–µ –ª—é–±–∏—Ç–µ–ª–∏ —à–∞—Ö–º–∞—Ç –º–æ–≥—É—Ç —Ä–∞–∑–≤–∏—Ç—å –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ...
–ö–∞—Ç–µ–≥–æ—Ä–∏—è: –•–æ–±–±–∏
–ì–æ—Ä–æ–¥: –ê–ª–º–∞—Ç—ã
Email –∫–ª—É–±–∞: gambitpro.club@gmail.com
–¢–µ–ª–µ—Ñ–æ–Ω: +7 (701) 123-45-67
–ê–¥—Ä–µ—Å: –ê–ª–º–∞—Ç—ã, –ø—Ä–æ—Å–ø–µ–∫—Ç –ê–±–∞—è 89
–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è: –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, —Ç—É—Ä–Ω–∏—Ä—ã, –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã
–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: 16-45 –ª–µ—Ç, –ª—é–±–∏—Ç–µ–ª–∏ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∏–≥—Ä
–ù–∞–≤—ã–∫–∏: –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ, –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
–¢–µ–≥–∏: —à–∞—Ö–º–∞—Ç—ã, —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç, –ê–ª–º–∞—Ç—ã

–ó–∞–ø–æ–ª–Ω–∏ —Ñ–æ—Ä–º—É –∏ –æ—Ç–ø—Ä–∞–≤—å –º–Ω–µ - —è —Å–æ–∑–¥–∞–º —Ç–≤–æ–π –∫–ª—É–±! üöÄ"""

    def handle_club_creation(self, message, user_email=None):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—É–±–∞"""
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª—É–±–µ
        club_info = self.extract_club_info(message)

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –µ—Å—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
        if not club_info.get('name'):
            return self.get_club_creation_template()

        if not club_info.get('description'):
            return """‚ùå –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—É–±–∞ –Ω—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ.

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–ª—É–±–∞ (–º–∏–Ω–∏–º—É–º 200 —Å–∏–º–≤–æ–ª–æ–≤).

–ü—Ä–∏–º–µ—Ä:
–û–ø–∏—Å–∞–Ω–∏–µ –∫–ª—É–±–∞: –ú–µ—Å—Ç–æ, –≥–¥–µ –ª—é–±–∏—Ç–µ–ª–∏ —à–∞—Ö–º–∞—Ç –º–æ–≥—É—Ç —Ä–∞–∑–≤–∏—Ç—å —Å–≤–æ—ë –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ, –Ω–∞–π—Ç–∏ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤ –∏ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö..."""

        # –°–æ–∑–¥–∞–µ–º –∫–ª—É–±
        result = self.create_club_in_database(club_info, user_email)

        if result["success"]:
            return f"""üéâ –ü–û–ó–î–†–ê–í–õ–Ø–Æ! –¢–≤–æ–π –∫–ª—É–± —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!

**üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª—É–±–µ:**
‚Ä¢ –ù–∞–∑–≤–∞–Ω–∏–µ: {result["name"]}
‚Ä¢ ID –∫–ª—É–±–∞: {result["club_id"]}
‚Ä¢ –°—Ç–∞—Ç—É—Å: ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω
‚Ä¢ –£—á–∞—Å—Ç–Ω–∏–∫–∏: 0
‚Ä¢ –õ–∞–π–∫–∏: 0

**üîß –ß—Ç–æ –¥–∞–ª—å—à–µ:**
1. **–ó–∞–π–¥–∏ –≤ –∞–¥–º–∏–Ω–∫—É**: –ü–µ—Ä–µ–π–¥–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∏ –Ω–∞–π–¥–∏ —Å–≤–æ–π –∫–ª—É–±
2. **–î–æ–±–∞–≤—å —Ñ–æ—Ç–æ**: –ó–∞–≥—Ä—É–∑–∏ –ª–æ–≥–æ—Ç–∏–ø –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∫–ª—É–±–∞
3. **–°–æ–∑–¥–∞–π –ø–µ—Ä–≤–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ**: –û—Ä–≥–∞–Ω–∏–∑—É–π –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
4. **–†–∞—Å—Å–∫–∞–∂–∏ –¥—Ä—É–∑—å—è–º**: –ü—Ä–∏–≥–ª–∞—Å–∏ –ø–µ—Ä–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
5. **–ù–∞—Å—Ç—Ä–æ–π —Å–æ—Ü—Å–µ—Ç–∏**: –°–æ–∑–¥–∞–π –≥—Ä—É–ø–ø—ã –≤ Telegram, Instagram

**üì± –¢–≤–æ–π –∫–ª—É–± —Ç–µ–ø–µ—Ä—å –Ω–∞ fan-club.kz!**
–°—Å—ã–ª–∫–∞: https://fan-club.kz/clubs/{result["club_id"]}

–•–æ—á–µ—à—å, –ø–æ–º–æ–≥—É —Å –ø–µ—Ä–≤—ã–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ–º –∏–ª–∏ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ–º –∫–ª—É–±–∞? üòä"""
        else:
            return f"""‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–ª—É–±–∞: {result["error"]}

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑ –∏–ª–∏ —Å–≤—è–∂–∏—Å—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º."""

    def handle_event_creation(self, message, user_email=None):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è"""
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏
        event_info = self.extract_event_info(message)

        if not event_info.get('name'):
            return """üìÖ –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, –∑–∞–ø–æ–ª–Ω–∏ —ç—Ç—É —Ñ–æ—Ä–º—É:

**üìù –§–û–†–ú–ê –î–õ–Ø –°–û–ó–î–ê–ù–ò–Ø –ú–ï–†–û–ü–†–ò–Ø–¢–ò–Ø:**

–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è: [–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ]
–û–ø–∏—Å–∞–Ω–∏–µ: [–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ]
–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è: [–ì–ì–ì–ì-–ú–ú-–î–î –ß–ß:–ú–ú]
–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è: [–ê–¥—Ä–µ—Å]
–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä: [–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª—É–±–∞ –∏–ª–∏ –∏–º—è]
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: [—á–∏—Å–ª–æ]
–°—Ç–æ–∏–º–æ—Å—Ç—å —É—á–∞—Å—Ç–∏—è: [–±–µ—Å–ø–ª–∞—Ç–Ω–æ/—Ü–µ–Ω–∞]
–ö–æ–Ω—Ç–∞–∫—Ç—ã: [—Ç–µ–ª–µ—Ñ–æ–Ω/email]

**üí° –ü—Ä–∏–º–µ—Ä:**
–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è: –¢—É—Ä–Ω–∏—Ä –ø–æ –±—ã—Å—Ç—Ä—ã–º —à–∞—Ö–º–∞—Ç–∞–º
–û–ø–∏—Å–∞–Ω–∏–µ: –û—Ç–∫—Ä—ã—Ç—ã–π —Ç—É—Ä–Ω–∏—Ä –¥–ª—è –≤—Å–µ—Ö –∂–µ–ª–∞—é—â–∏—Ö, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —É—Ä–æ–≤–Ω—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏
–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è: 2025-12-15 15:00
–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è: –ê–ª–º–∞—Ç—ã, –ø—Ä–æ—Å–ø–µ–∫—Ç –ê–±–∞—è 89
–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä: –®–∞—Ö–º–∞—Ç–Ω–∞—è –ê–∫–∞–¥–µ–º–∏—è "–ì–∞–º–±–∏—Ç –ü—Ä–æ"
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: 30
–°—Ç–æ–∏–º–æ—Å—Ç—å —É—á–∞—Å—Ç–∏—è: 3000 —Ç–µ–Ω–≥–µ
–ö–æ–Ω—Ç–∞–∫—Ç—ã: +7 (701) 123-45-67

–ó–∞–ø–æ–ª–Ω–∏ —Ñ–æ—Ä–º—É –∏ –æ—Ç–ø—Ä–∞–≤—å –º–Ω–µ! üöÄ"""

        # –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è (–≤—Ä–µ–º–µ–Ω–Ω–æ)
        return f"""‚úÖ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ "{event_info['name']}" –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ!

**üìã –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:**
1. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ**: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä–∏—Ç –∏ –æ–¥–æ–±—Ä–∏—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
2. **–†–∞–∑–º–µ—â–µ–Ω–∏–µ**: –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ –∫–ª—É–±–∞
3. **–†–∞—Å—Å—ã–ª–∫–∞**: –£—á–∞—Å—Ç–Ω–∏–∫–∏ –ø–æ–ª—É—á–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
4. **–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ**: –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –±—É–¥–µ—Ç —Ä–∞–∑–º–µ—â–µ–Ω–æ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö

**üí° –°–æ–≤–µ—Ç—ã –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è:**
‚Ä¢ –ù–∞—á–Ω–∏ —Å –Ω–µ–±–æ–ª—å—à–æ–≥–æ —á–∏—Å–ª–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (10-15 —á–µ–ª–æ–≤–µ–∫)
‚Ä¢ –ü–æ–¥–≥–æ—Ç–æ–≤—å –≤—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∑–∞—Ä–∞–Ω–µ–µ
‚Ä¢ –°–¥–µ–ª–∞–π –∞–Ω–æ–Ω—Å –∑–∞ –Ω–µ–¥–µ–ª—é –¥–æ —Å–æ–±—ã—Ç–∏—è
‚Ä¢ –°–æ–∑–¥–∞–π –≥—Ä—É–ø–ø—É –≤ Telegram –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è

–•–æ—á–µ—à—å, –ø–æ–º–æ–≥—É —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –ø–ª–∞–Ω–æ–º –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è? üòä"""

    def extract_event_info(self, message):
        """–ò–∑–≤–ª–µ–∫–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏"""
        event_info = {}
        patterns = {
            'name': r'–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è[:Ôºö]\s*"?([^"\n]+)"?',
            'description': r'–û–ø–∏—Å–∞–Ω–∏–µ[:Ôºö]\s*(.+?)(?=\n(?:–î–∞—Ç–∞|–ú–µ—Å—Ç–æ|–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä|$))',
            'date': r'–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è[:Ôºö]\s*([^"\n]+)',
            'location': r'–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è[:Ôºö]\s*([^"\n]+)',
            'organizer': r'–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä[:Ôºö]\s*([^"\n]+)',
            'participants': r'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤[:Ôºö]\s*([^"\n]+)',
            'cost': r'–°—Ç–æ–∏–º–æ—Å—Ç—å —É—á–∞—Å—Ç–∏—è[:Ôºö]\s*([^"\n]+)',
            'contacts': r'–ö–æ–Ω—Ç–∞–∫—Ç—ã[:Ôºö]\s*([^"\n]+)'
        }

        for field, pattern in patterns.items():
            match = re.search(pattern, message, re.IGNORECASE)
            if match:
                event_info[field] = match.group(1).strip()

        return event_info

    def get_club_management_options(self):
        """–û–ø—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª—É–±–æ–º"""
        return """üõ†Ô∏è **–í–û–ó–ú–û–ñ–ù–û–°–¢–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ö–õ–£–ë–û–ú:**

**üìã –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
1. **üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª—É–±–∞** - –ü–æ—Å–º–æ—Ç—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —Ä–æ—Å—Ç
2. **üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏** - –î–æ–±–∞–≤–ª—è–π/—É–¥–∞–ª—è–π —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
3. **üìÖ –°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ** - –û—Ä–≥–∞–Ω–∏–∑—É–π –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ
4. **üì¢ –†–∞—Å—Å—ã–ª–∫–∞** - –û—Ç–ø—Ä–∞–≤—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º
5. **üí∞ –§–∏–Ω–∞–Ω—Å—ã** - –£–ø—Ä–∞–≤–ª—è–π –±—é–¥–∂–µ—Ç–æ–º –∏ –≤–∑–Ω–æ—Å–∞–º–∏
6. **üé® –î–∏–∑–∞–π–Ω** - –ò–∑–º–µ–Ω–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∏ –ª–æ–≥–æ—Ç–∏–ø
7. **üîç –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ** - –ó–∞–ø—É—Å—Ç–∏ —Ä–µ–∫–ª–∞–º–Ω—É—é –∫–∞–º–ø–∞–Ω–∏—é

**üöÄ –ß—Ç–æ —Ö–æ—á–µ—à—å —Å–¥–µ–ª–∞—Ç—å?**
–ù–∞–ø–∏—à–∏:
‚Ä¢ "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–æ–µ–≥–æ –∫–ª—É–±–∞"
‚Ä¢ "–°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ"
‚Ä¢ "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏"
‚Ä¢ "–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –∫–ª—É–±–∞"
‚Ä¢ "–§–∏–Ω–∞–Ω—Å—ã –∏ –≤–∑–Ω–æ—Å—ã"

–ò–ª–∏ –≤—ã–±–µ—Ä–∏ –∏–∑ –º–µ–Ω—é –≤—ã—à–µ! üòä"""

    def get_monetization_options(self):
        """–û–ø—Ü–∏–∏ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏"""
        return """üí∞ **–°–ü–û–°–û–ë–´ –ó–ê–†–ê–ë–û–¢–ö–ê –ù–ê –ö–õ–£–ë–ï:**

**üéØ –ü—Ä—è–º—ã–µ –¥–æ—Ö–æ–¥—ã:**
1. **–ß–ª–µ–Ω—Å–∫–∏–µ –≤–∑–Ω–æ—Å—ã** - 1000-5000 —Ç–µ–Ω–≥–µ/–º–µ—Å—è—Ü
2. **–ü–ª–∞—Ç–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è** - –¢—É—Ä–Ω–∏—Ä—ã, –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã
3. **–û–±—É—á–µ–Ω–∏–µ** - –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∏ –≥—Ä—É–ø–ø–æ–≤—ã–µ –∑–∞–Ω—è—Ç–∏—è
4. **–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏** - –ü–ª–∞—Ç–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

**üìà –ö–æ—Å–≤–µ–Ω–Ω—ã–µ –¥–æ—Ö–æ–¥—ã:**
5. **–ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ** - –°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ —Å –±—Ä–µ–Ω–¥–∞–º–∏
6. **–†–µ–∫–ª–∞–º–∞** - –†–∞–∑–º–µ—â–µ–Ω–∏–µ —Ä–µ–∫–ª–∞–º—ã –≤ –∫–ª—É–±–µ
7. **–ú–µ—Ä—á** - –ü—Ä–æ–¥–∞–∂–∞ –∞—Ç—Ä–∏–±—É—Ç–∏–∫–∏
8. **–ì—Ä–∞–Ω—Ç—ã** - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–æ–Ω—Å–æ—Ä—Å–∫–æ–π –ø–æ–º–æ—â–∏

**üí° –¢–û–ü-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:**
‚Ä¢ **"–ü—Ä–µ–º–∏—É–º-–¥–æ—Å—Ç—É–ø"** - –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –∑–∞ –¥–µ–Ω—å–≥–∏
‚Ä¢ **"–ö–æ—É—á–∏–Ω–≥"** - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
‚Ä¢ **"–û–±—É—á–µ–Ω–∏–µ"** - –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫—É—Ä—Å—ã
‚Ä¢ **"–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è"** - –ü–ª–∞—Ç–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä—ã –∏ –≤–æ—Ä–∫—à–æ–ø—ã
‚Ä¢ **"–ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ"** - –°–ø–æ–Ω—Å–æ—Ä—Å—Ç–≤–æ –æ—Ç –º–µ—Å—Ç–Ω—ã—Ö –±–∏–∑–Ω–µ—Å–æ–≤

**üìä –ü—Ä–∏–º–µ—Ä –¥–æ—Ö–æ–¥–æ–≤ –¥–ª—è —à–∞—Ö–º–∞—Ç–Ω–æ–≥–æ –∫–ª—É–±–∞:**
‚Ä¢ 20 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ √ó 3000 —Ç–µ–Ω–≥–µ = 60 000 —Ç–µ–Ω–≥–µ/–º–µ—Å—è—Ü
‚Ä¢ 2 —Ç—É—Ä–Ω–∏—Ä–∞ √ó 30 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ √ó 3000 —Ç–µ–Ω–≥–µ = 180 000 —Ç–µ–Ω–≥–µ/–º–µ—Å—è—Ü
‚Ä¢ 4 –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å–∞ √ó 15 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ √ó 5000 —Ç–µ–Ω–≥–µ = 300 000 —Ç–µ–Ω–≥–µ/–º–µ—Å—è—Ü
‚Ä¢ **–ò—Ç–æ–≥–æ: ~540 000 —Ç–µ–Ω–≥–µ/–º–µ—Å—è—Ü**

–•–æ—á–µ—à—å, –ø–æ–º–æ–≥—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–ª–∞–Ω –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ç–≤–æ–µ–≥–æ –∫–ª—É–±–∞? üöÄ"""

    def process_user_message(self, message, user_email=None):
        """–û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π"""
        # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        if not message or not message.strip():
            return "‚ö†Ô∏è –ü—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å AI –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–º."

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è
        if len(message) > 1000:
            return "‚ö†Ô∏è –°–æ–æ–±—â–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ (–º–∞–∫—Å–∏–º—É–º 1000 —Å–∏–º–≤–æ–ª–æ–≤). –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∫—Ä–∞—Ç–∏—Ç–µ —Ç–µ–∫—Å—Ç."

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
        dangerous_patterns = [
            r'<script[^>]*>.*?</script>',
            r'javascript:',
            r'data:text/html',
            r'drop\s+table',
            r'delete\s+from',
            r'update\s+.*\s+set.*where',
            r'insert\s+into',
            r'exec\s*\(.*\)',
            r'sp_\w+',
            r'xp_\w+',
            r'\.\./',
            r'\${[^}]*}',
            r'\{\{[^}]*\}\}'
        ]

        import re
        for pattern in dangerous_patterns:
            if re.search(pattern, message, re.IGNORECASE):
                return "‚ö†Ô∏è –ù–µ–¥–æ–ø—É—Å—Ç–∏–º–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏–∑–±–µ–≥–∞–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞, SQL-–∫–æ–º–∞–Ω–¥ –∏ –¥—Ä—É–≥–∏—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤."

        message_lower = message.lower().strip()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ —Ñ–æ—Ä–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—É–±–∞
        if ('–ù–∞–∑–≤–∞–Ω–∏–µ' in message and '–û–ø–∏—Å–∞–Ω–∏–µ' in message and
            any(keyword in message_lower for keyword in ['—Å–æ–∑–¥–∞–π', '—Å–æ–∑–¥–∞—Ç—å', '—Ö–æ—á—É', '—Ñ–æ—Ä–º–∞', '–∑–∞–ø–æ–ª–Ω'])):
            return self.handle_club_creation(message, user_email)

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ö–æ—á–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—Ç—å –∫–ª—É–±
        if any(keyword in message_lower for keyword in ['—Å–æ–∑–¥–∞–π –∫–ª—É–±', '—Å–æ–∑–¥–∞—Ç—å –∫–ª—É–±', '—Ö–æ—á—É —Å–æ–∑–¥–∞—Ç—å', '—Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª—É–±–∞']):
            return self.get_club_creation_template()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
        if any(keyword in message_lower for keyword in ['—Å–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ', '—Å–æ–∑–¥–∞–π –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ', '–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ']):
            return self.handle_event_creation(message, user_email)

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—É–±–æ–º
        if any(keyword in message_lower for keyword in ['–º–æ–∏ –∫–ª—É–±—ã', '—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—É–±–æ–º', '—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª—É–±–∞']):
            return self.get_club_management_options()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—é
        if any(keyword in message_lower for keyword in ['–º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è', '–∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å', '–¥–µ–Ω—å–≥–∏', '—Ñ–∏–Ω–∞–Ω—Å—ã']):
            return self.get_monetization_options()

        # –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—ã–π AI
        return self.get_general_response(message)

    def get_general_response(self, message):
        """–û–±—â–∏–π AI –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ OpenAI"""
        try:
            response = self.client.chat.completions.create(
                model=self.model,
                messages=[
                    {
                        "role": "system",
                        "content": """–¢—ã - AI –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¶–µ–Ω—Ç—Ä —Å–æ–æ–±—â–µ—Å—Ç–≤ (fan-club.kz).
–¢—ã –ø–æ–º–æ–≥–∞–µ—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º, —Ä–∞–∑–≤–∏—Ç–∏–µ–º –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Ñ–∞–Ω-–∫–ª—É–±–æ–≤ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ.
–¢—ã –º–æ–∂–µ—à—å:
1. –°–æ–∑–¥–∞–≤–∞—Ç—å –∫–ª—É–±—ã –ø–æ —Ñ–æ—Ä–º–µ
2. –°–æ–∑–¥–∞–≤–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
3. –î–∞–≤–∞—Ç—å —Å–æ–≤–µ—Ç—ã –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é
4. –ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏
5. –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã –æ —Ñ–∞–Ω-–∫–ª—É–±–∞—Ö

–¢—ã –æ—Ç–≤–µ—á–∞–µ—à—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, –¥—Ä—É–∂–µ–ª—é–±–Ω–æ, –ø–æ–¥—Ä–æ–±–Ω–æ –∏ –ø–æ –¥–µ–ª—É.
–ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è.
–ü—Ä–µ–¥–ª–∞–≥–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏ –∏ —Å–æ–≤–µ—Ç—ã.
–ë—É–¥—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º –∏ —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–º."""
                    },
                    {
                        "role": "user",
                        "content": message
                    }
                ],
                max_tokens=1500,
                temperature=0.7
            )

            return response.choices[0].message.content

        except Exception as e:
            return f"""üòî –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —è –Ω–µ –º–æ–≥—É –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–∞—à –∑–∞–ø—Ä–æ—Å.

–ù–æ –≤—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ:
1. **–ù–∞–ø–∏—Å–∞—Ç—å —Å–Ω–æ–≤–∞** - –≤–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã** - —Å–æ–∑–¥–∞—Ç—å –∫–ª—É–±, –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –∏ —Ç.–¥.
3. **–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–º–æ—â—å** - —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥

üöÄ –ö–∞–∫ —è –º–æ–≥—É –ø–æ–º–æ—á—å –≤–∞–º —Å–µ–≥–æ–¥–Ω—è?"""

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
if __name__ == "__main__":
    ai = ActionableAIConsultant()

    # –ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—É–±–∞
    test_club_message = """–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª—É–±–∞: –®–∞—Ö–º–∞—Ç–Ω–∞—è –ê–∫–∞–¥–µ–º–∏—è "–ì–∞–º–±–∏—Ç –ü—Ä–æ"
–û–ø–∏—Å–∞–Ω–∏–µ –∫–ª—É–±–∞ (200+ —Å–∏–º–≤–æ–ª–æ–≤): –®–∞—Ö–º–∞—Ç–Ω–∞—è –ê–∫–∞–¥–µ–º–∏—è "–ì–∞–º–±–∏—Ç –ü—Ä–æ" ‚Äî —ç—Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ –ª—é–±–∏—Ç–µ–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ª—é–±–æ–≥–æ —É—Ä–æ–≤–Ω—è –º–æ–≥—É—Ç —Ä–∞–∑–≤–∏—Ç—å —Å–≤–æ—ë –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ, –Ω–∞–π—Ç–∏ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤ –∏ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö. –ú—ã –ø—Ä–æ–≤–æ–¥–∏–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤ –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –∏–≥—Ä–æ–∫–æ–≤, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä—ã, –æ–±—É—á–∞—é—â–∏–µ –ª–µ–∫—Ü–∏–∏, —Å–µ–∞–Ω—Å—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∏–≥—Ä—ã –∏ —Ä–∞–∑–±–æ—Ä—ã –ø–∞—Ä—Ç–∏–π —Å –æ–ø—ã—Ç–Ω—ã–º–∏ —Ç—Ä–µ–Ω–µ—Ä–∞–º–∏. –ù–∞—à –∫–ª—É–± —Å–æ–∑–¥–∞—ë—Ç –¥—Ä—É–∂–µ–ª—é–±–Ω—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É, –≥–¥–µ –∫–∞–∂–¥—ã–π –º–æ–∂–µ—Ç —Ä–∞—Å—Ç–∏, —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–∞–º—è—Ç—å, –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ. "–ì–∞–º–±–∏—Ç –ü—Ä–æ" –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –ª—é–¥–µ–π —Ä–∞–∑–Ω—ã—Ö –≤–æ–∑—Ä–∞—Å—Ç–æ–≤, –ø—Ä–µ–≤—Ä–∞—â–∞—è —à–∞—Ö–º–∞—Ç—ã –≤ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–µ —Ö–æ–±–±–∏ –∏ –ø—É—Ç—å –∫ –ª–∏—á–Ω–æ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é.

–ö–∞—Ç–µ–≥–æ—Ä–∏—è: –•–æ–±–±–∏
–ì–æ—Ä–æ–¥: –ê–ª–º–∞—Ç—ã
Email –∫–ª—É–±–∞: gambitpro.club@gmail.com"""

    print("ü§ñ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI –∞–≥–µ–Ω—Ç–∞ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏...")
    print("=" * 60)

    result = ai.process_user_message(test_club_message)
    print(result)