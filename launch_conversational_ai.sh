#!/bin/bash

# üöÄ –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Conversational AI –∞–≥–µ–Ω—Ç–∞

echo "üöÄ –ó–ê–ü–£–°–ö CONVERSATIONAL AI –ê–ì–ï–ù–¢–ê"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
if [ ! -d "venv" ]; then
    echo "‚ùå –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ setup.sh"
    exit 1
fi

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
echo "üîã –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ..."
source venv/bin/activate

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –º–æ–¥—É–ª—è
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ conversational AI –∞–≥–µ–Ω—Ç–∞..."
if [ ! -f "start_conversational_ai.py" ]; then
    echo "‚ùå –§–∞–π–ª start_conversational_ai.py –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–º–ø–æ—Ä—Ç –º–æ–¥—É–ª–µ–π
echo "üì¶ –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–º–ø–æ—Ä—Ç –º–æ–¥—É–ª–µ–π..."
python3 -c "
import sys
sys.path.append('ai_consultant/agents')
try:
    from conversational_production_agent import ConversationalAIConsultant
    print('‚úÖ ConversationalAIConsultant –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ')
except ImportError as e:
    print(f'‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ ConversationalAIConsultant: {e}')
    sys.exit(1)
"

if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π"
    exit 1
fi

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Ä—Ç
PORT=${1:-8002}

echo "üì° –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ—Ä—Ç: $PORT"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–Ω—è—Ç –ª–∏ –ø–æ—Ä—Ç
if lsof -Pi :$PORT -sTCP:LISTEN -t >/dev/null 2>&1; then
    echo "‚ö†Ô∏è  –ü–æ—Ä—Ç $PORT —É–∂–µ –∑–∞–Ω—è—Ç. –ü–æ–ø—Ä–æ–±—É–µ–º –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å..."
    sudo fuser -k $PORT/tcp
    sleep 2
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º conversational AI –∞–≥–µ–Ω—Ç
echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º conversational AI –∞–≥–µ–Ω—Ç–∞ –Ω–∞ –ø–æ—Ä—Ç—É $PORT..."
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"

# –ó–∞–ø—É—Å–∫–∞–µ–º –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
python3 start_conversational_ai.py $PORT &

# –°–æ—Ö—Ä–∞–Ω—è–µ–º PID –ø—Ä–æ—Ü–µ—Å—Å–∞
AI_PID=$!

echo "‚úÖ Conversational AI –∞–≥–µ–Ω—Ç –∑–∞–ø—É—â–µ–Ω!"
echo "ü§ñ PID: $AI_PID"
echo "üîó URL: http://localhost:$PORT"
echo "‚è±Ô∏è  –ó–∞–ø—É—â–µ–Ω–æ: $(date)"
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—â–µ–Ω
sleep 3
if kill -0 $AI_PID 2>/dev/null; then
    echo "‚úÖ –°–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç"
    echo ""
    echo "‚ú® –ù–û–í–´–ï –í–û–ó–ú–û–ñ–ù–û–°–¢–ò CONVERSATIONAL AI –ê–ì–ï–ù–¢–ê:"
    echo "‚Ä¢ –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ, –ª–µ–≥–∫–æ–µ –æ–±—â–µ–Ω–∏–µ"
    echo "‚Ä¢ –®–∏—Ä–æ–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–Ω–∏–º–∞–Ω–∏—è"
    echo "‚Ä¢ –ù–µ–ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è, –∂–∏–≤—ã–µ –æ—Ç–≤–µ—Ç—ã"
    echo "‚Ä¢ –î—Ä—É–∂–µ–ª—é–±–Ω—ã–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π —Å—Ç–∏–ª—å"
    echo "‚Ä¢ –£–ª—É—á—à–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π"
    echo "‚Ä¢ –ë–æ–ª–µ–µ –≥–∏–±–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã"
    echo ""
    echo "üéØ –î–û–°–¢–£–ü–ù–´–ï –ö–û–ú–ê–ù–î–´:"
    echo "‚Ä¢ –ø–æ–º–æ—â—å/help - –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é"
    echo "‚Ä¢ —Å–±—Ä–æ—Å/reset - –ù–∞—á–∞—Ç—å –¥–∏–∞–ª–æ–≥ —Å–Ω–∞—á–∞–ª–∞"
    echo "‚Ä¢ –ø–æ–∫–∞/goodbye - –ó–∞–≤–µ—Ä—à–∏—Ç—å –¥–∏–∞–ª–æ–≥"
    echo "‚Ä¢ –Ω–∞–π—Ç–∏ –∫–ª—É–±—ã - –ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª—É–±–æ–≤"
    echo ""
    echo "üí° –û–¢–õ–ò–ß–ò–Ø –û–¢ –ü–†–ï–î–´–î–£–©–ï–ô –í–ï–†–°–ò–ò:"
    echo "‚Ä¢ –ë–æ–ª–µ–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ, —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã"
    echo "‚Ä¢ –ú–µ–Ω—å—à–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π, –±–æ–ª—å—à–µ –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏"
    echo "‚Ä¢ –õ–µ–≥–∫–∏–π, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π —Ç–æ–Ω –æ–±—â–µ–Ω–∏—è"
    echo "‚Ä¢ –õ—É—á—à–µ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —à–∏—Ä–æ–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞"
    echo "‚Ä¢ –ë–æ–ª–µ–µ –≥–∏–±–∫–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π"
    echo ""
    echo "–î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞: kill $AI_PID"
else
    echo "‚ùå –û—à–∏–±–∫–∞: –°–µ—Ä–≤–µ—Ä –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å"
    exit 1
fi