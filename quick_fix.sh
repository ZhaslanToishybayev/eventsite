#!/bin/bash

# –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ - –∑–∞–ø—É—Å–∫–∞–µ–º Django –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ –ø–æ—Ä—Ç—É 80

echo "üöÄ –ë–´–°–¢–†–û–ï –†–ï–®–ï–ù–ò–ï - –ó–ê–ü–£–°–ö –ù–ê –ü–û–†–¢–£ 80"
echo "=========================================="

cd /var/www/myapp/eventsite

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source venv/bin/activate

echo "‚úÖ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ"

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ Django –ø—Ä–æ—Ü–µ—Å—Å—ã
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ Django –ø—Ä–æ—Ü–µ—Å—Å—ã..."
pkill -f "python.*manage.py.*8000" 2>/dev/null
sleep 2

# –ó–∞–ø—É—Å–∫–∞–µ–º Django —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 80 (–ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø)
echo "üåê –ó–∞–ø—É—Å–∫–∞–µ–º Django —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 80..."
sudo python manage.py runserver 0.0.0.0:80 --insecure &
sleep 5

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å..."
if curl -s http://127.0.0.1/ > /dev/null; then
    echo "‚úÖ –°–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 80!"
    echo ""
    echo "üåê –¢–µ–ø–µ—Ä—å –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:"
    echo "   http://fan-club.kz/"
    echo "   –∏–ª–∏ http://77.243.80.110/"
    echo ""
    echo "üîò –ù–∞–π–¥–∏—Ç–µ ü§ñ –∫–Ω–æ–ø–∫—É –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É"
    echo "üí¨ –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É - –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å—Å—è AI —á–∞—Ç"
    echo ""
    echo "‚úÖ –í–ò–î–ñ–ï–¢ –î–û–õ–ñ–ï–ù –†–ê–ë–û–¢–ê–¢–¨!"
    echo "–ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞"
    wait
else
    echo "‚ùå –°–∞–π—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 80"
    echo "–ü–æ–ø—Ä–æ–±—É–µ–º –Ω–∞ –ø–æ—Ä—Ç—É 8000..."
    sudo python manage.py runserver 0.0.0.0:8000 --insecure &
    sleep 3
    if curl -s http://127.0.0.1:8000/ > /dev/null; then
        echo "‚úÖ –°–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8000!"
        echo "üåê –û—Ç–∫—Ä–æ–π—Ç–µ: http://fan-club.kz:8000/"
        wait
    else
        echo "‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–ø—É—Å–∫–æ–º Django"
    fi
fi