#!/bin/bash

# üß™ –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
echo "üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï AI –ö–û–ù–°–£–õ–¨–¢–ê–ù–¢–ê - –ü–û–õ–ù–´–ô –¶–ò–ö–õ –°–û–ó–î–ê–ù–ò–Ø –ö–õ–£–ë–ê"
echo "============================================================"

API_URL="http://localhost:8000/api/v1/ai/simplified/interactive/chat/"

send_request() {
    curl -s -X POST "$API_URL" \
        -H "Content-Type: application/json" \
        -d "{\"message\": \"$1\", \"user_email\": \"$2\", \"state_id\": $3}"
}

echo "–®–ê–ì 1: –ù–∞—á–∞–ª–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—É–±–∞"
echo "----------------------------"
create_response=$(send_request "–°–æ–∑–¥–∞—Ç—å –∫–ª—É–±" "test@fan-club.kz" "null")
state_id=$(echo "$create_response" | python3 -c "import sys, json; print(json.load(sys.stdin)['state_id'])")
echo "‚úÖ State ID –ø–æ–ª—É—á–µ–Ω: $state_id"

echo ""
echo "–®–ê–ì 2: –í–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–ª—É–±–∞"
echo "---------------------------"
name_response=$(send_request "–¢–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—ã–π –∫–ª—É–± –†–∏—Ç–º" "test@fan-club.kz" "\"$state_id\"")
echo "‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ"

echo ""
echo "–®–ê–ì 3: –í–≤–æ–¥ –æ–ø–∏—Å–∞–Ω–∏—è"
echo "--------------------"
desc_response=$(send_request "–¢–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—ã–π –∫–ª—É–± –†–∏—Ç–º - —ç—Ç–æ –º–µ—Å—Ç–æ –≥–¥–µ –∫–∞–∂–¥—ã–π –º–æ–∂–µ—Ç –Ω–∞—É—á–∏—Ç—å—Å—è —Ç–∞–Ω—Ü–µ–≤–∞—Ç—å, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –≤–æ–∑—Ä–∞—Å—Ç–∞ –∏ —É—Ä–æ–≤–Ω—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏. –ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –∑–∞–Ω—è—Ç–∏—è –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º: —Ö–∏–ø-—Ö–æ–ø, contemporary, –ª–∞—Ç–∏–Ω–∞, —ç—Å—Ç—Ä–∞–¥–Ω—ã–µ —Ç–∞–Ω—Ü—ã. –ö–ª—É–± –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –¥–µ—Ç–µ–π, –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤ –∏ –≤–∑—Ä–æ—Å–ª—ã—Ö. –ù–∞—à–∞ —Ü–µ–ª—å - —Ä–∞–∑–≤–∏–≤–∞—Ç—å —Ç–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—É—é –∫—É–ª—å—Ç—É—Ä—É, —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—Ä—É–∂–µ—Å–∫—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É. –ú—ã –ø—Ä–æ–≤–æ–¥–∏–º –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã, —É—á–∞—Å—Ç–≤—É–µ–º –≤ –∫–æ–Ω–∫—É—Ä—Å–∞—Ö –∏ –æ—Ä–≥–∞–Ω–∏–∑—É–µ–º –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è." "test@fan-club.kz" "\"$state_id\"")
echo "‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ"

echo ""
echo "–®–ê–ì 4: –í–≤–æ–¥ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
echo "---------------------"
cat_response=$(send_request "–ò—Å–∫—É—Å—Å—Ç–≤–æ" "test@fan-club.kz" "\"$state_id\"")
echo "‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ò—Å–∫—É—Å—Å—Ç–≤–æ"

echo ""
echo "–®–ê–ì 5: –í–≤–æ–¥ –≥–æ—Ä–æ–¥–∞"
echo "------------------"
city_response=$(send_request "–ê–ª–º–∞—Ç—ã" "test@fan-club.kz" "\"$state_id\"")
echo "‚úÖ –ì–æ—Ä–æ–¥: –ê–ª–º–∞—Ç—ã"

echo ""
echo "–®–ê–ì 6: –í–≤–æ–¥ email"
echo "-----------------"
email_response=$(send_request "dance.ritm@mail.kz" "test@fan-club.kz" "\"$state_id\"")
echo "‚úÖ Email: dance.ritm@mail.kz"

echo ""
echo "–®–ê–ì 7: –í–≤–æ–¥ —Ç–µ–ª–µ—Ñ–æ–Ω–∞"
echo "--------------------"
phone_response=$(send_request "+77017778899" "test@fan-club.kz" "\"$state_id\"")
echo "‚úÖ –¢–µ–ª–µ—Ñ–æ–Ω: +77017778899"

echo ""
echo "–®–ê–ì 8: –í–≤–æ–¥ –∞–¥—Ä–µ—Å–∞ (—Ñ–∏–Ω–∞–ª—å–Ω—ã–π)"
echo "------------------------------"
final_response=$(send_request "–¢–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—ã–π –∑–∞–ª, —É–ª. –ê–±–∞—è 125" "test@fan-club.kz" "\"$state_id\"")

echo ""
echo "üéâ –§–ò–ù–ê–õ–¨–ù–û–ï –°–û–û–ë–©–ï–ù–ò–ï –û –°–û–ó–î–ê–ù–ò–ò –ö–õ–£–ë–ê:"
echo "=========================================="
echo "$final_response" | python3 -c "
import sys, json
try:
    data = json.load(sys.stdin)
    message = data.get('message', '')
    # –î–µ–∫–æ–¥–∏—Ä—É–µ–º —ç–º–æ–¥–∑–∏
    import html
    print(html.unescape(message.replace('\\n', '\n')))
except:
    print('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON')
"

echo ""
echo "üîç –ü–†–û–í–ï–†–ö–ê –í –ë–ê–ó–ï –î–ê–ù–ù–´–•:"
echo "============================"
db_check=$(source venv/bin/activate && python manage.py shell << 'EOF'
from clubs.models import Club
clubs = Club.objects.filter(name__icontains='–¢–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—ã–π').order_by('-created_at')[:1]
if clubs:
    club = clubs[0]
    print("‚úÖ –ö–õ–£–ë –£–°–ü–ï–®–ù–û –°–û–ó–î–ê–ù!")
    print(f"   üìã –ù–∞–∑–≤–∞–Ω–∏–µ: {club.name}")
    print(f"   üéØ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {club.category.name}")
    print(f"   üèôÔ∏è –ì–æ—Ä–æ–¥: {club.city.name}")
    print(f"   üìß Email: {club.email}")
    print(f"   üìû –¢–µ–ª–µ—Ñ–æ–Ω: {club.phone}")
    print(f"   üìç –ê–¥—Ä–µ—Å: {club.address}")
    print(f"   üîó –°—Å—ã–ª–∫–∞: /clubs/{club.id}/")
else:
    print("‚ùå –ö–õ–£–ë –ù–ï –°–û–ó–î–ê–ù –í –ë–ê–ó–ï –î–ê–ù–ù–´–•")
EOF
)

echo "$db_check"

echo ""
echo "üèÅ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û!"
echo "============================================================"