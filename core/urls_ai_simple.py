"""
AI API URLs
"""
from django.urls import path
from django.http import JsonResponse
import os
from django.conf import settings
from django.views.decorators.csrf import csrf_exempt
from django.utils.decorators import method_decorator
import json

def ai_status(request):
    """AI API status"""
    return JsonResponse({
        'status': 'working',
        'features': ['club_creation', 'event_planning', 'community_building'],
        'model': 'gpt-4o-mini'
    })

@csrf_exempt
def ai_chat(request):
    """AI chat endpoint"""
    if request.method == 'POST':
        try:
            data = json.loads(request.body)
            message = data.get('message', '')

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–∫–ª—é—á–µ–Ω –ª–∏ AI
            ai_enabled = getattr(settings, 'AI_CONSULTANT_ENABLED', False)

            if not ai_enabled:
                return JsonResponse({
                    'error': 'AI –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω'
                }, status=503)

            # –ü—Ä–æ—Å—Ç–æ–π AI –æ—Ç–≤–µ—Ç (–≤ —Ä–µ–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –±—É–¥–µ—Ç OpenAI API)
            response = get_ai_response(message)

            return JsonResponse({
                'message': response,
                'type': 'text'
            })

        except Exception as e:
            return JsonResponse({
                'error': f'–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞: {str(e)}'
            }, status=500)

    return JsonResponse({
        'error': '–¢–æ–ª—å–∫–æ POST –∑–∞–ø—Ä–æ—Å—ã'
    }, status=405)

def get_ai_response(message):
    """–ü—Ä–æ—Å—Ç–æ–π AI –æ—Ç–≤–µ—Ç"""
    message = message.lower().strip()

    if '–ø—Ä–∏–≤–µ—Ç' in message or '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π' in message:
        return "–ü—Ä–∏–≤–µ—Ç! üëã –Ø AI –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç UnitySphere. –ö–∞–∫ –º–æ–≥—É –ø–æ–º–æ—á—å —Å —Ñ–∞–Ω-–∫–ª—É–±–∞–º–∏?"

    elif '—Å–æ–∑–¥–∞—Ç—å' in message and ('–∫–ª—É–±' in message or '—Ñ–∞–Ω' in message):
        return """–°–æ–∑–¥–∞–Ω–∏–µ —Ñan-–∫–ª—É–±–∞ - –æ—Ç–ª–∏—á–Ω–∞—è –∏–¥–µ—è! üéØ

–í–æ—Ç –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω:
1. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ç–µ–º–∞—Ç–∏–∫—É** - —á—Ç–æ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤–∞—à—É –∞—É–¥–∏—Ç–æ—Ä–∏—é?
2. **–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ** - –æ–Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø–æ–º–∏–Ω–∞—é—â–∏–º—Å—è
3. **–°–æ–∑–¥–∞–π—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ** - —Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Ü–µ–ª—è—Ö –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–ª—É–±–∞
4. **–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é** - –º—É–∑—ã–∫–∞, —Å–ø–æ—Ä—Ç, —Ö–æ–±–±–∏ –∏ —Ç.–¥.
5. **–ù–∞–∑–Ω–∞—á—å—Ç–µ –≥–æ—Ä–æ–¥** - –≥–¥–µ –±—É–¥–µ—Ç –±–∞–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–ª—É–±?

–•–æ—á–µ—à—å, –ø–æ–º–æ–≥—É —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∏–¥–µ–π –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—è?"""

    elif '–∏–¥–µ–∏' in message or '–ø–æ–º–æ—â—å' in message:
        return """–í–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–¥–µ–π –¥–ª—è —Ñ–∞–Ω-–∫–ª—É–±–æ–≤:

üéµ **–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ**: –§–∞–Ω-–∫–ª—É–± –ª—é–±–∏–º–æ–π –≥—Ä—É–ø–ø—ã, –∫–ª—É–± —Å–ª—É—à–∞—Ç–µ–ª–µ–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∂–∞–Ω—Ä–∞
‚öΩ **–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–º–∞–Ω–¥—ã, —Ñ–∞–Ω-–∫–ª—É–± –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –≤–∏–¥–∞ —Å–ø–æ—Ä—Ç–∞
üéÆ **–ì–µ–π–º–µ—Ä—Å–∫–∏–µ**: –ü–æ –≤–∏–¥–µ–æ–∏–≥—Ä–∞–º, –Ω–∞—Å—Ç–æ–ª—å–Ω—ã–º –∏–≥—Ä–∞–º, –∫–∏–±–µ—Ä—Å–ø–æ—Ä—Ç—É
üé® **–¢–≤–æ—Ä—á–µ—Å–∫–∏–µ**: –†–∏—Å–æ–≤–∞–Ω–∏–µ, –ø–∏—Å–∞—Ç–µ–ª—å—Å—Ç–≤–æ, —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è
üìö **–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ**: –ö–Ω–∏–∂–Ω—ã–µ –∫–ª—É–±—ã, –¥–µ–±–∞—Ç—ã, –Ω–∞—Å—Ç–æ–ª—å–Ω—ã–µ –∏–≥—Ä—ã

–ß—Ç–æ –∏–∑ —ç—Ç–æ–≥–æ —Ç–µ–±–µ –±–ª–∏–∂–µ?"""

    elif '—Å–ø–∞—Å–∏–±–æ' in message or '–±–ª–∞–≥–æ–¥–∞—Ä' in message:
        return "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞! üòä –ï—Å–ª–∏ –±—É–¥—É—Ç –µ—â–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ñ–∞–Ω-–∫–ª—É–±–∞–º - –æ–±—Ä–∞—â–∞–π—Å—è!"

    else:
        return """–Ø –ø–æ–º–æ–≥—É —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ–º —Ñ–∞–Ω-–∫–ª—É–±–æ–≤!

–í–æ—Ç —á—Ç–æ –º–æ–≥—É:
‚Ä¢ –ü–æ–º–æ—á—å —Å –∏–¥–µ—è–º–∏ –¥–ª—è –∫–ª—É–±–æ–≤
‚Ä¢ –î–∞—Ç—å —Å–æ–≤–µ—Ç—ã –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
‚Ä¢ –ü–æ–¥—Å–∫–∞–∑–∞—Ç—å –∫–∞–∫ –ø—Ä–∏–≤–ª–µ—á—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
‚Ä¢ –ü–æ–º–æ—á—å —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∫–ª—É–±–∞

–û —á–µ–º —Ö–æ—á–µ—à—å –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å? ü§î"""

urlpatterns = [
    path('', ai_status, name='ai_status'),
    path('chat/', ai_chat, name='ai_chat'),
]