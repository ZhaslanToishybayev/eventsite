# üöÄ UnitySphere Production Configuration - IDEAL SETUP
# –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π, –±—ã—Å—Ç—Ä—ã–π, –±–µ–∑–æ–ø–∞—Å–Ω—ã–π nginx + Django

# –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è fan-club.kz
server {
    listen 80;
    listen [::]:80;
    server_name fan-club.kz www.fan-club.kz;

    # üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;

    # üìÅ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
    location /static/ {
        alias /var/www/myapp/eventsite/static/;
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;

        # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
        location ~* \.(css|js)$ {
            expires 1M;
            add_header Cache-Control "public";
        }

        location ~* \.(jpg|jpeg|png|gif|ico|svg)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }

    # üìÇ –ú–µ–¥–∏–∞ —Ñ–∞–π–ª—ã
    location /media/ {
        alias /var/www/myapp/eventsite/media/;
        expires 30d;
        add_header Cache-Control "public";
    }

    # ü§ñ AI Widget API (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
    location /api/v1/ai/production/ {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è AI
        proxy_connect_timeout 30s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;

        # CORS –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞
        add_header Access-Control-Allow-Origin "*" always;
        add_header Access-Control-Allow-Methods "GET, POST, OPTIONS" always;
        add_header Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept, Authorization" always;
    }

    # üêõ Health check
    location /health/ {
        proxy_pass http://127.0.0.1:8080;
        access_log off;
    }

    # üåê –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã ‚Üí Django
    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è
        proxy_buffering on;
        proxy_buffer_size 4k;
        proxy_buffers 8 4k;
        proxy_busy_buffers_size 8k;

        # –¢–∞–π–º–∞—É—Ç—ã
        proxy_connect_timeout 30s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # üö´ –ó–∞–ø—Ä–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–ª—É–∂–µ–±–Ω—ã–º —Ñ–∞–π–ª–∞–º
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }

    # üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    location /nginx_status {
        stub_status on;
        allow 127.0.0.1;
        deny all;
    }
}

# üîí HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç (–µ—Å–ª–∏ –±—É–¥–µ—Ç SSL)
# server {
#     listen 443 ssl http2;
#     server_name fan-club.kz www.fan-club.kz;
#
#     ssl_certificate /path/to/certificate.crt;
#     ssl_certificate_key /path/to/private.key;
#     ssl_protocols TLSv1.2 TLSv1.3;
#     ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;
#
#     # –í–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ –∏–¥–µ—Ç –Ω–∞ Django
#     location / {
#         proxy_pass http://127.0.0.1:8080;
#         # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è
#     }
# }

# üîÑ HTTP ‚Üí HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç
# server {
#     listen 80;
#     server_name fan-club.kz www.fan-club.kz;
#     return 301 https://$server_name$request_uri;
# }