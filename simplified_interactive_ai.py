"""
Simplified Interactive AI Consultant - Session-free version
–ü—Ä–æ—Å—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Django —Å–µ—Å—Å–∏–π
"""

import uuid
import threading
from datetime import datetime, timedelta
from actionable_ai_consultant import ActionableAIConsultant

class SimplifiedInteractiveAIConsultant:
    """–£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π AI –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –±–µ–∑ —Å–µ—Å—Å–∏–π"""

    # –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤ –ø–∞–º—è—Ç–∏ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis –∏–ª–∏ –ë–î)
    _states = {}
    _states_lock = threading.Lock()

    def __init__(self):
        self.ai = ActionableAIConsultant()

    def analyze_user_sentiment(self, message):
        """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –æ–∫—Ä–∞—Å —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        message_lower = message.lower().strip()

        # –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —Å–ª–æ–≤–∞ –∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
        positive_indicators = [
            '–æ—Ç–ª–∏—á–Ω–æ', '–∫–ª–∞—Å—Å', '–ø—Ä–∏–∫–æ–ª—å–Ω–æ', '–∑–¥–æ—Ä–æ–≤–æ', '–∫—Ä—É—Ç–æ', '—Å—É–ø–µ—Ä', '–≤–∞—É',
            '—Ö–æ—á—É', '–∂–µ–ª–∞—é', '–º–µ—á—Ç–∞—é', '–æ–±–æ–∂–∞—é', '–ª—é–±–ª—é', '–≤–æ—Å—Ö–∏—â–∞—é—Å—å',
            '–≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç', '–º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç', '—Ä–∞–¥', '—Å—á–∞—Å—Ç–ª–∏–≤', '–≤–æ—Å—Ç–æ—Ä–≥'
        ]

        # –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Å–ª–æ–≤–∞ –∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
        negative_indicators = [
            '–Ω–µ', '–Ω–µ—Ç', '–Ω–∏–∫–æ–≥–¥–∞', '–Ω–∏—á–µ–≥–æ', '–Ω–∏–∫–∞–∫', '—É—Å—Ç–∞–ª', '—Ä–∞–∑–¥—Ä–∞–∂–∞–µ—Ç',
            '–Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è', '–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', '–ø—Ä–æ–±–ª–µ–º–∞', '–æ—à–∏–±–∫–∞', '—Å–ª–æ–º–∞–ª',
            '–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è', '–ø–ª–æ—Ö–æ', '—É–∂–∞—Å–Ω–æ', '–æ—Ç–≤—Ä–∞—Ç–∏—Ç–µ–ª—å–Ω–æ', '—Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω'
        ]

        # –≠–Ω—Ç—É–∑–∏–∞–∑–º –∏ —ç–Ω–µ—Ä–≥–∏—è
        enthusiasm_indicators = [
            '–æ—á–µ–Ω—å', '—Å–∏–ª—å–Ω–æ', '–Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ', '–ø–æ—Ç—Ä—è—Å–∞—é—â–µ', '—Ñ–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫–∏',
            '!', '!!', '!!!', '–≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π', '—ç–Ω–µ—Ä–≥–∏—á–Ω–æ'
        ]

        positive_score = sum(1 for word in positive_indicators if word in message_lower)
        negative_score = sum(1 for word in negative_indicators if word in message_lower)
        enthusiasm_score = sum(1 for word in enthusiasm_indicators if word in message_lower)
        exclamation_count = message.count('!')

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
        if positive_score > negative_score:
            if enthusiasm_score > 0 or exclamation_count > 2:
                return 'enthusiastic'  # –≠–Ω—Ç—É–∑–∏–∞—Å—Ç–∏—á–Ω–æ–µ
            else:
                return 'positive'  # –ü–æ–∑–∏—Ç–∏–≤–Ω–æ–µ
        elif negative_score > positive_score:
            return 'concerned'  # –û–∑–∞–±–æ—á–µ–Ω–Ω–æ–µ/–Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–µ
        else:
            return 'neutral'  # –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ

    def get_empathetic_response_prefix(self, sentiment):
        """–í–æ–∑–≤—Ä–∞—â–∞–µ–º —ç–º–ø–∞—Ç–∏—á–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        prefixes = {
            'enthusiastic': [
                'üî• –í–∞—É! –ß—É–≤—Å—Ç–≤—É—é —Ç–≤–æ–π —ç–Ω—Ç—É–∑–∏–∞–∑–º! ',
                'üöÄ –û—Ç–ª–∏—á–Ω–æ! –¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è –∑–∞—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–∞! ',
                '‚ú® –ü—Ä–µ–∫—Ä–∞—Å–Ω–æ! –í–∏–∂—É —Ç–≤–æ–π –≤–æ—Å—Ç–æ—Ä–≥! ',
                'üéâ –ó–¥–æ—Ä–æ–≤–æ! –¢—ã –∑–∞—Ä—è–∂–∞–µ—à—å –ø–æ–∑–∏—Ç–∏–≤–æ–º! '
            ],
            'positive': [
                'üòä –†–∞–¥ –∑–∞ —Ç–µ–±—è! ',
                'üëç –û—Ç–ª–∏—á–Ω–æ! ',
                'üåü –ü—Ä–µ–∫—Ä–∞—Å–Ω–æ! ',
                'üí´ –ó–∞–º–µ—á–∞—Ç–µ–ª—å–Ω–æ! '
            ],
            'concerned': [
                'ü§ó –ü–æ–Ω–∏–º–∞—é —Ç–≤–æ–∏ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è. ',
                'üí¨ –†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ, —è –ø–æ–º–æ–≥—É. ',
                'ü§ù –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä–µ–º—Å—è –≤–º–µ—Å—Ç–µ. ',
                'üí™ –ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π, –≤—Å–µ –ø–æ–ª—É—á–∏—Ç—Å—è! '
            ],
            'neutral': [
                'ü§î –ü–æ–Ω—è–ª. ',
                'üìù –•–æ—Ä–æ—à–æ. ',
                'üëç –ü—Ä–∏–Ω—è—Ç–æ. ',
                'üí¨ –î–∞–≤–∞–π –ø–æ–º–æ–∂–µ–º. '
            ]
        }
        import random
        return random.choice(prefixes.get(sentiment, ['']))

    def personalize_response(self, message, base_response, user_email=None):
        """–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è"""
        sentiment = self.analyze_user_sentiment(message)
        prefix = self.get_empathetic_response_prefix(sentiment)

        # –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è
        if user_email and '@' in user_email:
            username = user_email.split('@')[0]
            personal_greeting = f" @{username}, "
        else:
            personal_greeting = " –î–æ—Ä–æ–≥–æ–π –¥—Ä—É–≥, "

        # –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
        if sentiment == 'enthusiastic':
            # –î–æ–±–∞–≤–ª—è–µ–º –±–æ–ª—å—à–µ —ç–Ω–µ—Ä–≥–∏–∏ –∏ —ç–º–æ–¥–∑–∏
            enhanced_response = base_response.replace('!', '!! üéâ').replace('.', '! üöÄ')
            if '?' not in enhanced_response:
                enhanced_response += ' –¢—ã –ø—Ä–æ—Å—Ç–æ –º–æ–ª–æ–¥–µ—Ü! üí™'
        elif sentiment == 'concerned':
            # –î–æ–±–∞–≤–ª—è–µ–º –±–æ–ª—å—à–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –æ–±—ä—è—Å–Ω–µ–Ω–∏–π
            enhanced_response = f"{prefix}{personal_greeting} {base_response}\n\n–ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π, —è —Ä—è–¥–æ–º –∏ –ø–æ–º–æ–≥—É –≤–æ –≤—Å–µ–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è! ü§ó"
        else:
            enhanced_response = f"{prefix}{personal_greeting}{base_response}"

        return enhanced_response

    def get_creative_suggestions(self, category, city=None):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∫–ª—É–±–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º"""
        suggestions = {}

        # –ú—É–∑—ã–∫–∞
        if '–º—É–∑—ã–∫' in category.lower() or 'music' in category.lower():
            suggestions = {
                'event_ideas': [
                    "üéµ Open Mic –≤–µ—á–µ—Ä–∞ - –≥–¥–µ –∫–∞–∂–¥—ã–π –º–æ–∂–µ—Ç –≤—ã—Å—Ç—É–ø–∏—Ç—å",
                    "üéß –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –±–∞—Ç—Ç–ª—ã –∏ –¥–∂–µ–º—ã",
                    "üéπ –ú–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã –æ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –º—É–∑—ã–∫–∞–Ω—Ç–æ–≤",
                    "üé§ –ö–∞—Ä–∞–æ–∫–µ-–±–∞—Ç—Ç–ª—ã —Å –Ω–µ–æ–±—ã—á–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏",
                    "üé∑ –î–∂–∞–∑–æ–≤—ã–µ –≤–µ—á–µ—Ä–∏–Ω–∫–∏ –≤ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏—è—Ö"
                ],
                'unique_concepts': [
                    "üéµ '–ó–≤—É–∫–∏ –ì–æ—Ä–æ–¥–∞' - –∏—Å—Å–ª–µ–¥—É–µ–º –º—É–∑—ã–∫–∞–ª—å–Ω—É—é —Å—Ü–µ–Ω—É —Å–≤–æ–µ–≥–æ –≥–æ—Ä–æ–¥–∞",
                    "üéß '–ú—É–∑—ã–∫–∞ –∏–∑ –ü–æ–¥–≤–∞–ª–∞' - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö –∞—Ä—Ç–∏—Å—Ç–æ–≤",
                    "üéπ '–î–∂–µ–º-–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ' - –∏–º–ø—Ä–æ–≤–∏–∑–∞—Ü–∏—è –±–µ–∑ –≥—Ä–∞–Ω–∏—Ü",
                    "üé§ '–í–æ–∫–∞–ª—å–Ω–∞—è –®–∫–æ–ª–∞' - –æ–±—É—á–µ–Ω–∏–µ –ø–µ–Ω–∏—é –≤ –¥—Ä—É–∂–µ—Å–∫–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ",
                    "üé∑ '–î–∂–∞–∑-–∫–ª—É–±' - –¥–ª—è —Ü–µ–Ω–∏—Ç–µ–ª–µ–π —Ö–æ—Ä–æ—à–µ–π –º—É–∑—ã–∫–∏"
                ],
                'collaboration_ideas': [
                    "ü§ù –ö–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏–∏ —Å –º–µ—Å—Ç–Ω—ã–º–∏ –º—É–∑—ã–∫–∞–Ω—Ç–∞–º–∏",
                    "üé® –ê—Ä—Ç-–ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å—ã —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ —Ö—É–¥–æ–∂–Ω–∏–∫–∞–º–∏",
                    "üé≠ –¢–µ–∞—Ç—Ä–∞–ª—å–Ω—ã–µ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å –∂–∏–≤–æ–π –º—É–∑—ã–∫–æ–π",
                    "üé™ –£–ª–∏—á–Ω—ã–µ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è –∏ flash mob'—ã",
                    "üìª –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–¥–∫–∞—Å—Ç–∞ –∏–ª–∏ —Ä–∞–¥–∏–æ—à–æ—É"
                ]
            }

        # –°–ø–æ—Ä—Ç
        elif '—Å–ø–æ—Ä—Ç' in category.lower() or 'fitness' in category.lower():
            suggestions = {
                'event_ideas': [
                    "üèÉ‚Äç‚ôÇÔ∏è –£—Ç—Ä–µ–Ω–Ω–∏–µ –ø—Ä–æ–±–µ–∂–∫–∏ —Å –∑–∞–≤—Ç—Ä–∞–∫–æ–º",
                    "üßò‚Äç‚ôÄÔ∏è –ô–æ–≥–∞-–º–∞—Ä–∞—Ñ–æ–Ω—ã –Ω–∞ —Å–≤–µ–∂–µ–º –≤–æ–∑–¥—É—Ö–µ",
                    "üö¥ –í–µ–ª–æ–ø—Ä–æ–≥—É–ª–∫–∏ –ø–æ –∫—Ä–∞—Å–∏–≤—ã–º –º–∞—Ä—à—Ä—É—Ç–∞–º",
                    "ü§∏ –°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ –∏–≥—Ä—ã –∏ —Ç—É—Ä–Ω–∏—Ä—ã",
                    "üèãÔ∏è –§–∏—Ç–Ω–µ—Å-—á–µ–ª–ª–µ–Ω–¥–∂–∏ –∏ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è"
                ],
                'unique_concepts': [
                    "üèÉ‚Äç‚ôÇÔ∏è '–°–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ –£—Ç—Ä–æ' - –Ω–∞—á–∏–Ω–∞–µ–º –¥–µ–Ω—å —Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",
                    "üßò‚Äç‚ôÄÔ∏è '–ô–æ–≥–∞ –¥–ª—è –í—Å–µ—Ö' - –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏",
                    "üö¥ '–í–µ–ª–æ-–≠–∫—Å–ø–ª–æ—Ä–µ—Ä' - –∏—Å—Å–ª–µ–¥—É–µ–º –≥–æ—Ä–æ–¥ –Ω–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞—Ö",
                    "ü§∏ '–ò–≥—Ä–æ–≤–∞—è –ü–ª–æ—â–∞–¥–∫–∞' - –≤–∑—Ä–æ—Å–ª—ã–µ —Ç–æ–∂–µ —É–º–µ—é—Ç –∏–≥—Ä–∞—Ç—å",
                    "üèãÔ∏è '–§–∏—Ç–Ω–µ—Å-–ö–æ–º—å—é–Ω–∏—Ç–∏' - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –º–æ—Ç–∏–≤–∞—Ü–∏—è"
                ],
                'collaboration_ideas': [
                    "üè• –ö–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏–∏ —Å —Ñ–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–Ω–µ—Ä–∞–º–∏",
                    "ü•ó –î–∏–µ—Ç–æ–ª–æ–≥–∏ –∏ –Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥–∏",
                    "üëï –°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ –±—Ä–µ–Ω–¥—ã –∏ –º–∞–≥–∞–∑–∏–Ω—ã",
                    "üè¢ –§–∏—Ç–Ω–µ—Å-–∫–ª—É–±—ã –∏ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ –ø–ª–æ—â–∞–¥–∫–∏",
                    "üì± –§–∏—Ç–Ω–µ—Å-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –≥–∞–¥–∂–µ—Ç—ã"
                ]
            }

        # –ò–≥—Ä—ã
        elif any(word in category.lower() for word in ['–∏–≥—Ä–∞', '–∏–≥—Ä–æ–≤–æ–π', 'game', 'gaming', '–∫–∏–±–µ—Ä']):
            suggestions = {
                'event_ideas': [
                    "üéÆ –¢—É—Ä–Ω–∏—Ä—ã –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω—ã–º –∏–≥—Ä–∞–º",
                    "üé≤ –ù–∞—Å—Ç–æ–ª—å–Ω—ã–µ –≤–µ—á–µ—Ä–∞ —Å –Ω–æ–≤—ã–º–∏ –∏–≥—Ä–∞–º–∏",
                    "üïπÔ∏è –†–µ—Ç—Ä–æ-–∏–≥—Ä–æ–≤—ã–µ –≤–µ—á–µ—Ä–∏–Ω–∫–∏",
                    "üèÜ –ö–∏–±–µ—Ä—Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è",
                    "üé≠ –†–æ–ª–µ–≤—ã–µ –∏–≥—Ä—ã –∏ –∫–≤–µ—Å—Ç—ã"
                ],
                'unique_concepts': [
                    "üéÆ '–ò–≥—Ä–æ–≤–∞—è –ê–∫–∞–¥–µ–º–∏—è' - —É—á–∏–º—Å—è –∏–≥—Ä–∞—Ç—å –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–≥—Ä—ã",
                    "üé≤ '–ù–∞—Å—Ç–æ–ª—å–Ω—ã–π –ö–ª—É–±' - –∫–ª–∞—Å—Å–∏–∫–∞ –∂–∞–Ω—Ä–∞ –∏ –Ω–æ–≤–∏–Ω–∫–∏",
                    "üïπÔ∏è '–†–µ—Ç—Ä–æ-–ì–µ–π–º–µ—Ä—ã' - –Ω–æ—Å—Ç–∞–ª—å–≥–∏—è –ø–æ —Å—Ç–∞—Ä—ã–º –∏–≥—Ä–∞–º",
                    "üèÜ '–ö–∏–±–µ—Ä-–ê—Ä–µ–Ω–∞' - –¥–ª—è —Å–µ—Ä—å–µ–∑–Ω—ã—Ö —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π",
                    "üé≠ '–õ—é–¥–ü—ç–π' - –∂–∏–≤—ã–µ —Ä–æ–ª–µ–≤—ã–µ –∏–≥—Ä—ã"
                ],
                'collaboration_ideas': [
                    "üè™ –ò–≥—Ä–æ–≤—ã–µ –º–∞–≥–∞–∑–∏–Ω—ã –∏ –∫–∞—Ñ–µ",
                    "üé® –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–≥—Ä –∏ —Å—Ç—Ä–∏–º–µ—Ä—ã",
                    "üèÜ –ö–∏–±–µ—Ä—Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏",
                    "üì∫ –°—Ç—Ä–∏–º–∏–Ω–≥–æ–≤—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã",
                    " merch –ú–µ—Ä—á –∏ –∞—Ç—Ä–∏–±—É—Ç–∏–∫–∞"
                ]
            }

        # –ò—Å–∫—É—Å—Å—Ç–≤–æ
        elif '–∏—Å–∫—É—Å' in category.lower() or 'art' in category.lower():
            suggestions = {
                'event_ideas': [
                    "üé® –ú–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º —Ç–µ—Ö–Ω–∏–∫–∞–º",
                    "üñºÔ∏è –í—ã—Å—Ç–∞–≤–∫–∏ —Ä–∞–±–æ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤",
                    "üé≠ –ü–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å—ã –∏ –∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏–∏",
                    "üé≠ –í–æ—Ä–∫—à–æ–ø—ã —Å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã–º–∏ —Ö—É–¥–æ–∂–Ω–∏–∫–∞–º–∏",
                    "üé™ –£–ª–∏—á–Ω—ã–µ –∞—Ä—Ç-–ø—Ä–æ–µ–∫—Ç—ã"
                ],
                'unique_concepts': [
                    "üé® '–ê—Ä—Ç-–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è' - —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã —Å–æ –≤—Å–µ–º–∏ –≤–∏–¥–∞–º–∏ –∏—Å–∫—É—Å—Å—Ç–≤–∞",
                    "üñºÔ∏è '–ì–∞–ª–µ—Ä–µ—è –°–æ–æ–±—â–µ—Å—Ç–≤–∞' - –≤—ã—Å—Ç–∞–≤–ª—è–µ–º —Ä–∞–±–æ—Ç—ã –≤—Å–µ—Ö –∂–µ–ª–∞—é—â–∏—Ö",
                    "üé≠ '–ü–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å-–ì—Ä—É–ø–ø–∞' - –∂–∏–≤–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ –Ω–∞ —É–ª–∏—Ü–∞—Ö",
                    "üé≠ '–¢–≤–æ—Ä—á–µ—Å–∫–∞—è –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è' - –¥–µ–ª–∞–µ–º –∏—Å–∫—É—Å—Å—Ç–≤–æ –≤–º–µ—Å—Ç–µ",
                    "üé™ '–ê—Ä—Ç-–§–µ—Å—Ç–∏–≤–∞–ª—å' - –µ–∂–µ–≥–æ–¥–Ω—ã–µ –≥–æ—Ä–æ–¥—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è"
                ],
                'collaboration_ideas': [
                    "üèõÔ∏è –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≥–∞–ª–µ—Ä–µ–∏ –∏ –º—É–∑–µ–∏",
                    "üé≠ –¢–µ–∞—Ç—Ä—ã –∏ –≤—ã—Å—Ç–∞–≤–æ—á–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞",
                    "üé® –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —à–∫–æ–ª—ã –∏ —Å—Ç—É–¥–∏–∏",
                    "üè¢ –ö—É–ª—å—Ç—É—Ä–Ω—ã–µ —Ü–µ–Ω—Ç—Ä—ã –∏ –î–ö",
                    "üåê –ê—Ä—Ç-–±–ª–æ–≥–µ—Ä—ã –∏ –∏–Ω—Ñ–ª—é–µ–Ω—Å–µ—Ä—ã"
                ]
            }

        # –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
        elif any(word in category.lower() for word in ['–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', 'education', '—É—á–µ–±–∞', '—à–∫–æ–ª–∞', '–∫—É—Ä—Å—ã']):
            suggestions = {
                'event_ideas': [
                    "üéì –õ–µ–∫—Ü–∏–∏ –∏ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã",
                    "üìñ –ö–Ω–∏–∂–Ω—ã–µ –∫–ª—É–±—ã –∏ –æ–±—Å—É–∂–¥–µ–Ω–∏—è",
                    "üî¨ –ù–∞—É—á–Ω—ã–µ –≤–µ—á–µ—Ä–∞ –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏",
                    "üíª –í–æ—Ä–∫—à–æ–ø—ã –ø–æ –Ω–æ–≤—ã–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º",
                    "üó£Ô∏è –Ø–∑—ã–∫–æ–≤—ã–µ –∫–ª—É–±—ã –∏ –ø—Ä–∞–∫—Ç–∏–∫–∞"
                ],
                'unique_concepts': [
                    "üéì '–ê–∫–∞–¥–µ–º–∏—è –õ—é–±–æ–ø—ã—Ç—Å—Ç–≤–∞' - —É—á–∏–º—Å—è –≤—Å–µ–º—É –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–º—É",
                    "üìñ '–ö–Ω–∏–∂–Ω–æ–µ –°–æ–æ–±—â–µ—Å—Ç–≤–æ' - —á–∏—Ç–∞–µ–º –∏ –æ–±—Å—É–∂–¥–∞–µ–º –≤–º–µ—Å—Ç–µ",
                    "üî¨ '–Æ–Ω—ã–π –£—á–µ–Ω—ã–π' - —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –∏ –æ—Ç–∫—Ä—ã—Ç–∏—è",
                    "üíª '–¢–µ—Ö–Ω–æ-–ö–ª—É–±' - –≥–∞–¥–∂–µ—Ç—ã, –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ä–æ–±–æ—Ç—ã",
                    "üó£Ô∏è '–Ø–∑—ã–∫–æ–≤–∞—è –ü–ª–æ—â–∞–¥–∫–∞' - –ø—Ä–∞–∫—Ç–∏–∫—É–µ–º —è–∑—ã–∫–∏ –≤ –∏–≥—Ä–µ"
                ],
                'collaboration_ideas': [
                    "üìö –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Ü–µ–Ω—Ç—Ä—ã",
                    "üèõÔ∏è –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –∏ —à–∫–æ–ª—ã",
                    "üíª –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∏ —Å—Ç–∞—Ä—Ç–∞–ø—ã",
                    "üåê –û–Ω–ª–∞–π–Ω-–∫—É—Ä—Å—ã –∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã",
                    "üéì –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ –∏ —ç–∫—Å–ø–µ—Ä—Ç—ã"
                ]
            }

        # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –∏–¥–µ–∏
        else:
            suggestions = {
                'event_ideas': [
                    "üéâ –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤–µ—á–µ—Ä–∏–Ω–∫–∏ –∏ –≤—Å—Ç—Ä–µ—á–∏",
                    "ü§ù –û–±–º–µ–Ω –Ω–∞–≤—ã–∫–∞–º–∏ –∏ —É–º–µ–Ω–∏—è–º–∏",
                    "üèÜ –ö–æ–Ω–∫—É—Ä—Å—ã –∏ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è",
                    "üéÅ –°–æ–≤–º–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –∏ –∏–≤–µ–Ω—Ç—ã",
                    "üåç –í–æ–ª–æ–Ω—Ç–µ—Ä—Å–∫–∏–µ –∞–∫—Ü–∏–∏ –∏ –ø–æ–º–æ—â—å"
                ],
                'unique_concepts': [
                    "üéâ '–ö–ª—É–± –í—Å—Ç—Ä–µ—á' - –ø—Ä–æ—Å—Ç–æ –æ–±—â–∞–µ–º—Å—è –∏ –¥—Ä—É–∂–∏–º",
                    "ü§ù '–û–±–º–µ–Ω –ó–Ω–∞–Ω–∏—è–º–∏' - –∫–∞–∂–¥—ã–π —á–µ–º—É-—Ç–æ —É—á–∏—Ç –∏ —É—á–∏—Ç—Å—è",
                    "üèÜ '–°–æ—Ä–µ–≤–Ω–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –°–æ–æ–±—â–µ—Å—Ç–≤–æ' - –∑–¥–æ—Ä–æ–≤–æ–µ —Å–æ–ø–µ—Ä–Ω–∏—á–µ—Å—Ç–≤–æ",
                    "üéÅ '–°–æ–≤–º–µ—Å—Ç–Ω–æ–µ –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ' - —Å–æ–∑–¥–∞–µ–º —á—Ç–æ-—Ç–æ –≤–º–µ—Å—Ç–µ",
                    "üåç '–î–æ–±—Ä–æ–µ –î–µ–ª–æ' - –ø–æ–º–æ–≥–∞–µ–º –æ–∫—Ä—É–∂–∞—é—â–∏–º"
                ],
                'collaboration_ideas': [
                    "üè¢ –ú–µ—Å—Ç–Ω—ã–µ –±–∏–∑–Ω–µ—Å—ã –∏ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–∏",
                    "üèõÔ∏è –û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏",
                    "üåê –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ –∏ –º–µ–¥–∏–∞",
                    "üé™ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–Ω—ã–µ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞",
                    "üì± –ò–Ω—Ñ–ª—é–µ–Ω—Å–µ—Ä—ã –∏ –±–ª–æ–≥–µ—Ä—ã"
                ]
            }

        # –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–¥–µ–∏ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω –≥–æ—Ä–æ–¥
        if city:
            suggestions['local_ideas'] = [
                f"üèôÔ∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–ª–æ—â–∞–¥–∫–∏ –≤ {city}",
                f"üåü –ü—Ä–∏–≥–ª–∞—à–∞–µ–º –º–µ—Å—Ç–Ω—ã—Ö —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –∏–∑ {city}",
                f"üé™ –û—Ä–≥–∞–Ω–∏–∑—É–µ–º –≥–æ—Ä–æ–¥—Å–∫–∏–µ –∫–≤–µ—Å—Ç—ã –ø–æ {city}",
                f"ü§ù –°–æ—Ç—Ä—É–¥–Ω–∏—á–∞–µ–º —Å —Å–æ–æ–±—â–µ—Å—Ç–≤–∞–º–∏ {city}",
                f"üéâ –ü—Ä–æ–≤–æ–¥–∏–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –Ω–∞ –∑–Ω–∞–∫–æ–≤—ã—Ö –º–µ—Å—Ç–∞—Ö {city}"
            ]

        return suggestions

    def generate_creative_response(self, category, city=None):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π –æ—Ç–≤–µ—Ç —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏"""
        suggestions = self.get_creative_suggestions(category, city)

        response = f"""üí° **–ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ –∏–¥–µ–∏ –¥–ª—è —Ç–≤–æ–µ–≥–æ {category} –∫–ª—É–±–∞!** üöÄ

üéØ **üî• –ì–æ—Ä—è—á–∏–µ –∏–¥–µ–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π:**
{chr(10).join(suggestions.get('event_ideas', [])[:3])}

‚ú® **üåü –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**
{chr(10).join(suggestions.get('unique_concepts', [])[:3])}

ü§ù **üîó –ò–¥–µ–∏ –¥–ª—è –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏–π:**
{chr(10).join(suggestions.get('collaboration_ideas', [])[:3])}"""

        if 'local_ideas' in suggestions:
            response += f"""

üèôÔ∏è **üìç –õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–¥–µ–∏ –¥–ª—è {city}:**
{chr(10).join(suggestions['local_ideas'])}"""

        response += f"""

üí¨ **üí° –°–æ–≤–µ—Ç:** –í—ã–±–µ—Ä–∏ –æ–¥–Ω—É –∏–∑ –∏–¥–µ–π –∏ –∞–¥–∞–ø—Ç–∏—Ä—É–π –ø–æ–¥ –∏–Ω—Ç–µ—Ä–µ—Å—ã —Å–≤–æ–µ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏. –ì–ª–∞–≤–Ω–æ–µ - –Ω–∞—á–∞—Ç—å —Å –º–∞–ª–æ–≥–æ –∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Ä–∞–∑–≤–∏–≤–∞—Ç—å!

–ì–æ—Ç–æ–≤ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ –ª—é–±–æ–π –∏–∑ —ç—Ç–∏—Ö –∏–¥–µ–π? –ü—Ä–æ—Å—Ç–æ –≤—ã–±–µ—Ä–∏ —Ç—É, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–ª–∞ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ! üöÄ"""

        return response

    def make_response_human_like(self, message, base_response):
        """–î–µ–ª–∞–µ–º –æ—Ç–≤–µ—Ç—ã –±–æ–ª–µ–µ —á–µ–ª–æ–≤–µ—á–Ω—ã–º–∏ –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏"""
        import random

        # –ù–∞–±–æ—Ä—ã —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö —Ñ—Ä–∞–∑ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π
        human_phrases = {
            'acknowledgment': [
                "–ü–æ–Ω—è–ª —Ç–µ–±—è! ",
                "–ö–æ–Ω–µ—á–Ω–æ! ",
                "–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ! ",
                "–¢–æ—á–Ω–æ! ",
                "–ê–±—Å–æ–ª—é—Ç–Ω–æ –≤–µ—Ä–Ω–æ! ",
                "–°–æ–≤–µ—Ä—à–µ–Ω–Ω–æ —Å–æ–≥–ª–∞—Å–µ–Ω! "
            ],
            'encouragement': [
                "–¢—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏! ",
                "–ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ! ",
                "–≠—Ç–æ –æ—Ç–ª–∏—á–Ω–∞—è –∏–¥–µ—è! ",
                "–í–æ—Ç —ç—Ç–æ –¥–∞! ",
                "–ü—Ä–æ—Å—Ç–æ —Å—É–ø–µ—Ä! ",
                "–¢—ã –≥–µ–Ω–∏–π! "
            ],
            'support': [
                "–ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π, –≤—Å–µ –ø–æ–ª—É—á–∏—Ç—Å—è! ",
                "–Ø –≤–µ—Ä—é –≤ —Ç–µ–±—è! ",
                "–¢—ã —Å–ø—Ä–∞–≤–∏—à—å—Å—è! ",
                "–í—Å–µ –±—É–¥–µ—Ç –æ—Ç–ª–∏—á–Ω–æ! ",
                "–ì–ª–∞–≤–Ω–æ–µ - –Ω–µ —Å–¥–∞–≤–∞—Ç—å—Å—è! ",
                "–¢—ã –º–æ–ª–æ–¥–µ—Ü! "
            ],
            'transition': [
                "–ê —Ç–µ–ø–µ—Ä—å –¥–∞–≤–∞–π... ",
                "–î–∞–ª—å—à–µ —è –ø—Ä–µ–¥–ª–∞–≥–∞—é... ",
                "–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ - —ç—Ç–æ... ",
                "–ê —á—Ç–æ –µ—Å–ª–∏... ",
                "–ü—Ä–µ–¥—Å—Ç–∞–≤—å —Å–µ–±–µ... ",
                "–í–æ—Ç interesting–Ω–∞—è –º—ã—Å–ª—å... "
            ],
            'confirmation': [
                "–ò–º–µ–Ω–Ω–æ —Ç–∞–∫! ",
                "–í–µ—Ä–Ω–æ –ø–æ–¥–º–µ—á–µ–Ω–æ! ",
                "–¢–æ—á–Ω–æ –≤ —Ü–µ–ª—å! ",
                "–¢—ã –º–µ–Ω—è –ø–æ–Ω—è–ª! ",
                "–°–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –≤–µ—Ä–Ω–æ! ",
                "–≠—Ç–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ! "
            ],
            'empathy': [
                "–ü–æ–Ω–∏–º–∞—é —Ç–≤–æ–∏ —á—É–≤—Å—Ç–≤–∞. ",
                "–ß—É–≤—Å—Ç–≤—É—é —Ç–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π. ",
                "–†–∞–¥ —Ä–∞–∑–¥–µ–ª–∏—Ç—å —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç —Å —Ç–æ–±–æ–π. ",
                "–¢–≤–æ–π —ç–Ω—Ç—É–∑–∏–∞–∑–º –∑–∞—Ä–∞–∑–∏—Ç–µ–ª–µ–Ω! ",
                "–¢–≤–æ–∏ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è –≤–∞–∂–Ω—ã. ",
                "–Ø —Ä—è–¥–æ–º —Å —Ç–æ–±–æ–π. "
            ]
        }

        # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ñ—Ä–∞–∑
        message_lower = message.lower().strip()

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–æ–Ω –æ—Ç–≤–µ—Ç–∞
        if any(word in message_lower for word in ['—Å–ø–∞—Å–∏–±–æ', '–±–ª–∞–≥–æ–¥–∞—Ä—é', '—Å–ø—Å', 'thx', 'tnx']):
            tone = 'acknowledgment'
        elif any(word in message_lower for word in ['–Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è', '–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', '–ø—Ä–æ–±–ª–µ–º–∞', '–æ—à–∏–±–∫–∞', '—Å–ª–æ–º–∞–ª']):
            tone = 'support'
        elif any(word in message_lower for word in ['–∫—Ä—É—Ç–æ', '–∫–ª–∞—Å—Å', '–æ—Ç–ª–∏—á–Ω–æ', '–ø—Ä–∏–∫–æ–ª—å–Ω–æ', '–∑–¥–æ—Ä–æ–≤–æ', '–≤–∞—É']):
            tone = 'encouragement'
        elif any(word in message_lower for word in ['–∫–∞–∫', '—á—Ç–æ', '–ø–æ—á–µ–º—É', '–∑–∞—á–µ–º', '–∫–æ–≥–¥–∞', '–≥–¥–µ']):
            tone = 'transition'
        elif any(word in message_lower for word in ['–¥–∞', '—Ç–æ—á–Ω–æ', '–≤–µ—Ä–Ω–æ', '–ø—Ä–∞–≤–∏–ª—å–Ω–æ', '—Å–æ–≥–ª–∞—Å–µ–Ω']):
            tone = 'confirmation'
        elif any(word in message_lower for word in ['—Ä–∞–¥', '—Å—á–∞—Å—Ç–ª–∏–≤', '–≤–æ—Å—Ç–æ—Ä–≥', '–ø–µ—Ä–µ–∂–∏–≤–∞—é', '–≤–æ–ª–Ω—É—é—Å—å', '–≤–∑–≤–æ–ª–Ω–æ–≤–∞–Ω']):
            tone = 'empathy'
        else:
            tone = 'acknowledgment'

        # –î–æ–±–∞–≤–ª—è–µ–º —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        human_touch = random.choice(human_phrases[tone])

        # –î–µ–ª–∞–µ–º –æ—Ç–≤–µ—Ç –±–æ–ª–µ–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–º
        conversational_response = base_response

        # –ó–∞–º–µ–Ω—è–µ–º —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–µ
        formal_to_conversational = {
            "–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ": "–ö–æ–Ω–µ—á–Ω–æ",
            "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ": "–ù—É–∂–Ω–æ",
            "–°–ª–µ–¥—É–µ—Ç": "–õ—É—á—à–µ",
            "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è": "–°–æ–≤–µ—Ç—É—é",
            "–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º": "–ü—Ä–µ–¥–ª–∞–≥–∞—é",
            "–£–≤–µ–¥–æ–º–ª—è–µ–º": "–°–æ–æ–±—â–∞–µ–º",
            "–û—Å—É—â–µ—Å—Ç–≤–∏—Ç—å": "–°–¥–µ–ª–∞—Ç—å",
            "–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ": "–ü—Ä–æ–≤–µ—Å—Ç–∏",
            "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è": "–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å",
            "–£—á–∞—Å—Ç–∏–µ": "–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å"
        }

        for formal, conversational in formal_to_conversational.items():
            conversational_response = conversational_response.replace(formal, conversational)

        # –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–µ –≤—Å—Ç–∞–≤–∫–∏
        conversational_inserts = [
            "–∫–∞–∫ –≥–æ–≤–æ—Ä–∏—Ç—Å—è, ",
            "–µ—Å–ª–∏ —á–µ—Å—Ç–Ω–æ, ",
            "–ø–æ-–º–æ–µ–º—É, ",
            "–∫–∞–∂–µ—Ç—Å—è, ",
            "–Ω–∞–≤–µ—Ä–Ω–æ–µ, ",
            "–≤–æ–∑–º–æ–∂–Ω–æ, ",
            "—Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, ",
            "–¥–∞–∂–µ –º–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å, ",
            "–µ—Å–ª–∏ –ø–æ–¥—É–º–∞—Ç—å, ",
            "–º–µ–∂–¥—É –Ω–∞–º–∏ –≥–æ–≤–æ—Ä—è, "
        ]

        # –° –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 30% –¥–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—É—é –≤—Å—Ç–∞–≤–∫—É
        if random.random() < 0.3:
            insert = random.choice(conversational_inserts)
            # –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
            sentences = conversational_response.split('. ')
            if len(sentences) > 1:
                sentences[0] = sentences[0] + ", " + insert
                conversational_response = '. '.join(sentences)

        # –î–æ–±–∞–≤–ª—è–µ–º —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–µ –Ω–∞—á–∞–ª–æ
        final_response = human_touch + conversational_response

        # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—Ä–∞–∑—ã –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        closing_phrases = [
            "–ù–∞–¥–µ—é—Å—å, —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç! üòä",
            "–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ - —Å–ø—Ä–∞—à–∏–≤–∞–π! ü§ó",
            "–ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å –ª—é–±—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏! üí™",
            "–£–¥–∞—á–∏ –≤ —Ç–≤–æ–µ–º –Ω–∞—á–∏–Ω–∞–Ω–∏–∏! üöÄ",
            "–í–µ—Ä—å –≤ —Å–µ–±—è –∏ –≤—Å–µ –ø–æ–ª—É—á–∏—Ç—Å—è! ‚ú®",
            "–¢—ã –Ω–∞ –≤–µ—Ä–Ω–æ–º –ø—É—Ç–∏! üéØ"
        ]

        if not any(phrase in final_response for phrase in closing_phrases):
            final_response += "\n\n" + random.choice(closing_phrases)

        return final_response

    def _cleanup_old_states(self):
        """–û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (—Å—Ç–∞—Ä—à–µ 1 —á–∞—Å–∞)"""
        cutoff_time = datetime.now() - timedelta(hours=1)
        with self._states_lock:
            old_keys = [k for k, v in self._states.items() if v.get('last_activity', datetime.min) < cutoff_time]
            for key in old_keys:
                del self._states[key]

    def _get_or_create_state_id(self, state_id=None):
        """–ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π ID —Å–æ—Å—Ç–æ—è–Ω–∏—è"""
        if state_id and state_id in self._states:
            with self._states_lock:
                self._states[state_id]['last_activity'] = datetime.now()
            return state_id

        # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π ID —Å–æ—Å—Ç–æ—è–Ω–∏—è
        new_state_id = str(uuid.uuid4())
        with self._states_lock:
            self._states[new_state_id] = {
                'step': None,
                'data': {},
                'last_activity': datetime.now()
            }
        return new_state_id

    def _get_state(self, state_id):
        """–ü–æ–ª—É—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ ID"""
        with self._states_lock:
            return self._states.get(state_id, {'step': None, 'data': {}})

    def _save_state(self, state_id, state):
        """–°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ"""
        with self._states_lock:
            self._states[state_id] = {
                'step': state.get('step'),
                'data': state.get('data', {}),
                'last_activity': datetime.now()
            }

    def start_club_creation(self, message, state_id):
        """–ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—É–±–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º"""
        state_id = self._get_or_create_state_id(state_id)

        with self._states_lock:
            self._states[state_id] = {
                'step': 'name',
                'data': {},
                'last_activity': datetime.now()
            }

        # –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–∞–π—Ç–∞
        try:
            from ai_context import get_site_context, SiteContext
            site_context = get_site_context()

            # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
            sentiment = self.analyze_user_sentiment(message)

            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã
            popular_categories = site_context.get('popular_categories', [])
            popular_cities = site_context.get('popular_cities', [])

            # –í—ã–±–∏—Ä–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤
            category_examples = []
            if popular_categories:
                top_categories = [cat['name'] for cat in popular_categories[:3]]
                category_examples.extend(top_categories)

            # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
            if sentiment == 'enthusiastic':
                response_template = f"""üéØ [INTERACTIVE MODE] –£—Ö —Ç—ã! –ß—É–≤—Å—Ç–≤—É—é —Ç–≤–æ–π —ç–Ω—Ç—É–∑–∏–∞–∑–º! –î–∞–≤–∞–π —Å–æ–∑–¥–∞–¥–∏–º —Ç–≤–æ–π —Ñ–∞–Ω-–∫–ª—É–±! üöÄ

üìä **–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ —Å–∞–π—Ç—É:** –ù–∞ –Ω–∞—à–µ–º —Å–∞–π—Ç–µ {site_context.get('total_clubs', 0)} –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª—É–±–æ–≤ –≤ {site_context.get('total_cities', 0)} –≥–æ—Ä–æ–¥–∞—Ö.

**üìù –í–æ–ø—Ä–æ—Å 1:** –ö–∞–∫ –±—É–¥–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–≤–æ–π –∫—Ä—É—Ç–æ–π –∫–ª—É–±?

üí° **–í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ:** –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {', '.join(category_examples) if category_examples else '–ú—É–∑—ã–∫–∞, –°–ø–æ—Ä—Ç, –ò–≥—Ä—ã'}
üèôÔ∏è **–°–æ–≤–µ—Ç:** –î–æ–±–∞–≤—å –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–ª–æ—Ä–∏—Ç, –µ—Å–ª–∏ –∫–ª—É–± –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞!

üî• **–ü—Ä–∏–º–µ—Ä—ã:** "–ê–ª–º–∞—Ç–∏–Ω—Å–∫–∞—è –ú—É–∑—ã–∫–∞–ª—å–Ω–∞—è –°—Ü–µ–Ω–∞", "–ê—Å—Ç–∞–Ω–∞ –ò–≥—Ä–æ–≤–∞—è –ê–∫–∞–¥–µ–º–∏—è", "–®–∞—Ö–º–∞—Ç–Ω—ã–π –ö–ª—É–± '–ì–∞–º–±–∏—Ç'" –∏ —Ç.–¥."""
            elif sentiment == 'concerned':
                response_template = f"""üéØ [INTERACTIVE MODE] –ü–æ–Ω–∏–º–∞—é, —Ö–æ—á–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–π –∫–ª—É–±. –î–∞–≤–∞–π —è –ø–æ–º–æ–≥—É, —ç—Ç–æ —Å–æ–≤—Å–µ–º –Ω–µ—Å–ª–æ–∂–Ω–æ! ü§ó

üìä **–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ —Å–∞–π—Ç—É:** –ù–∞ –Ω–∞—à–µ–º —Å–∞–π—Ç–µ {site_context.get('total_clubs', 0)} –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª—É–±–æ–≤ –≤ {site_context.get('total_cities', 0)} –≥–æ—Ä–æ–¥–∞—Ö.

**üìù –í–æ–ø—Ä–æ—Å 1:** –ö–∞–∫ –±—É–¥–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–≤–æ–π –∫–ª—É–±?

üí° **–í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ:** –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {', '.join(category_examples) if category_examples else '–ú—É–∑—ã–∫–∞, –°–ø–æ—Ä—Ç, –ò–≥—Ä—ã'}
üèôÔ∏è **–°–æ–≤–µ—Ç:** –ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π, –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –ª—é–±–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–∏–¥–µ—Ç –≤ –≥–æ–ª–æ–≤—É!

üìù **–ü—Ä–∏–º–µ—Ä—ã:** "–ê–ª–º–∞—Ç–∏–Ω—Å–∫–∞—è –ú—É–∑—ã–∫–∞–ª—å–Ω–∞—è –°—Ü–µ–Ω–∞", "–ê—Å—Ç–∞–Ω–∞ –ò–≥—Ä–æ–≤–∞—è –ê–∫–∞–¥–µ–º–∏—è", "–®–∞—Ö–º–∞—Ç–Ω—ã–π –ö–ª—É–± '–ì–∞–º–±–∏—Ç'" –∏ —Ç.–¥."""
            else:
                response_template = f"""üéØ [INTERACTIVE MODE] –û—Ç–ª–∏—á–Ω–æ! –î–∞–≤–∞–π —Å–æ–∑–¥–∞–¥–∏–º —Ç–≤–æ–π —Ñ–∞–Ω-–∫–ª—É–±! üöÄ

üìä **–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ —Å–∞–π—Ç—É:** –ù–∞ –Ω–∞—à–µ–º —Å–∞–π—Ç–µ {site_context.get('total_clubs', 0)} –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª—É–±–æ–≤ –≤ {site_context.get('total_cities', 0)} –≥–æ—Ä–æ–¥–∞—Ö.

**üìù –í–æ–ø—Ä–æ—Å 1:** –ö–∞–∫ –±—É–¥–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–≤–æ–π –∫–ª—É–±?

üí° **–í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ:** –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {', '.join(category_examples) if category_examples else '–ú—É–∑—ã–∫–∞, –°–ø–æ—Ä—Ç, –ò–≥—Ä—ã'}
üèôÔ∏è **–°–æ–≤–µ—Ç:** –î–æ–±–∞–≤—å –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–ª–æ—Ä–∏—Ç, –µ—Å–ª–∏ –∫–ª—É–± –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞!

–ù–∞–ø–∏—à–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä: "–ê–ª–º–∞—Ç–∏–Ω—Å–∫–∞—è –ú—É–∑—ã–∫–∞–ª—å–Ω–∞—è –°—Ü–µ–Ω–∞", "–ê—Å—Ç–∞–Ω–∞ –ò–≥—Ä–æ–≤–∞—è –ê–∫–∞–¥–µ–º–∏—è", "–®–∞—Ö–º–∞—Ç–Ω—ã–π –ö–ª—É–± '–ì–∞–º–±–∏—Ç'" –∏ —Ç.–¥."""

        except Exception as e:
            # Fallback –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç
            sentiment = self.analyze_user_sentiment(message)
            if sentiment == 'enthusiastic':
                response_template = """üéØ [INTERACTIVE MODE] –£—Ö —Ç—ã! –ß—É–≤—Å—Ç–≤—É—é —Ç–≤–æ–π —ç–Ω—Ç—É–∑–∏–∞–∑–º! –î–∞–≤–∞–π —Å–æ–∑–¥–∞–¥–∏–º —Ç–≤–æ–π —Ñ–∞–Ω-–∫–ª—É–±! üöÄ

**üìù –í–æ–ø—Ä–æ—Å 1:** –ö–∞–∫ –±—É–¥–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–≤–æ–π –∫—Ä—É—Ç–æ–π –∫–ª—É–±?

üî• **–ü—Ä–∏–º–µ—Ä—ã:** "–®–∞—Ö–º–∞—Ç–Ω–∞—è –ê–∫–∞–¥–µ–º–∏—è", "–ö–ª—É–± –ª—é–±–∏—Ç–µ–ª–µ–π –∫–Ω–∏–≥" –∏ —Ç.–¥."""
            elif sentiment == 'concerned':
                response_template = """üéØ [INTERACTIVE MODE] –ü–æ–Ω–∏–º–∞—é, —Ö–æ—á–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–π –∫–ª—É–±. –î–∞–≤–∞–π —è –ø–æ–º–æ–≥—É! ü§ó

**üìù –í–æ–ø—Ä–æ—Å 1:** –ö–∞–∫ –±—É–¥–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–≤–æ–π –∫–ª—É–±?

üìù **–ü—Ä–∏–º–µ—Ä—ã:** "–®–∞—Ö–º–∞—Ç–Ω–∞—è –ê–∫–∞–¥–µ–º–∏—è", "–ö–ª—É–± –ª—é–±–∏—Ç–µ–ª–µ–π –∫–Ω–∏–≥" –∏ —Ç.–¥."""
            else:
                response_template = """üéØ [INTERACTIVE MODE] –û—Ç–ª–∏—á–Ω–æ! –î–∞–≤–∞–π —Å–æ–∑–¥–∞–¥–∏–º —Ç–≤–æ–π —Ñ–∞–Ω-–∫–ª—É–±! –Ø –∑–∞–¥–∞–º —Ç–µ–±–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤:

**üìù –í–æ–ø—Ä–æ—Å 1:** –ö–∞–∫ –±—É–¥–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–≤–æ–π –∫–ª—É–±?

–ù–∞–ø–∏—à–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä: "–®–∞—Ö–º–∞—Ç–Ω–∞—è –ê–∫–∞–¥–µ–º–∏—è", "–ö–ª—É–± –ª—é–±–∏—Ç–µ–ª–µ–π –∫–Ω–∏–≥" –∏ —Ç.–¥."""

        return response_template, state_id

    def handle_club_creation_step(self, message, user_email, state_id):
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —à–∞–≥ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—É–±–∞"""
        state = self._get_state(state_id)
        current_step = state.get('step')
        club_data = state.get('data', {})

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        if current_step == 'name':
            club_name = message.strip()
            club_data['name'] = club_name
            state['data'] = club_data
            state['step'] = 'description'
            self._save_state(state_id, state)

            # –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–∑–≤–∞–Ω–∏—è
            try:
                from ai_context import SiteContext
                name_lower = club_name.lower()

                # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
                if any(word in name_lower for word in ['—à–∞—Ö–º–∞—Ç', '–≥–∞–º–±–∏—Ç', '—à–∞—à–∫–∏']):
                    category_hint = "–∏–≥—Ä–æ–≤–æ–π/–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–π"
                    activity_examples = "—à–∞—Ö–º–∞—Ç–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä—ã, —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ –∏–≥—Ä—ã, –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ –±–∞—Ç—Ç–ª—ã"
                    target_audience = "—à–∫–æ–ª—å–Ω–∏–∫–æ–≤, —Å—Ç—É–¥–µ–Ω—Ç–æ–≤, –ª—é–±–∏—Ç–µ–ª–µ–π –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∏–≥—Ä"
                elif any(word in name_lower for word in ['–º—É–∑—ã–∫', '—Å—Ü–µ–Ω–∞', '–∑–≤—É–∫', '—Ä–∏—Ç–º']):
                    category_hint = "–º—É–∑—ã–∫–∞–ª—å–Ω–æ–π"
                    activity_examples = "–º—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –≤–µ—á–µ—Ä–∞, jam-—Å–µ–π—à–µ–Ω—ã, –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è, –º—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã"
                    target_audience = "–ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤, –º–æ–ª–æ–¥–µ–∂–∏, –º—É–∑—ã–∫–∞–Ω—Ç–æ–≤, –ø–µ–≤—Ü–æ–≤"
                elif any(word in name_lower for word in ['—Å–ø–æ—Ä—Ç', '—Ñ–∏—Ç–Ω–µ—Å', '—Ç—Ä–µ–Ω–∞–∂']):
                    category_hint = "—Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–π"
                    activity_examples = "—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è, —Ñ–∏—Ç–Ω–µ—Å-–≤–µ—á–µ—Ä–∞, —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä—ã"
                    target_audience = "–ª—é–±–∏—Ç–µ–ª–µ–π —Å–ø–æ—Ä—Ç–∞, –∞—Ç–ª–µ—Ç–æ–≤, –≤—Å–µ—Ö –∫—Ç–æ —Ö–æ—á–µ—Ç –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–µ"
                elif any(word in name_lower for word in ['–∏–≥—Ä–∞', '–∫–∏–±–µ—Ä', '–≥–µ–π–º']):
                    category_hint = "–∏–≥—Ä–æ–≤–æ–π/–∫–∏–±–µ—Ä—Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–π"
                    activity_examples = "–∫–∏–±–µ—Ä—Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä—ã, –∏–≥—Ä–æ–≤—ã–µ –≤–µ—á–µ—Ä–∏–Ω–∫–∏, —Å—Ç—Ä–∏–º—ã, LAN-–ø–∞—Ç–∏"
                    target_audience = "–≥–µ–π–º–µ—Ä–æ–≤, –∫–∏–±–µ—Ä—Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤, –ª—é–±–∏—Ç–µ–ª–µ–π –æ–Ω–ª–∞–π–Ω-–∏–≥—Ä"
                else:
                    category_hint = "—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π"
                    activity_examples = "–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º, –≤—Å—Ç—Ä–µ—á–∏ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤, –æ–±—É—á–∞—é—â–∏–µ —Å–µ—Å—Å–∏–∏"
                    target_audience = "–ª—é–¥–µ–π —Å –ø–æ—Ö–æ–∂–∏–º–∏ —É–≤–ª–µ—á–µ–Ω–∏—è–º–∏ –∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º–∏"

                # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
                sentiment = self.analyze_user_sentiment(club_name)
                if sentiment == 'enthusiastic':
                    response_prefix = "üî• –í–∞—É! –û—Ç–ª–∏—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ! –¢—ã –ø—Ä–æ—Å—Ç–æ –º–æ–ª–æ–¥–µ—Ü! **"
                elif sentiment == 'concerned':
                    response_prefix = "üòä –ó–∞–º–µ—á–∞—Ç–µ–ª—å–Ω–æ! –ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π, —É —Ç–µ–±—è –ø–æ–ª—É—á–∞–µ—Ç—Å—è! **"
                else:
                    response_prefix = "üéµ –û—Ç–ª–∏—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: **"

                return f"""{response_prefix}{club_name}**!

**üìù –í–æ–ø—Ä–æ—Å 2:** –û–ø–∏—à–∏ —Å–≤–æ–π {category_hint} –∫–ª—É–± (–º–∏–Ω–∏–º—É–º 100 —Å–∏–º–≤–æ–ª–æ–≤). –†–∞—Å—Å–∫–∞–∂–∏:
- üí≠ **–ö–æ–Ω—Ü–µ–ø—Ü–∏—è:** –ß–µ–º –±—É–¥–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –∫–ª—É–±?
- üë• **–ê—É–¥–∏—Ç–æ—Ä–∏—è:** –î–ª—è –∫–æ–≥–æ –æ–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω? ({target_audience})
- üéØ **–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è:** –ö–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –±—É–¥–µ—Ç –ø—Ä–æ–≤–æ–¥–∏—Ç—å? ({activity_examples})

üí° **–°–æ–≤–µ—Ç:** –ü–æ–¥—É–º–∞–π, —á—Ç–æ –¥–µ–ª–∞–µ—Ç —Ç–≤–æ–π –∫–ª—É–± —É–Ω–∏–∫–∞–ª—å–Ω—ã–º! –ö–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –æ–Ω —Ä–µ—à–∞–µ—Ç –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤?

üìù **–ü—Ä–∏–º–µ—Ä:** "–≠—Ç–æ –º–µ—Å—Ç–æ –≥–¥–µ {target_audience} –º–æ–≥—É—Ç {activity_examples}. –ú—ã —Å–æ–∑–¥–∞–µ–º –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –¥–ª—è..." """

            except Exception as e:
                # Fallback –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç
                return """‚úÖ –û—Ç–ª–∏—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ!

**üìù –í–æ–ø—Ä–æ—Å 2:** –û–ø–∏—à–∏ —Å–≤–æ–π –∫–ª—É–± (–º–∏–Ω–∏–º—É–º 100 —Å–∏–º–≤–æ–ª–æ–≤). –†–∞—Å—Å–∫–∞–∂–∏:
- –ß–µ–º –±—É–¥–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –∫–ª—É–±
- –î–ª—è –∫–æ–≥–æ –æ–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω
- –ö–∞–∫–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –±—É–¥–µ—Ç –ø—Ä–æ–≤–æ–¥–∏—Ç—å

–ù–∞–ø—Ä–∏–º–µ—Ä: "–≠—Ç–æ –º–µ—Å—Ç–æ –≥–¥–µ –ª—é–±–∏—Ç–µ–ª–∏ —à–∞—Ö–º–∞—Ç –º–æ–≥—É—Ç —Ä–∞–∑–≤–∏–≤–∞—Ç—å –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ, —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ç—É—Ä–Ω–∏—Ä–∞—Ö –∏ –æ–±—â–∞—Ç—å—Å—è —Å –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞–º–∏"."""

        elif current_step == 'description':
            description = message.strip()
            if len(description) < 100:
                return """‚ö†Ô∏è –û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ. –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 100 —Å–∏–º–≤–æ–ª–æ–≤.

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥—Ä–æ–±–Ω–µ–µ —Ä–∞—Å—Å–∫–∞–∂–∏ –æ —Å–≤–æ–µ–º –∫–ª—É–±–µ."""

            club_data['description'] = description
            state['data'] = club_data
            state['step'] = 'category'
            self._save_state(state_id, state)

            return """üìù –û—Ç–ª–∏—á–Ω–æ!

**üìù –í–æ–ø—Ä–æ—Å 3:** –ö –∫–∞–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è —Ç–≤–æ–π –∫–ª—É–±?
–í—ã–±–µ—Ä–∏ –∏–∑:
- –°–ø–æ—Ä—Ç
- –ú—É–∑—ã–∫–∞
- –ò—Å–∫—É—Å—Å—Ç–≤–æ
- –ò–≥—Ä—ã
- –ö–Ω–∏–≥–∏
- –§–∏–ª—å–º—ã
- –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
- –î—Ä—É–≥–æ–µ

–ù–∞–ø–∏—à–∏ –æ–¥–Ω—É –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π."""

        elif current_step == 'category':
            club_data['category'] = message.strip()
            state['data'] = club_data
            state['step'] = 'city'
            self._save_state(state_id, state)

            return """‚úÖ –•–æ—Ä–æ—à–æ!

**üìù –í–æ–ø—Ä–æ—Å 4:** –í –∫–∞–∫–æ–º –≥–æ—Ä–æ–¥–µ –±—É–¥–µ—Ç located —Ç–≤–æ–π –∫–ª—É–±?

–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–ª–º–∞—Ç—ã, –ê—Å—Ç–∞–Ω–∞, –®—ã–º–∫–µ–Ω—Ç –∏ —Ç.–¥."""

        elif current_step == 'city':
            club_data['city'] = message.strip()
            state['data'] = club_data
            state['step'] = 'email'
            self._save_state(state_id, state)

            return """üìù –û—Ç–ª–∏—á–Ω–æ!

**üìù –í–æ–ø—Ä–æ—Å 5:** –ö–∞–∫–æ–π email –¥–ª—è —Å–≤—è–∑–∏ —Å –∫–ª—É–±–æ–º?

–ù–∞–ø—Ä–∏–º–µ—Ä: club@gmail.com, myclub@mail.ru –∏ —Ç.–¥."""

        elif current_step == 'email':
            email = message.strip()
            if '@' not in email:
                return """‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π email –∞–¥—Ä–µ—Å.

–ù–∞–ø—Ä–∏–º–µ—Ä: club@gmail.com"""

            club_data['email'] = email
            state['data'] = club_data
            state['step'] = 'phone'
            self._save_state(state_id, state)

            return """‚úÖ Email –ø—Ä–∏–Ω—è—Ç!

**üìù –í–æ–ø—Ä–æ—Å 6:** –¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
–ï—Å–ª–∏ –Ω–µ —Ö–æ—á–µ—à—å —É–∫–∞–∑—ã–≤–∞—Ç—å, –Ω–∞–ø–∏—à–∏ "–Ω–µ—Ç"

üí° **–§–æ—Ä–º–∞—Ç—ã —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤:**
‚Ä¢ +7 (701) 123-45-67
‚Ä¢ +7 701 123 45 67
‚Ä¢ 8 701 123 45 67
‚Ä¢ 7011234567

üì± **–ü—Ä–∏–º–µ—Ä—ã:** +77011234567, +7 (701) 123-45-67, 87011234567"""

        elif current_step == 'phone':
            phone = message.strip()
            if phone.lower() != '–Ω–µ—Ç':
                club_data['phone'] = phone
            else:
                club_data['phone'] = '+77010000001'  # –¢–µ–ª–µ—Ñ–æ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

            state['data'] = club_data
            state['step'] = 'address'
            self._save_state(state_id, state)

            return """üìù –ü—Ä–∏–Ω—è—Ç–æ!

**üìù –í–æ–ø—Ä–æ—Å 7:** –ê–¥—Ä–µ—Å –≤—Å—Ç—Ä–µ—á –∫–ª—É–±–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
–ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å, –Ω–∞–ø–∏—à–∏ "–Ω–µ—Ç"

–ù–∞–ø—Ä–∏–º–µ—Ä: "–ê–ª–º–∞—Ç—ã, –ø—Ä–æ—Å–ø–µ–∫—Ç –ê–±–∞—è 89" –∏–ª–∏ "–ö–∞—Ñ–µ –≤ —Ü–µ–Ω—Ç—Ä–µ –≥–æ—Ä–æ–¥–∞"."""

        elif current_step == 'address':
            address = message.strip()
            if address.lower() != '–Ω–µ—Ç':
                club_data['address'] = address
            else:
                club_data['address'] = '–ê–ª–º–∞—Ç—ã, —Ü–µ–Ω—Ç—Ä –≥–æ—Ä–æ–¥–∞'  # –ê–¥—Ä–µ—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

            state['data'] = club_data
            self._save_state(state_id, state)

            # –ó–∞–≤–µ—Ä—à–∞–µ–º —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏ —Å–æ–∑–¥–∞–µ–º –∫–ª—É–±
            result = self.create_club(club_data, user_email)
            # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è
            if result and result.get('success'):
                with self._states_lock:
                    if state_id in self._states:
                        del self._states[state_id]
            return result

    def create_club(self, club_data, user_email):
        """–°–æ–∑–¥–∞–µ–º –∫–ª—É–± –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"""
        try:
            from clubs.models import ClubCategory, City
            from accounts.models import User

            # –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
            name = club_data.get('name')
            description = club_data.get('description')
            category_name = club_data.get('category')
            city_name = club_data.get('city', '–ê–ª–º–∞—Ç—ã')
            email = club_data.get('email')
            phone = club_data.get('phone', '+77010000001')
            address = club_data.get('address', '–ê–ª–º–∞—Ç—ã, —Ü–µ–Ω—Ç—Ä –≥–æ—Ä–æ–¥–∞')

            if not name or not description or not category_name or not email:
                return {
                    'success': False,
                    'error': f'–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: name={bool(name)}, description={bool(description)}, category={bool(category_name)}, email={bool(email)}'
                }

            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –æ–ø–∏—Å–∞–Ω–∏—è (–º–∏–Ω–∏–º—É–º 200 —Å–∏–º–≤–æ–ª–æ–≤)
            if len(description) < 200:
                return {
                    'success': False,
                    'error': f'–û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ: {len(description)} —Å–∏–º–≤–æ–ª–æ–≤. –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 200 —Å–∏–º–≤–æ–ª–æ–≤.'
                }

            # –ù–∞–π—Ç–∏ –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            try:
                category = ClubCategory.objects.get(name=category_name, is_active=True)
            except ClubCategory.DoesNotExist:
                # –°–æ–∑–¥–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
                try:
                    category = ClubCategory.objects.get(name='–•–æ–±–±–∏', is_active=True)
                except ClubCategory.DoesNotExist:
                    category = ClubCategory.objects.create(name='–•–æ–±–±–∏', is_active=True)
                    print(f"–°–æ–∑–¥–∞–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è: {category.name}")

            # –ù–∞–π—Ç–∏Êàñ —Å–æ–∑–¥–∞—Ç—å –≥–æ—Ä–æ–¥
            try:
                city = City.objects.get(name=city_name)
            except City.DoesNotExist:
                # –°–æ–∑–¥–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞
                kazakhstan_cities = {
                    '–ê–ª–º–∞—Ç—ã': 'ALA',
                    '–ê—Å—Ç–∞–Ω–∞': 'NQZ',
                    '–ê–∫—Ç–∞—É': 'SCO',
                    '–ê–∫—Ç–æ–±–µ': 'AKX',
                    '–ê—Ç—ã—Ä–∞—É': 'GUW',
                    '–ñ–µ–∑–∫–∞–∑–≥–∞–Ω': 'DZN',
                    '–ö–∞—Ä–∞–≥–∞–Ω–¥–∞': 'KGF',
                    '–ö–æ–∫—à–µ—Ç–∞—É': 'KOJ',
                    '–ö–æ—Å—Ç–∞–Ω–∞–π': 'KSN',
                    '–ö—ã–∑—ã–ª–æ—Ä–¥–∞': 'KZO',
                    '–ü–∞–≤–ª–æ–¥–∞—Ä': 'PWQ',
                    '–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫': 'PGU',
                    '–°–µ–º–µ–π': 'PLX',
                    '–¢–∞–ª–¥—ã–∫–æ—Ä–≥–∞–Ω': 'TIW',
                    '–¢–∞—Ä–∞–∑': 'CUB',
                    '–£—Ä–∞–ª—å—Å–∫': 'URA',
                    '–£—Å—Ç—å-–ö–∞–º–µ–Ω–æ–≥–æ—Ä—Å–∫': 'UKK',
                    '–®—ã–º–∫–µ–Ω—Ç': 'CIT'
                }

                if city_name in kazakhstan_cities:
                    city = City.objects.create(
                        name=city_name,
                        iata_code=kazakhstan_cities[city_name]
                    )
                    print(f"–°–æ–∑–¥–∞–Ω –≥–æ—Ä–æ–¥: {city.name}")
                else:
                    # –°–æ–∑–¥–∞–µ–º –≥–æ—Ä–æ–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ê–ª–º–∞—Ç—ã
                    try:
                        city = City.objects.get(name='–ê–ª–º–∞—Ç—ã')
                    except City.DoesNotExist:
                        city = City.objects.create(
                            name='–ê–ª–º–∞—Ç—ã',
                            iata_code='ALA'
                        )
                        print(f"–°–æ–∑–¥–∞–Ω –≥–æ—Ä–æ–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: {city.name}")

            # –ù–∞–π—Ç–∏ –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            try:
                user = User.objects.get(email=user_email)
            except User.DoesNotExist:
                # –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                try:
                    user = User.objects.get(email='test@fan-club.kz')
                except User.DoesNotExist:
                    user = User.objects.create_user(
                        phone='+77010000001',
                        email='test@fan-club.kz',
                        first_name='–¢–µ—Å—Ç',
                        last_name='–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
                    )
                    print(f"–°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user.email}")

            # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ email
            if '@' not in email:
                return {
                    'success': False,
                    'error': f'–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email: {email}'
                }

            # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
            if phone and phone.lower() != '–Ω–µ—Ç':
                # –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                phone = phone.strip()
                # –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã –∏ –¥–µ—Ñ–∏—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
                clean_phone = phone.replace(' ', '').replace('-', '').replace('(', '').replace(')', '')

                # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç: +7XXXXXXXXXX (12 —Å–∏–º–≤–æ–ª–æ–≤) –∏–ª–∏ 8XXXXXXXXXX (11 —Å–∏–º–≤–æ–ª–æ–≤)
                if clean_phone.startswith('+7') and len(clean_phone) == 12 and clean_phone[2:].isdigit():
                    phone = clean_phone  # —É–∂–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
                elif clean_phone.startswith('8') and len(clean_phone) == 11 and clean_phone.isdigit():
                    phone = '+7' + clean_phone[1:]  # –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º 8... –≤ +7...
                elif len(clean_phone) == 10 and clean_phone.isdigit():
                    phone = '+7' + clean_phone  # –¥–æ–±–∞–≤–ª—è–µ–º +7 –∫ 10-–∑–Ω–∞—á–Ω–æ–º—É –Ω–æ–º–µ—Ä—É
                else:
                    phone = '+77010000001'  # –¢–µ–ª–µ—Ñ–æ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            else:
                phone = '+77010000001'  # –¢–µ–ª–µ—Ñ–æ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

            # –°–æ–∑–¥–∞–µ–º –∫–ª—É–± —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ ForeignKey –ø–æ–ª—è–º–∏
            from clubs.models import Club
            club = Club.objects.create(
                name=name,
                description=description,
                email=email,
                phone=phone,
                address=address,
                category=category,
                creater=user,
                city=city,
                is_active=True,
                members_count=1,
                likes_count=0
            )

            return {
                'success': True,
                'club_id': str(club.id),
                'club_name': club.name,
                'message': f"""üéâ –ö–ª—É–± "{club.name}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!

üìã **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª—É–±–µ:**
üìù **–ù–∞–∑–≤–∞–Ω–∏–µ:** {club.name}
üéØ **–ö–∞—Ç–µ–≥–æ—Ä–∏—è:** {category.name if category else '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}
üèôÔ∏è **–ì–æ—Ä–æ–¥:** {city.name if city else '–ù–µ —É–∫–∞–∑–∞–Ω'}
üìß **Email:** {club.email}
üìû **–¢–µ–ª–µ—Ñ–æ–Ω:** {club.phone}
üìç **–ê–¥—Ä–µ—Å:** {club.address}
üí≠ **–û–ø–∏—Å–∞–Ω–∏–µ:** {club.description[:100]}...

üîó **–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–ª—É–±:** /clubs/{club.id}/

–°–ø–∞—Å–∏–±–æ –∑–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–ª—É–±–∞! üéä"""
            }

        except Exception as e:
            import traceback
            error_details = traceback.format_exc()
            print(f"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—É–±–∞: {str(e)}")
            print(f"–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏: {error_details}")

            # Handle UNIQUE constraint error for club name
            if 'UNIQUE constraint failed: clubs_club.name' in str(e):
                # Try to create a unique name by adding a number
                base_name = name
                counter = 1
                while counter < 100:  # Avoid infinite loop
                    try:
                        unique_name = f"{base_name} {counter}"
                        club = Club.objects.create(
                            name=unique_name,
                            description=description,
                            email=email,
                            phone=phone,
                            address=address,
                            category=category,
                            creater=user,
                            city=city,
                            is_active=True,
                            members_count=1,
                            likes_count=0
                        )
                        return {
                            'success': True,
                            'club_id': str(club.id),
                            'club_name': club.name,
                            'message': f'üéâ –ö–ª—É–± "{club.name}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω! (–ù–∞–∑–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–æ –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏)'
                        }
                    except Exception as retry_e:
                        if 'UNIQUE constraint failed: clubs_club.name' in str(retry_e):
                            counter += 1
                            continue
                        else:
                            break

                return {
                    'success': False,
                    'error': f'–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–∞–∑–≤–∞–Ω–∏–µ "{base_name}" —É–∂–µ –∑–∞–Ω—è—Ç–æ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–≥–æ –∫–ª—É–±–∞.',
                    'suggestion': f'–ü–æ–ø—Ä–æ–±—É–π—Ç–µ: "{base_name} Community", "{base_name} Club", –∏–ª–∏ –ø—Ä–∏–¥—É–º–∞–π—Ç–µ –¥—Ä—É–≥–æ–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ'
                }

            return {
                'success': False,
                'error': f'–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–ª—É–±–∞: {str(e)}',
                'details': error_details
            }

    def detect_filled_form(self, message):
        """–£–ª—É—á—à–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ñ–æ—Ä–º"""
        import re

        # –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã
        patterns = {
            'name': [
                r'–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª—É–±–∞:\s*(.+)',
                r'–ù–∞–∑–≤–∞–Ω–∏–µ:\s*(.+)',
                r'–ö–ª—É–±:\s*(.+)'
            ],
            'description': [
                r'–û–ø–∏—Å–∞–Ω–∏–µ –∫–ª—É–±–∞.*?:\s*(.+)',
                r'–û–ø–∏—Å–∞–Ω–∏–µ:\s*(.+)',
                r'–î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å:\s*(.+)'
            ],
            'category': [
                r'–ö–∞—Ç–µ–≥–æ—Ä–∏—è:\s*(.+)',
                r'–¢–µ–º–∞—Ç–∏–∫–∞:\s*(.+)',
                r'–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:\s*(.+)'
            ],
            'city': [
                r'–ì–æ—Ä–æ–¥:\s*(.+)',
                r'–õ–æ–∫–∞—Ü–∏—è:\s*(.+)',
                r'–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:\s*(.+)'
            ],
            'email': [
                r'Email:\s*(.+)',
                r'Email –∫–ª—É–±–∞:\s*(.+)',
                r'–ü–æ—á—Ç–∞:\s*(.+)',
                r'–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞:\s*(.+)'
            ],
            'phone': [
                r'–¢–µ–ª–µ—Ñ–æ–Ω:\s*(.+)',
                r'Phone:\s*(.+)',
                r'–ö–æ–Ω—Ç–∞–∫—Ç:\s*(.+)'
            ],
            'address': [
                r'–ê–¥—Ä–µ—Å:\s*(.+)',
                r'–ú–µ—Å—Ç–æ –≤—Å—Ç—Ä–µ—á:\s*(.+)',
                r'Address:\s*(.+)'
            ]
        }

        extracted_data = {}
        message_lines = message.split('\n')


        for i, line in enumerate(message_lines):
            line = line.strip()
            if not line:
                continue

            for field, field_patterns in patterns.items():
                for j, pattern in enumerate(field_patterns):
                    match = re.search(pattern, line, re.IGNORECASE)
                    if match:
                        value = match.group(1).strip()
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∞
                        if len(value) > 0 and not value.endswith(':') and not value.endswith('Ôºö'):
                            extracted_data[field] = value
                            break


        # –§–æ—Ä–º–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–π, –µ—Å–ª–∏ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –∏–º—è –∏ –æ–ø–∏—Å–∞–Ω–∏–µ
        required_fields = ['name', 'description']
        if all(field in extracted_data for field in required_fields):
            return extracted_data

        return None

    def process_filled_form(self, filled_form, user_email, state_id):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Ñ–æ—Ä–º—ã - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª—É–±–∞"""
        try:

            # –°–æ–∑–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–ª—É–±–∞
            club_data = {
                'name': filled_form.get('name'),
                'description': filled_form.get('description'),
                'category': filled_form.get('category', '–•–æ–±–±–∏'),
                'city': filled_form.get('city', '–ê–ª–º–∞—Ç—ã'),
                'email': filled_form.get('email', user_email or 'unknown@example.com'),
                'phone': filled_form.get('phone', '+77010000001'),
                'address': filled_form.get('address', '–ê–ª–º–∞—Ç—ã, —Ü–µ–Ω—Ç—Ä –≥–æ—Ä–æ–¥–∞')
            }


            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
            if not club_data['name'] or not club_data['description']:
                return {
                    'message': f'‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∫–ª—É–±: –Ω–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. name: "{club_data["name"]}", description: "{club_data["description"][:50]}..."',
                    'type': 'text',
                    'timestamp': '2025-11-25T18:08:16.072780',
                    'message_id': 2993826976213848717,
                    'success': False
                }

            # –°–æ–∑–¥–∞–µ–º –∫–ª—É–±
            result = self.create_club(club_data, user_email)


            if result.get('success'):
                club_name = club_data['name']
                return ({
                    'message': f'üéâ –û—Ç–ª–∏—á–Ω–æ! –ö–ª—É–± "{club_name}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!\n\n'
                              f'üìß –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π email: {club_data["email"]}\n'
                              f'üèôÔ∏è –ì–æ—Ä–æ–¥: {club_data["city"]}\n'
                              f'üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {club_data["category"]}\n\n'
                              f'–¢–µ–ø–µ—Ä—å —Ç–≤–æ–π –∫–ª—É–± –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ! üöÄ',
                    'type': 'text',
                    'timestamp': '2025-11-25T18:08:16.072780',
                    'message_id': 2993826976213848717,
                    'success': True
                }, state_id)
            else:
                error_msg = result.get("error", "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞")
                return ({
                    'message': f'‚ùå –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∫–ª—É–±: {error_msg}',
                    'type': 'text',
                    'timestamp': '2025-11-25T18:08:16.072780',
                    'message_id': 2993826976213848717,
                    'success': False
                }, state_id)

        except Exception as e:
            return ({
                'message': f'‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ä–º—ã: {str(e)}',
                'type': 'text',
                'timestamp': '2025-11-25T18:08:16.072780',
                'message_id': 2993826976213848717,
                'success': False
            }, state_id)

    def process_user_message(self, message, user_email=None, state_id=None):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º —Å–æ–∑–¥–∞–Ω–∏–µ–º –∫–ª—É–±–∞"""
        message_lower = message.lower().strip()

        # –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π (—Ä–∞–∑ –≤ 100 –≤—ã–∑–æ–≤–æ–≤)
        if len(self._states) % 100 == 0:
            self._cleanup_old_states()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        if not state_id:
            state_id = self._get_or_create_state_id()

        # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        state = self._get_state(state_id)
        current_step = state.get('step')

        # –ü–†–ò–û–†–ò–¢–ï–¢ 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Ñ–æ—Ä–º–æ–π (–î–ê–ñ–ï –ï–°–õ–ò –ï–°–¢–¨ –ö–õ–Æ–ß–ï–í–´–ï –°–õ–û–í–ê)
        filled_form = self.detect_filled_form(message)
        if filled_form:
            response = self.process_filled_form(filled_form, user_email, state_id)
            return response, state_id

        # –ü–†–ò–û–†–ò–¢–ï–¢ 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—É–±–∞
        if current_step:
            response = self.handle_club_creation_step(message, user_email, state_id)
            return response, state_id

        # –ü–†–ò–û–†–ò–¢–ï–¢ 3: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª—É–±–∞ (–¢–û–õ–¨–ö–û –ï–°–õ–ò –ù–ï–¢ –ó–ê–ü–û–õ–ù–ï–ù–ù–û–ô –§–û–†–ú–´)
        if any(keyword in message_lower for keyword in ['—Å–æ–∑–¥–∞—Ç—å', '—Å–æ–∑–¥–∞–Ω–∏–µ', '—Ö–æ—á—É —Å–æ–∑–¥–∞—Ç—å', '—Å–¥–µ–ª–∞—Ç—å', 'fan-club', 'club creation', 'create club', 'make club', 'start club']):
            response, new_state_id = self.start_club_creation(message, state_id)
            return response, new_state_id

        # –ü–†–ò–û–†–ò–¢–ï–¢ 4: –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—Ä—É–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã
        if any(keyword in message_lower for keyword in ['–∫–ª—É–±', '—Ñ–∞–Ω-–∫–ª—É–±', 'club', 'fan']):
            response = self.ai.process_user_message(message, user_email)
            return response, state_id

        # –ü–†–ò–û–†–ò–¢–ï–¢ 5: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç
        response = self.ai.process_user_message(message, user_email)
        return response, state_id