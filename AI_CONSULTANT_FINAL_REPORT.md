# üîç –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç - AI Consultant Agent

**–î–∞—Ç–∞:** 2025-11-21  
**–ü—Ä–æ–±–ª–µ–º–∞:** AI –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–ª—É–±—ã  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û –ò–°–ü–†–ê–í–õ–ï–ù–û** - —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞

---

## üìã –ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

### –ß—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ:
```
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü—Ä–∏–≤–µ—Ç! üòä"
ü§ñ AI: "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ —è –º–æ–≥—É –ø–æ–º–æ—á—å?"

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–°–æ–∑–¥–∞–π –∫–ª—É–±"
ü§ñ AI: "–ö–∞–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∫–ª—É–±–æ–≤ —Ç—ã –∏—â–µ—à—å? –°–ø–æ—Ä—Ç, –•–æ–±–±–∏ –∏–ª–∏ –ü—Ä–æ—Ñ–µ—Å—Å–∏—è?"
                    ‚¨ÜÔ∏è –û–®–ò–ë–ö–ê - AI –Ω–µ –ø–æ–Ω—è–ª —á—Ç–æ –Ω—É–∂–Ω–æ –°–û–ó–î–ê–¢–¨, –∞ –Ω–µ –ò–°–ö–ê–¢–¨

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–Ø –Ω–µ –∏—â—É –∫–ª—É–± —è —Ö–æ—á—É —Å–æ–∑–¥–∞—Ç—å"
ü§ñ AI: "–ö–∞–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∫–ª—É–±–æ–≤ —Ç—ã –∏—â–µ—à—å?"
                    ‚¨ÜÔ∏è –ó–ê–¶–ò–ö–õ–ò–í–ê–ù–ò–ï - AI –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø—Ä–æ –ø–æ–∏—Å–∫
```

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (17 –∏—Ç–µ—Ä–∞—Ü–∏–π)

### –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

#### 1. **Router –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ö–æ—Ä–æ—à–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–ª –Ω–∞–º–µ—Ä–µ–Ω–∏–µ "—Å–æ–∑–¥–∞—Ç—å"**
   - **–§–∞–π–ª:** `ai_consultant/agents/router.py`
   - **–ü—Ä–æ–±–ª–µ–º–∞:** –ú–∞–ª–æ –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—É–±–∞
   - **–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —è–≤–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏ –ø—Ä–∞–≤–∏–ª–∞

#### 2. **ClubAgent –ø—Ä–æ–º–ø—Ç –±—ã–ª —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–º**
   - **–§–∞–π–ª:** `ai_consultant/agents/specialists/club_agent.py`  
   - **–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–ø—Ä–µ—Ç –Ω–∞ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª —Ä–µ–∂–∏–º —Å–æ–∑–¥–∞–Ω–∏—è
   - **–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ü–û–ò–°–ö vs –°–û–ó–î–ê–ù–ò–ï

#### 3. **‚ö†Ô∏è –ì–õ–ê–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: Router –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –ö–ê–ñ–î–û–ì–û —Å–æ–æ–±—â–µ–Ω–∏—è**
   - **–§–∞–π–ª:** `ai_consultant/services/chat.py:97`
   - **–ü—Ä–æ–±–ª–µ–º–∞:** `agent_name = self.router.route(message, history)` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑
   - **–†–µ–∑—É–ª—å—Ç–∞—Ç:** AI —Ç–µ—Ä—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ orchestrator
   - **–†–µ—à–µ–Ω–∏–µ:** ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

---

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (–ò—Ç–µ—Ä–∞—Ü–∏–∏ 1-17)

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: Router –ø—Ä–æ–º–ø—Ç —É–ª—É—á—à–µ–Ω

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```python
üö® –ö–†–ò–¢–ò–ß–ù–û - –†–ê–°–ü–û–ó–ù–ê–í–ê–ô –ù–ê–ú–ï–†–ï–ù–ò–ï –°–û–ó–î–ê–¢–¨:
–ï—Å–ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –µ—Å—Ç—å —Å–ª–æ–≤–∞ "—Å–æ–∑–¥–∞—Ç—å", "—Å–æ–∑–¥–∞–π", "—Ö–æ—á—É —Å–æ–∑–¥–∞—Ç—å":
‚Üí –í–°–ï–ì–î–ê club_specialist (–¥–∞–∂–µ –µ—Å–ª–∏ –µ—Å—Ç—å —Å–ª–æ–≤–æ "–∏—â—É")

–ë) –°–û–ó–î–ê–ù–ò–ï –∫–ª—É–±–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç create_club):
   - "–°–æ–∑–¥–∞–π –∫–ª—É–±"
   - "–•–æ—á—É —Å–æ–∑–¥–∞—Ç—å –∫–ª—É–±"
   - "–Ø –Ω–µ –∏—â—É –∫–ª—É–±, —è —Ö–æ—á—É —Å–æ–∑–¥–∞—Ç—å"
   - "–ù–µ –∏—â—É –∫–ª—É–±, —Ö–æ—á—É —Å–æ–∑–¥–∞—Ç—å"
   - –õ–Æ–ë–´–ï —Ñ—Ä–∞–∑—ã –ø—Ä–æ –°–û–ó–î–ê–ù–ò–ï/–°–û–ó–î–ê–¢–¨ –∫–ª—É–± ‚Üí club_specialist
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: ClubAgent –ø—Ä–æ–º–ø—Ç –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω

**–ë—ã–ª–æ:**
```python
üö®üö®üö® –ö–†–ò–¢–ò–ß–ù–û - –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ó–ê–ü–†–ï–¢ –ù–ê –ì–ê–õ–õ–Æ–¶–ò–ù–ê–¶–ò–ò
‚ùå –ù–ò–ö–û–ì–î–ê –Ω–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π –Ω–∞–∑–≤–∞–Ω–∏—è –∫–ª—É–±–æ–≤
```

**–°—Ç–∞–ª–æ:**
```python
üéØ –¢–í–û–Ø –ì–õ–ê–í–ù–ê–Ø –ó–ê–î–ê–ß–ê:
1. –ü–æ–º–æ–≥–∞—Ç—å –ª—é–¥—è–º –ù–ê–•–û–î–ò–¢–¨ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª—É–±—ã (—á–µ—Ä–µ–∑ search_clubs)
2. –ü–æ–º–æ–≥–∞—Ç—å –ª—é–¥—è–º –°–û–ó–î–ê–í–ê–¢–¨ –Ω–æ–≤—ã–µ –∫–ª—É–±—ã (—á–µ—Ä–µ–∑ create_club)

üö® –ö–†–ò–¢–ò–ß–ù–û - –†–ê–ó–õ–ò–ß–ê–ô –ù–ê–ú–ï–†–ï–ù–ò–Ø:

üìç –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –ù–ê–ô–¢–ò/–ò–°–ö–ê–¢–¨ –∫–ª—É–±:
- –ò—Å–ø–æ–ª—å–∑—É–π search_clubs

üèóÔ∏è –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –°–û–ó–î–ê–¢–¨ –∫–ª—É–±:
- –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π search_clubs
- –ù–∞—á–∏–Ω–∞–π —Å–æ–±–∏—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è create_club

‚úÖ –ù–û –ø—Ä–∏ –°–û–ó–î–ê–ù–ò–ò –∫–ª—É–±–∞:
- –¢–´ –ú–û–ñ–ï–®–¨ —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ
- –¢–´ –ú–û–ñ–ï–®–¨ –ø–æ–º–æ–≥–∞—Ç—å —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3: –î–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

```python
‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ù–û: –†–ê–°–ü–û–ó–ù–ê–í–ê–ù–ò–ï –ù–ê–ú–ï–†–ï–ù–ò–Ø –°–û–ó–î–ê–¢–¨ –ö–õ–£–ë**

–ü–†–ê–í–ò–õ–¨–ù–´–ô –û–¢–í–ï–¢ –Ω–∞ "–Ø —Ö–æ—á—É —Å–æ–∑–¥–∞—Ç—å –∫–ª—É–±":
"–û—Ç–ª–∏—á–Ω–æ! –î–∞–≤–∞–π —Å–æ–∑–¥–∞–¥–∏–º —Ç–≤–æ–π –∫–ª—É–±! üéØ
–®–∞–≥ 1: –ö–∞–∫ –Ω–∞–∑–æ–≤–µ–º –∫–ª—É–±?"

–ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ô –û–¢–í–ï–¢ (‚ùå –ù–ò–ö–û–ì–î–ê –¢–ê–ö):
"–ö–∞–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∫–ª—É–±–æ–≤ —Ç—ã –∏—â–µ—à—å?" ‚Üê –≠–¢–û –û–®–ò–ë–ö–ê!
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 4: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ predictive_engine

**–§–∞–π–ª:** `ai_consultant/utils/predictive_engine.py`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç None context –≤ 4 –º–µ—Ç–æ–¥–∞—Ö.

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –¢–µ—Å—Ç 1: "–•–æ—á—É —Å–æ–∑–¥–∞—Ç—å –∫–ª—É–±"
```
üë§: "–•–æ—á—É —Å–æ–∑–¥–∞—Ç—å –∫–ª—É–±"
ü§ñ: "–ö–∞–∫–æ–π –∫–ª—É–± —Ç—ã —Ö–æ—á–µ—à—å —Å–æ–∑–¥–∞—Ç—å? üòä"
```
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ! AI –ø–æ–Ω–∏–º–∞–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ, –Ω–æ –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å

### –¢–µ—Å—Ç 2: "–Ø –Ω–µ –∏—â—É –∫–ª—É–± —è —Ö–æ—á—É —Å–æ–∑–¥–∞—Ç—å"
```
üë§: "–Ø –Ω–µ –∏—â—É –∫–ª—É–± —è —Ö–æ—á—É —Å–æ–∑–¥–∞—Ç—å"
ü§ñ: "–ö–∞–∫ —è –º–æ–≥—É –ø–æ–º–æ—á—å —Ç–µ–±–µ —Å–µ–≥–æ–¥–Ω—è? ...–ï—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–π –∫–ª—É–±, –ø—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏! üéâ"
```
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ - AI –ø–æ–Ω–∏–º–∞–µ—Ç, –Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –æ–±—â–µ–º—É –æ—Ç–≤–µ—Ç—É

### –¢–µ—Å—Ç 3: –ü–æ–ª–Ω—ã–π –¥–∏–∞–ª–æ–≥ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—É–±–∞
```
üë§: "–•–æ—á—É —Å–æ–∑–¥–∞—Ç—å –∫–ª—É–±"
ü§ñ: "–ö–∞–∫ —è –º–æ–≥—É –ø–æ–º–æ—á—å..." (–æ–±—â–∏–π –æ—Ç–≤–µ—Ç)

üë§: "–®–∞—Ö–º–∞—Ç–Ω—ã–π –∫–ª—É–± –ê–ª–º–∞—Ç—ã"
ü§ñ: "–ö–∞–∫ —è –º–æ–≥—É –ø–æ–º–æ—á—å..." (–ø–æ—Ç–µ—Ä—è–ª –∫–æ–Ω—Ç–µ–∫—Å—Ç)

üë§: (–æ–ø–∏—Å–∞–Ω–∏–µ –∫–ª—É–±–∞)
ü§ñ: "–ö–∞–∫–æ–π –∫–ª—É–± —Ç—ã —Ö–æ—á–µ—à—å —Å–æ–∑–¥–∞—Ç—å?" (—Å–Ω–æ–≤–∞ –æ–±—â–∏–π –≤–æ–ø—Ä–æ—Å)
```
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - AI —Ç–µ—Ä—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

---

## üêõ –ì–õ–ê–í–ù–ê–Ø –ù–ï–†–ï–®–ï–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∞–≥–µ–Ω—Ç–∞

**–ö–æ–¥ –ø—Ä–æ–±–ª–µ–º—ã** (`ai_consultant/services/chat.py:97`):
```python
def send_message(self, session, message):
    # ...
    history = self.get_history(session, limit=5)
    
    # ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê: –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –ö–ê–ñ–î–û–ì–û —Å–æ–æ–±—â–µ–Ω–∏—è!
    agent_name = self.router.route(message, history)
    # ...
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–•–æ—á—É —Å–æ–∑–¥–∞—Ç—å –∫–ª—É–±"
2. Router ‚Üí club_specialist ‚úÖ
3. AI: "–ö–∞–∫–æ–π –∫–ª—É–±?"
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–®–∞—Ö–º–∞—Ç–Ω—ã–π –∫–ª—É–±"
5. Router ‚Üí orchestrator ‚ùå (–ø–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞!)
6. AI: "–ö–∞–∫ —è –º–æ–≥—É –ø–æ–º–æ—á—å?" (–æ–±—â–∏–π –æ—Ç–≤–µ—Ç)

**–ü–æ—á–µ–º—É:**
- Router –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ + –∫–æ—Ä–æ—Ç–∫—É—é –∏—Å—Ç–æ—Ä–∏—é
- –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–º—ã –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—É–±–∞"
- –ö–∞–∂–¥–æ–µ –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ä–æ—É—Ç–∏—Ç—Å—è –∑–∞–Ω–æ–≤–æ

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: –°–æ—Ö—Ä–∞–Ω—è—Ç—å current_agent –≤ —Å–µ—Å—Å–∏–∏ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

**–î–æ–±–∞–≤–∏—Ç—å –≤ –º–æ–¥–µ–ª—å ChatSession:**
```python
class ChatSession(models.Model):
    # ...—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
    current_agent = models.CharField(max_length=50, null=True, blank=True)
    agent_context = models.JSONField(null=True, blank=True)  # –î–ª—è state
```

**–ò–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –≤ chat.py:**
```python
def send_message(self, session, message):
    history = self.get_history(session, limit=5)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–π –∞–≥–µ–Ω—Ç
    if session.current_agent:
        # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å —Ç–µ–∫—É—â–∏–º –∞–≥–µ–Ω—Ç–æ–º
        agent_name = session.current_agent
        logger.info(f"üìå –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –∞–≥–µ–Ω—Ç–æ–º: {agent_name}")
    else:
        # –†–æ—É—Ç–∏–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
        agent_name = self.router.route(message, history)
        session.current_agent = agent_name
        session.save()
        logger.info(f"üÜï –ù–æ–≤—ã–π –∞–≥–µ–Ω—Ç: {agent_name}")
    
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
```

**–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–±—Ä–æ—Å–∞ –∞–≥–µ–Ω—Ç–∞:**
```python
# –í –∫–æ–Ω—Ü–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—É–±–∞ –∏–ª–∏ –ø—Ä–∏ —è–≤–Ω–æ–π —Å–º–µ–Ω–µ —Ç–µ–º—ã
if "—Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ" in response or user_wants_change_topic:
    session.current_agent = None
    session.agent_context = None
    session.save()
```

### –†–µ—à–µ–Ω–∏–µ 2: –£–ª—É—á—à–∏—Ç—å Router –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

**–ò–∑–º–µ–Ω–∏—Ç—å router.route() –¥–ª—è —É—á–µ—Ç–∞ –∏—Å—Ç–æ—Ä–∏–∏:**
```python
def route(self, message: str, history: List[Dict]) -> str:
    # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    recent_context = "\n".join([
        f"{h.get('role')}: {h.get('content')[:100]}" 
        for h in history[-3:]
    ])
    
    messages = [
        {"role": "system", "content": self.system_prompt},
        {"role": "user", "content": f"–ò—Å—Ç–æ—Ä–∏—è:\n{recent_context}\n\n–¢–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: {message}"}
    ]
    # ...
```

### –†–µ—à–µ–Ω–∏–µ 3: State Machine –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è

**–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
```python
CREATION_STATES = {
    'IDLE': '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞',
    'COLLECTING_NAME': '–°–±–æ—Ä –Ω–∞–∑–≤–∞–Ω–∏—è –∫–ª—É–±–∞',
    'COLLECTING_DESCRIPTION': '–°–±–æ—Ä –æ–ø–∏—Å–∞–Ω–∏—è',
    'COLLECTING_CATEGORY': '–°–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏',
    'COLLECTING_CITY': '–°–±–æ—Ä –≥–æ—Ä–æ–¥–∞',
    'CONFIRMING': '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö',
    'CREATING': '–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—É–±–∞'
}
```

---

## üéØ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

| –§—É–Ω–∫—Ü–∏—è | –†–∞–±–æ—Ç–∞–µ—Ç | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|---------|----------|-------------|
| –ü–æ–∏—Å–∫ –∫–ª—É–±–æ–≤ | ‚úÖ –î–ê | search_clubs —Ä–∞–±–æ—Ç–∞–µ—Ç |
| AI —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç "—Å–æ–∑–¥–∞—Ç—å –∫–ª—É–±" | ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û | Router –ø–æ–Ω–∏–º–∞–µ—Ç, –Ω–æ —Ç–µ—Ä—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç |
| –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è | ‚ùå –ù–ï–¢ | AI –Ω–µ —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç state |
| –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—É–±–∞ —á–µ—Ä–µ–∑ create_club | ‚ùì –ù–ï–ò–ó–í–ï–°–¢–ù–û | Tool –µ—Å—Ç—å, –Ω–æ –¥–æ –Ω–µ–≥–æ –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∫–ª—É–±–∞–º–∏ | ‚ùì –ù–ï –¢–ï–°–¢–ò–†–û–í–ê–õ–û–°–¨ | |

---

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–≤—Å–µ–≥–æ 3)

1. ‚úÖ `ai_consultant/agents/router.py` - —É–ª—É—á—à–µ–Ω prompt routing
2. ‚úÖ `ai_consultant/agents/specialists/club_agent.py` - –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω prompt
3. ‚úÖ `ai_consultant/utils/predictive_engine.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ None

---

## üöÄ –ü–ª–∞–Ω –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (–¥–ª—è —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞):

1. **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ current_agent –≤ ChatSession**
   ```bash
   python manage.py makemigrations
   python manage.py migrate
   ```

2. **–ò–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É routing –≤ chat.py**
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å current_agent –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Ä–æ—É—Ç–∏–Ω–≥–µ
   - –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Å —Ç–µ–º –∂–µ –∞–≥–µ–Ω—Ç–æ–º –ø–æ–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω
   - –°–±—Ä–∞—Å—ã–≤–∞—Ç—å –∞–≥–µ–Ω—Ç–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∏–ª–∏ —Å–º–µ–Ω–µ —Ç–µ–º—ã

3. **–î–æ–±–∞–≤–∏—Ç—å detection –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞**
   - –£—Å–ø–µ—à–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª—É–±–∞ ‚Üí —Å–±—Ä–æ—Å agent
   - –Ø–≤–Ω–∞—è —Å–º–µ–Ω–∞ —Ç–µ–º—ã ‚Üí —Å–±—Ä–æ—Å agent
   - Timeout (10+ —Å–æ–æ–±—â–µ–Ω–∏–π) ‚Üí —Å–±—Ä–æ—Å agent

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (–¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è):

4. **–î–æ–±–∞–≤–∏—Ç—å state management**
   - agent_context JSON –ø–æ–ª–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —à–∞–≥–æ–≤ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—É–±–∞

5. **–£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã**
   - –ë–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–∏–∞–ª–æ–≥–æ–≤
   - –ß–µ—Ç—á–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞

6. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - Unit —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è
   - E2E —Ç–µ—Å—Ç—ã –ø–æ–ª–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —Ä–∞–±–æ—Ç—ã

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –ò—Ç–µ—Ä–∞—Ü–∏–π –∑–∞—Ç—Ä–∞—á–µ–Ω–æ | 17 |
| –§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ | 3 |
| –¢–µ—Å—Ç–æ–≤ –ø—Ä–æ–≤–µ–¥–µ–Ω–æ | 6+ |
| –ü—Ä–æ–±–ª–µ–º –Ω–∞–π–¥–µ–Ω–æ | 4 |
| –ü—Ä–æ–±–ª–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | 3 |
| –ü—Ä–æ–±–ª–µ–º –æ—Å—Ç–∞–µ—Ç—Å—è | 1 (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è) |

---

## üí¨ –ò—Ç–æ–≥–æ–≤—ã–µ –≤—ã–≤–æ–¥—ã

### ‚úÖ –ß—Ç–æ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ:

1. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≥–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞** - –ø–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∞–≥–µ–Ω—Ç–∞
2. **–£–ª—É—á—à–µ–Ω—ã –ø—Ä–æ–º–ø—Ç—ã** - router –∏ club_agent –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞—é—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏—è
3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞** - predictive_engine –±–æ–ª—å—à–µ –Ω–µ –ø–∞–¥–∞–µ—Ç
4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª** - –≤—ã—è–≤–ª–µ–Ω—ã —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞

### ‚ö†Ô∏è –ß—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—É–±–æ–≤ —á–µ—Ä–µ–∑ –¥–∏–∞–ª–æ–≥** - AI —Ç–µ—Ä—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
2. **State management** - –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞
3. **–ü–æ–ª–Ω—ã–π flow** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª—É–±–∞

### üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

**–î–ª—è —Ä–∞–±–æ—á–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –Ω—É–∂–Ω–æ:**
- –î–æ–±–∞–≤–∏—Ç—å `current_agent` –ø–æ–ª–µ –≤ ChatSession
- –ò–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É routing –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –î–æ–±–∞–≤–∏—Ç—å detection –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞

**–û—Ü–µ–Ω–∫–∞ —Ä–∞–±–æ—Ç:** ~2-3 —á–∞—Å–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ + —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìû –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ?

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–π—á–∞—Å
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –†–µ—à–µ–Ω–∏–µ 1 (current_agent –≤ —Å–µ—Å—Å–∏–∏) - –∑–∞–π–º–µ—Ç ~15 –∏—Ç–µ—Ä–∞—Ü–∏–π

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —á–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚úÖ –ü–æ–∏—Å–∫ –∫–ª—É–±–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ AI –ø–æ–Ω–∏–º–∞–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ —Å–æ–∑–¥–∞—Ç—å
- ‚ùå –ù–æ –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å workaround
–°–æ–∑–¥–∞–≤–∞—Ç—å –∫–ª—É–±—ã —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—É—é —Ñ–æ—Ä–º—É –Ω–∞ —Å–∞–π—Ç–µ, –∞ AI —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–∏—Å–∫–∞

---

**–í—ã–±–æ—Ä –∑–∞ –≤–∞–º–∏!** –ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å? üòä
