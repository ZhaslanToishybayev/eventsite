#!/usr/bin/env python3
"""
AI Agent for UnitySphere - fan-club.kz
Provides AI assistance for club management and user support
"""

import os
import openai
from dotenv import load_dotenv
import json

# Load environment variables
load_dotenv()

class UnitySphereAIAgent:
    def __init__(self):
        self.api_key = os.getenv('OPENAI_API_KEY')
        self.model = os.getenv('OPENAI_MODEL', 'gpt-4o-mini')
        self.client = openai.OpenAI(api_key=self.api_key)

    def get_club_creation_advice(self, club_type, interests, goals):
        """–ü–æ–º–æ–≥–∞–µ—Ç —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º –∫–ª—É–±–∞"""
        prompt = f"""
        –ü–æ–º–æ–≥–∏ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–Ω-–∫–ª—É–± –¥–ª—è UnitySphere (fan-club.kz).

        –¢–∏–ø –∫–ª—É–±–∞: {club_type}
        –ò–Ω—Ç–µ—Ä–µ—Å—ã: {interests}
        –¶–µ–ª–∏: {goals}

        –ü—Ä–µ–¥–ª–æ–∂–∏:
        1. –ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª—É–±–∞
        2. –û–ø–∏—Å–∞–Ω–∏–µ –∫–ª—É–±–∞
        3. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        4. –ö–∞–∫ –ø—Ä–∏–≤–ª–µ—á—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        5. –ò–¥–µ–∏ –¥–ª—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π

        –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–º.
        """

        try:
            response = self.client.chat.completions.create(
                model=self.model,
                messages=[
                    {"role": "system", "content": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Ñ–∞–Ω-–∫–ª—É–±–æ–≤ –∏ —Å–æ–æ–±—â–µ—Å—Ç–≤. –ü–æ–º–æ–≥–∞–µ—à—å –ª—é–¥—è–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª—É–±—ã."},
                    {"role": "user", "content": prompt}
                ],
                max_tokens=1000,
                temperature=0.7
            )
            return response.choices[0].message.content
        except Exception as e:
            return f"–ò–∑–≤–∏–Ω–∏—Ç–µ, –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–æ–≤–µ—Ç–æ–≤: {str(e)}"

    def get_event_ideas(self, club_type, budget, audience_size):
        """–ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∏–¥–µ–∏ –¥–ª—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π"""
        prompt = f"""
        –ü—Ä–µ–¥–ª–æ–∂–∏ –∏–¥–µ–∏ –¥–ª—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π —Ñ–∞–Ω-–∫–ª—É–±–∞.

        –¢–∏–ø –∫–ª—É–±–∞: {club_type}
        –ë—é–¥–∂–µ—Ç: {budget}
        –†–∞–∑–º–µ—Ä –∞—É–¥–∏—Ç–æ—Ä–∏–∏: {audience_size}

        –ü—Ä–µ–¥–ª–æ–∂–∏ 5-7 –∏–¥–µ–π –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π, —É—á–∏—Ç—ã–≤–∞—è:
        - –ò–Ω—Ç–µ—Ä–µ—Å—ã —Ñ–∞–Ω–∞—Ç–æ–≤
        - –î–æ—Å—Ç—É–ø–Ω—ã–π –±—é–¥–∂–µ—Ç
        - –§–æ—Ä–º–∞—Ç (–æ–Ω–ª–∞–π–Ω/–æ—Ñ–ª–∞–π–Ω)
        - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –≤–æ–≤–ª–µ—á–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

        –û—Ç–≤–µ—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.
        """

        try:
            response = self.client.chat.completions.create(
                model=self.model,
                messages=[
                    {"role": "system", "content": "–¢—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –¥–ª—è —Ñ–∞–Ω-–∫–ª—É–±–æ–≤. –ü—Ä–µ–¥–ª–∞–≥–∞–µ—à—å –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ –∏ —Ä–µ–∞–ª–∏–∑—É–µ–º—ã–µ –∏–¥–µ–∏."},
                    {"role": "user", "content": prompt}
                ],
                max_tokens=800,
                temperature=0.8
            )
            return response.choices[0].message.content
        except Exception as e:
            return f"–ò–∑–≤–∏–Ω–∏—Ç–µ, –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–¥–µ–π: {str(e)}"

    def get_community_engagement_tips(self, club_type, member_count):
        """–°–æ–≤–µ—Ç—ã –ø–æ –≤–æ–≤–ª–µ—á–µ–Ω–∏—é —Å–æ–æ–±—â–µ—Å—Ç–≤–∞"""
        prompt = f"""
        –î–∞–π —Å–æ–≤–µ—Ç—ã –ø–æ –≤–æ–≤–ª–µ—á–µ–Ω–∏—é —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ —Ñ–∞–Ω-–∫–ª—É–±.

        –¢–∏–ø –∫–ª—É–±–∞: {club_type}
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: {member_count}

        –ü—Ä–µ–¥–ª–æ–∂–∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã:
        1. –ö–∞–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
        2. –ö–∞–∫–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ª—É—á—à–µ –≤—Å–µ–≥–æ
        3. –ö–∞–∫ –≤—ã—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é
        4. –ö–∞–∫ –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        5. –ö–∞–∫–∏–µ –æ—à–∏–±–∫–∏ —Å—Ç–æ–∏—Ç –∏–∑–±–µ–≥–∞—Ç—å

        –û—Ç–≤–µ—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π.
        """

        try:
            response = self.client.chat.completions.create(
                model=self.model,
                messages=[
                    {"role": "system", "content": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å–æ–æ–±—â–µ—Å—Ç–≤–∞–º–∏ –∏ –≤–æ–≤–ª–µ—á–µ–Ω–∏—é —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤."},
                    {"role": "user", "content": prompt}
                ],
                max_tokens=1000,
                temperature=0.7
            )
            return response.choices[0].message.content
        except Exception as e:
            return f"–ò–∑–≤–∏–Ω–∏—Ç–µ, –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–æ–≤–µ—Ç–æ–≤: {str(e)}"

    def answer_general_question(self, question):
        """–û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –æ–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –æ —Å–∞–π—Ç–µ"""
        prompt = f"""
        –û—Ç–≤–µ—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ —Ñ–∞–Ω-–∫–ª—É–±–∞—Ö –∏ —Å–∞–π—Ç–µ fan-club.kz:

        –í–æ–ø—Ä–æ—Å: {question}

        –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å –ø–æ–ª–µ–∑–Ω—ã–π –∏ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –æ—Ç–≤–µ—Ç. –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –Ω–µ –ø–æ —Ç–µ–º–µ, –≤–µ–∂–ª–∏–≤–æ –æ–±—ä—è—Å–Ω–∏, —á—Ç–æ –º–æ–∂–µ—à—å –ø–æ–º–æ—á—å —Ç–æ–ª—å–∫–æ —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Å —Ñ–∞–Ω-–∫–ª—É–±–∞–º–∏ –∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞–º–∏.

        –û—Ç–≤–µ—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.
        """

        try:
            response = self.client.chat.completions.create(
                model=self.model,
                messages=[
                    {"role": "system", "content": "–¢—ã AI –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Å–∞–π—Ç–∞ fan-club.kz. –ü–æ–º–æ–≥–∞–µ—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –æ —Ñ–∞–Ω-–∫–ª—É–±–∞—Ö, —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤ –∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö. –ë—É–¥—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º –∏ –ø–æ–ª–µ–∑–Ω—ã–º."},
                    {"role": "user", "content": prompt}
                ],
                max_tokens=600,
                temperature=0.7
            )
            return response.choices[0].message.content
        except Exception as e:
            return f"–ò–∑–≤–∏–Ω–∏—Ç–µ, –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–æ–ø—Ä–æ—Å–∞: {str(e)}"

def main():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI –∞–≥–µ–Ω—Ç–∞"""
    agent = UnitySphereAIAgent()

    print("ü§ñ UnitySphere AI Agent - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ")
    print("=" * 50)

    # –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—É–±–∞
    print("\n1. –¢–µ—Å—Ç: –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—É–±–∞")
    advice = agent.get_club_creation_advice(
        "–∫–∏–±–µ—Ä—Å–ø–æ—Ä—Ç",
        "CS:GO, Dota 2, Valorant",
        "–æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –∏–≥—Ä–æ–∫–æ–≤, –æ—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä—ã, —Å–æ–∑–¥–∞—Ç—å –¥—Ä—É–∂–µ—Å–∫—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É"
    )
    print("–°–æ–≤–µ—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –∫–∏–±–µ—Ä—Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–≥–æ –∫–ª—É–±–∞:")
    print(advice)

    # –¢–µ—Å—Ç 2: –ò–¥–µ–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
    print("\n2. –¢–µ—Å—Ç: –ò–¥–µ–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π")
    ideas = agent.get_event_ideas(
        "–∫–∏–±–µ—Ä—Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∫–ª—É–±",
        "—Å—Ä–µ–¥–Ω–∏–π",
        "20-50 —á–µ–ª–æ–≤–µ–∫"
    )
    print("–ò–¥–µ–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π:")
    print(ideas)

    # –¢–µ—Å—Ç 3: –í–æ–≤–ª–µ—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
    print("\n3. –¢–µ—Å—Ç: –í–æ–≤–ª–µ—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞")
    tips = agent.get_community_engagement_tips(
        "–∫–∏–±–µ—Ä—Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∫–ª—É–±",
        "30"
    )
    print("–°–æ–≤–µ—Ç—ã –ø–æ –≤–æ–≤–ª–µ—á–µ–Ω–∏—é:")
    print(tips)

    print("\n‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")

if __name__ == "__main__":
    main()