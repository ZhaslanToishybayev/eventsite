#!/bin/bash

# ğŸ§ª ĞŸĞ¾Ğ»Ğ½Ğ¾Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ AI ĞºĞ¾Ğ½ÑÑƒĞ»ÑŒÑ‚Ğ°Ğ½Ñ‚Ğ° Ñ Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸ĞµĞ¼
echo "ğŸ§ª Ğ¢Ğ•Ğ¡Ğ¢Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ• Ğ¤Ğ˜ĞĞĞ›Ğ¬ĞĞĞ“Ğ Ğ¡ĞĞĞ‘Ğ©Ğ•ĞĞ˜Ğ¯ AI ĞšĞĞĞ¡Ğ£Ğ›Ğ¬Ğ¢ĞĞĞ¢Ğ"
echo "=================================================="

API_URL="http://localhost:8000/api/v1/ai/simplified/interactive/chat/"

send_request() {
    curl -s -X POST "$API_URL" \
        -H "Content-Type: application/json" \
        -d "{\"message\": \"$1\", \"user_email\": \"$2\", \"state_id\": $3}"
}

# Ğ¨Ğ°Ğ³ 1: ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ ĞºĞ»ÑƒĞ±Ğ°
echo "1. ĞĞ°Ñ‡Ğ¸Ğ½Ğ°ĞµĞ¼ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ĞºĞ»ÑƒĞ±Ğ°..."
create_response=$(send_request "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ»ÑƒĞ±" "test@fan-club.kz" "null")
state_id=$(echo "$create_response" | grep -o '"state_id":"[^"]*"' | cut -d'"' -f4)
echo "   State ID: $state_id"

# Ğ¨Ğ°Ğ³ 2: Ğ’Ğ²Ğ¾Ğ´ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ
echo ""
echo "2. Ğ’Ğ²Ğ¾Ğ´Ğ¸Ğ¼ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ..."
name_response=$(send_request "Ğ‘Ğ°ÑĞºĞµÑ‚Ğ±Ğ¾Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ»ÑƒĞ± ĞĞ»Ğ¼Ğ°Ñ‚Ñ‹" "test@fan-club.kz" "\"$state_id\"")

# Ğ¨Ğ°Ğ³ 3: Ğ’Ğ²Ğ¾Ğ´ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ (Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ¾Ğµ)
echo ""
echo "3. Ğ’Ğ²Ğ¾Ğ´Ğ¸Ğ¼ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ..."
desc_response=$(send_request "Ğ‘Ğ°ÑĞºĞµÑ‚Ğ±Ğ¾Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ»ÑƒĞ± ĞĞ»Ğ¼Ğ°Ñ‚Ñ‹ - ÑÑ‚Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ»Ñ Ğ»ÑĞ±Ğ¸Ñ‚ĞµĞ»ĞµĞ¹ Ğ±Ğ°ÑĞºĞµÑ‚Ğ±Ğ¾Ğ»Ğ° Ğ²ÑĞµÑ… Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚Ğ¾Ğ² Ğ¸ ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹ Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ¸. ĞœÑ‹ Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·ÑƒĞµĞ¼ Ñ€ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ñ‹Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸, Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¸Ñ‰ĞµÑĞºĞ¸Ğµ Ğ¼Ğ°Ñ‚Ñ‡Ğ¸, Ñ‚ÑƒÑ€Ğ½Ğ¸Ñ€Ñ‹ Ğ¸ ÑĞ¾Ñ€ĞµĞ²Ğ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ. ĞšĞ»ÑƒĞ± Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ Ğ´Ğ»Ñ ÑˆĞºĞ¾Ğ»ÑŒĞ½Ğ¸ĞºĞ¾Ğ², ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¸ Ğ²Ğ·Ñ€Ğ¾ÑĞ»Ñ‹Ñ…. ĞĞ°ÑˆĞ° Ñ†ĞµĞ»ÑŒ - Ñ€Ğ°Ğ·Ğ²Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ±Ğ°ÑĞºĞµÑ‚Ğ±Ğ¾Ğ»ÑŒĞ½ÑƒÑ ĞºÑƒĞ»ÑŒÑ‚ÑƒÑ€Ñƒ Ğ² Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğµ, Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞ°Ñ‚ÑŒ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ¸Ğ³Ñ€Ñ‹ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ² Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ´Ñ€ÑƒĞ¶ĞµÑĞºÑƒÑ Ğ°Ñ‚Ğ¼Ğ¾ÑÑ„ĞµÑ€Ñƒ. ĞœÑ‹ Ğ¿Ñ€Ğ¾Ğ²Ğ¾Ğ´Ğ¸Ğ¼ Ğ¼Ğ°ÑÑ‚ĞµÑ€-ĞºĞ»Ğ°ÑÑÑ‹ Ñ Ğ¿Ñ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ñ‚Ñ€ĞµĞ½ĞµÑ€Ğ°Ğ¼Ğ¸, ÑƒÑ‡Ğ°ÑÑ‚Ğ²ÑƒĞµĞ¼ Ğ² Ğ³Ğ¾Ñ€Ğ¾Ğ´ÑĞºĞ¸Ñ… ÑĞ¾Ñ€ĞµĞ²Ğ½Ğ¾Ğ²Ğ°Ğ½Ğ¸ÑÑ… Ğ¸ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ· Ğ¶Ğ¸Ğ·Ğ½Ğ¸ Ñ‡ĞµÑ€ĞµĞ· ÑĞ¿Ğ¾Ñ€Ñ‚." "test@fan-club.kz" "\"$state_id\"")

# Ğ¨Ğ°Ğ³ 4: Ğ’Ğ²Ğ¾Ğ´ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
echo ""
echo "4. Ğ’Ğ²Ğ¾Ğ´Ğ¸Ğ¼ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ..."
cat_response=$(send_request "Ğ¡Ğ¿Ğ¾Ñ€Ñ‚" "test@fan-club.kz" "\"$state_id\"")

# Ğ¨Ğ°Ğ³ 5: Ğ’Ğ²Ğ¾Ğ´ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ°
echo ""
echo "5. Ğ’Ğ²Ğ¾Ğ´Ğ¸Ğ¼ Ğ³Ğ¾Ñ€Ğ¾Ğ´..."
city_response=$(send_request "ĞĞ»Ğ¼Ğ°Ñ‚Ñ‹" "test@fan-club.kz" "\"$state_id\"")

# Ğ¨Ğ°Ğ³ 6: Ğ’Ğ²Ğ¾Ğ´ email
echo ""
echo "6. Ğ’Ğ²Ğ¾Ğ´Ğ¸Ğ¼ email..."
email_response=$(send_request "basket@almaty.kz" "test@fan-club.kz" "\"$state_id\"")

# Ğ¨Ğ°Ğ³ 7: Ğ’Ğ²Ğ¾Ğ´ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ°
echo ""
echo "7. Ğ’Ğ²Ğ¾Ğ´Ğ¸Ğ¼ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½..."
phone_response=$(send_request "+77015556677" "test@fan-club.kz" "\"$state_id\"")

# Ğ¨Ğ°Ğ³ 8: Ğ’Ğ²Ğ¾Ğ´ Ğ°Ğ´Ñ€ĞµÑĞ° (Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹)
echo ""
echo "8. Ğ’Ğ²Ğ¾Ğ´Ğ¸Ğ¼ Ğ°Ğ´Ñ€ĞµÑ (Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑˆĞ°Ğ³)..."
final_response=$(send_request "Ğ¡Ğ¿Ğ¾Ñ€Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑ, ÑƒĞ». Ğ‘Ğ¾ĞºĞµĞ¹Ñ…Ğ°Ğ½Ğ¾Ğ²Ğ° 87" "test@fan-club.kz" "\"$state_id\"")

echo ""
echo "ğŸ“ Ğ¤Ğ˜ĞĞĞ›Ğ¬ĞĞĞ• Ğ¡ĞĞĞ‘Ğ©Ğ•ĞĞ˜Ğ•:"
echo "========================"
echo "$final_response" | python3 -c "import sys, json; print(json.load(sys.stdin)['message'])" 2>/dev/null || echo "$final_response"

echo ""
echo "ğŸ” ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ‘ĞĞ—Ğ« Ğ”ĞĞĞĞ«Ğ¥:"
echo "========================="
db_check=$(source venv/bin/activate && python manage.py shell << 'EOF'
from clubs.models import Club
clubs = Club.objects.filter(name__icontains='Ğ‘Ğ°ÑĞºĞµÑ‚Ğ±Ğ¾Ğ»ÑŒĞ½Ñ‹Ğ¹').order_by('-created_at')[:1]
if clubs:
    club = clubs[0]
    print(f"âœ… ĞšĞ›Ğ£Ğ‘ Ğ¡ĞĞ—Ğ”ĞĞ:")
    print(f"   ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ: {club.name}")
    print(f"   ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ: {club.category.name}")
    print(f"   Ğ“Ğ¾Ñ€Ğ¾Ğ´: {club.city.name}")
    print(f"   Email: {club.email}")
    print(f"   Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½: {club.phone}")
    print(f"   ĞĞ´Ñ€ĞµÑ: {club.address}")
else:
    print("âŒ ĞšĞ›Ğ£Ğ‘ ĞĞ• Ğ¡ĞĞ—Ğ”ĞĞ")
EOF
)

echo "$db_check"

echo ""
echo "ğŸ Ğ¢Ğ•Ğ¡Ğ¢Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ• Ğ—ĞĞ’Ğ•Ğ Ğ¨Ğ•ĞĞ!"
echo "=================================================="