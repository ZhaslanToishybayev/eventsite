#!/bin/bash

# Simple Setup Script for UnitySphere (fan-club.kz) - Ð±ÐµÐ· sudo

echo "ðŸš€ ÐÐ°Ñ‡Ð¸Ð½Ð°ÐµÐ¼ ÑƒÐ¿Ñ€Ð¾Ñ‰ÐµÐ½Ð½ÑƒÑŽ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÑƒ..."

# 1. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
echo "ðŸ Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ..."
python3 -m venv venv

# 2. ÐÐºÑ‚Ð¸Ð²Ð°Ñ†Ð¸Ñ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
source venv/bin/activate

# 3. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
echo "ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸..."
pip install --upgrade pip
pip install -r requirements.txt
pip install -r requirements.production.txt

# 4. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ .env Ñ„Ð°Ð¹Ð»Ð° Ð´Ð»Ñ development
echo "âš™ï¸ Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ .env Ñ„Ð°Ð¹Ð» Ð´Ð»Ñ development..."
cat > .env <<EOF
# Django Settings
DJANGO_SECRET_KEY='development-secret-key-not-for-production'
DEBUG=True

# Database Settings (SQLite Ð´Ð»Ñ development)
DB_NAME=db.sqlite3

# AI Settings
OPENAI_API_KEY=your-openai-api-key-here
SERENA_ENABLED=True
SERENA_URL=http://localhost:8001
SERENA_TIMEOUT=30
AI_CONSULTANT_ENABLED=True

# Email Settings (development)
EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend

# Google OAuth (development)
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# Anthropic AI
ANTHROPIC_API_KEY=sk-your-anthropic-key

# Redis (ÐµÑÐ»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ)
REDIS_HOST=localhost
REDIS_PORT=6379
EOF

# 5. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Django
echo "âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Django..."
python manage.py check

# 6. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¸ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹
echo "ðŸ—„ï¸ Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸..."
python manage.py makemigrations
python manage.py migrate

# 7. Ð¡Ð±Ð¾Ñ€ÐºÐ° ÑÑ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
echo "ðŸ“ Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ static Ñ„Ð°Ð¹Ð»Ñ‹..."
python manage.py collectstatic --noinput

# 8. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÑƒÐ¿ÐµÑ€Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ (Ð¸Ð½Ñ‚ÐµÑ€Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾)
echo "ðŸ‘¤ Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑÑƒÐ¿ÐµÑ€Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ..."
echo "Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ: python manage.py createsuperuser"
echo "Ð˜Ð»Ð¸: source venv/bin/activate && python manage.py createsuperuser"

echo ""
echo "âœ… Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°!"
echo ""
echo "ðŸ“‹ Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑˆÐ°Ð³Ð¸:"
echo "1. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ÑÐµÑ€Ð²ÐµÑ€: python manage.py runserver 0.0.0.0:8000"
echo "2. Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ ÑÑƒÐ¿ÐµÑ€Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ: python manage.py createsuperuser"
echo "3. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Nginx ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ"
echo "4. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð˜Ð˜-ÑÐµÑ€Ð²ÐµÑ€Ñ‹"
echo ""
echo "ðŸŒ Ð¡Ð°Ð¹Ñ‚ Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð¿Ð¾:"
echo "   - Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾: http://localhost:8000"
echo "   - ÐŸÐ¾ IP: http://77.243.80.110:8000"
echo "   - Ð”Ð¾Ð¼ÐµÐ½: http://fan-club.kz:8000 (ÐµÑÐ»Ð¸ DNS Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½)"