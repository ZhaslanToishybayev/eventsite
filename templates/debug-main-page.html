<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã</title>
    <link rel="stylesheet" href="/static/css/ai-chat-widget-v2.css?v=2.4.8">
    <style>
        .debug-panel {
            position: fixed;
            top: 10px;
            left: 10px;
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            z-index: 99999;
            max-width: 400px;
            max-height: 300px;
            overflow-y: auto;
        }
        .debug-panel .error { color: #f00; }
        .debug-panel .success { color: #0f0; }
        .debug-panel .info { color: #ff0; }
        .debug-panel button {
            background: #333;
            color: #fff;
            border: 1px solid #666;
            padding: 5px 10px;
            margin: 2px;
            cursor: pointer;
            border-radius: 3px;
        }
    </style>
</head>
<body style="background: #333; color: #fff; padding: 50px;">
    <div class="debug-panel">
        <h3>üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ì–õ–ê–í–ù–û–ô –°–¢–†–ê–ù–ò–¶–´</h3>
        <div id="debug-output"></div>
        <button onclick="checkWidget()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∏–¥–∂–µ—Ç</button>
        <button onclick="forceInit()">üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è</button>
        <button onclick="toggleWidget()">üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤–∏–¥–∂–µ—Ç</button>
        <button onclick="clearDebug()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    </div>

    <div style="text-align: center; margin-top: 50px;">
        <h1>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã AI –≤–∏–¥–∂–µ—Ç–∞</h1>
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–º–∏—Ç–∏—Ä—É–µ—Ç –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π</p>
        <p>–ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤—ã —É–≤–∏–¥–∏—Ç–µ –∫–Ω–æ–ø–∫—É –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É</p>
    </div>

    <script src="/static/js/ai-chat-widget-v2.js?v=2.4.9"></script>

    <script>
        const debugOutput = document.getElementById('debug-output');

        function log(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `${time}: ${message}`;
            debugOutput.appendChild(div);
            debugOutput.scrollTop = debugOutput.scrollHeight;
            console.log(`[DEBUG ${time}] ${message}`);
        }

        function checkWidget() {
            log('=== –ù–ê–ß–ê–õ–û –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò ===', 'info');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∫–ª–∞—Å—Å–æ–≤
            log(`1. AIChatWidgetV2 –∫–ª–∞—Å—Å: ${typeof AIChatWidgetV2}`, typeof AIChatWidgetV2 === 'function' ? 'success' : 'error');
            log(`2. initAIChatWidgetV2 —Ñ—É–Ω–∫—Ü–∏—è: ${typeof initAIChatWidgetV2}`, typeof initAIChatWidgetV2 === 'function' ? 'success' : 'error');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
            log(`3. window.aiChatWidgetV2: ${typeof window.aiChatWidgetV2}`, typeof window.aiChatWidgetV2 === 'object' ? 'success' : 'error');
            log(`4. window.aiChatWidget: ${typeof window.aiChatWidget}`, typeof window.aiChatWidget === 'object' ? 'success' : 'error');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç—ã
            const widget = document.getElementById('ai-chat-widget');
            const button = document.getElementById('chatToggleBtn');

            log(`5. –≠–ª–µ–º–µ–Ω—Ç #ai-chat-widget: ${!!widget}`, widget ? 'success' : 'error');
            log(`6. –ö–Ω–æ–ø–∫–∞ #chatToggleBtn: ${!!button}`, button ? 'success' : 'error');

            if (widget) {
                log(`7. CSS –∫–ª–∞—Å—Å—ã –≤–∏–¥–∂–µ—Ç–∞: ${widget.className}`, 'info');
                log(`8. –°—Ç–∏–ª–∏ –≤–∏–¥–∂–µ—Ç–∞: display=${widget.style.display}`, 'info');
            }

            if (button) {
                log(`9. CSS –∫–ª–∞—Å—Å—ã –∫–Ω–æ–ø–∫–∏: ${button.className}`, 'info');
                log(`10. –°—Ç–∏–ª–∏ –∫–Ω–æ–ø–∫–∏: display=${button.style.display}`, 'info');
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            if (window.aiChatWidgetV2) {
                log(`11. –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞: isOpen=${window.aiChatWidgetV2.isOpen}, isMinimized=${window.aiChatWidgetV2.isMinimized}`, 'info');
                log(`12. –¢–µ–∫—É—â–∞—è —Ç–µ–º–∞: ${window.aiChatWidgetV2.currentTheme}`, 'info');
                log(`13. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π: ${window.aiChatWidgetV2.messages.length}`, 'info');
            }

            log('=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê ===', 'success');
        }

        function forceInit() {
            log('üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...', 'info');
            try {
                const widget = initAIChatWidgetV2();
                if (widget) {
                    log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!', 'success');
                    setTimeout(checkWidget, 1000);
                } else {
                    log('‚ùå –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å!', 'error');
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        }

        function toggleWidget() {
            log('üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞...', 'info');
            if (window.aiChatWidgetV2 && typeof window.aiChatWidgetV2.toggleChat === 'function') {
                try {
                    window.aiChatWidgetV2.toggleChat();
                    log('‚úÖ –í–∏–¥–∂–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω!', 'success');
                    setTimeout(checkWidget, 500);
                } catch (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
                }
            } else {
                log('‚ùå –ú–µ—Ç–æ–¥ toggleChat –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            }
        }

        function clearDebug() {
            debugOutput.innerHTML = '';
            log('–õ–æ–≥ –æ—á–∏—â–µ–Ω', 'info');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            log('üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã...', 'info');
            checkWidget();
        }, 3000);

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –æ—à–∏–±–∫–∏
        window.addEventListener('error', function(e) {
            log(`JavaScript –æ—à–∏–±–∫–∞: ${e.message} –≤ ${e.filename}:${e.lineno}`, 'error');
        });

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º console –æ—à–∏–±–∫–∏
        const originalError = console.error;
        console.error = function(...args) {
            log(`Console.error: ${args.join(' ')}`, 'error');
            originalError.apply(console, args);
        };

        // –ù–∞—á–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        log('üîç –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É...', 'info');
    </script>
</body>
</html>