{% extends 'base.html' %}

{% block title %}–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ AI –í–∏–¥–∂–µ—Ç–∞{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-12">
            <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ AI –ß–∞—Ç-–í–∏–¥–∂–µ—Ç–∞</h1>
            <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–º–æ–∂–µ—Ç –≤—ã—è–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å AI –≤–∏–¥–∂–µ—Ç–æ–º.</p>

            <div class="alert alert-info">
                <h5>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</h5>
                <ol>
                    <li>–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12 ‚Üí Console)</li>
                    <li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–∂–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É –≤–∏–¥–∂–µ—Ç–∞</li>
                    <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏</li>
                    <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –Ω–∏–∂–µ</li>
                </ol>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5>üîß –¢–µ—Å—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</h5>
                </div>
                <div class="card-body">
                    <button class="btn btn-primary" onclick="checkWidgetElements()">1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã</button>
                    <button class="btn btn-secondary" onclick="checkWidgetJS()">2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JavaScript</button>
                    <button class="btn btn-info" onclick="checkWidgetStyles()">3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∏–ª–∏</button>
                    <button class="btn btn-warning" onclick="openWidgetManually()">4. –û—Ç–∫—Ä—ã—Ç—å –≤—Ä—É—á–Ω—É—é</button>
                    <button class="btn btn-danger" onclick="testAPI()">5. –¢–µ—Å—Ç API</button>
                </div>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ -->
            <div class="card">
                <div class="card-header">
                    <h5>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</h5>
                </div>
                <div class="card-body">
                    <div id="diagnosis-results" style="font-family: monospace; background: #f8f9fa; padding: 15px; border-radius: 5px;">
                        <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –≤—ã—à–µ...</p>
                    </div>
                </div>
            </div>

            <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            <div class="mt-4">
                <div class="alert alert-warning">
                    <h6>üö® –ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è:</h6>
                    <ul>
                        <li><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞</strong> - F12 ‚Üí Console</li>
                        <li><strong>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</strong> - Ctrl+F5</li>
                        <li><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ JavaScript</strong> - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω</li>
                        <li><strong>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä</strong> - Chrome, Firefox, Safari</li>
                    </ul>
                </div>

                <a href="/" class="btn btn-primary">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                <a href="/clubs/" class="btn btn-secondary">–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–ª—É–±–æ–≤ ‚Üí</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// –§—É–Ω–∫—Ü–∏–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –≤–∏–¥–∂–µ—Ç–∞
function checkWidgetElements() {
    const results = [];
    results.push('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ HTML —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–∏–¥–∂–µ—Ç–∞:');
    results.push('=====================================');

    const elements = [
        { id: 'chatContainer', name: '–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–∞—Ç–∞' },
        { id: 'chatToggleBtn', name: '–ö–Ω–æ–ø–∫–∞ –≤–∏–¥–∂–µ—Ç–∞' },
        { id: 'chatMessages', name: '–û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π' },
        { id: 'chatInput', name: '–ü–æ–ª–µ –≤–≤–æ–¥–∞' },
        { id: 'chatSendBtn', name: '–ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏' }
    ];

    elements.forEach(el => {
        const element = document.getElementById(el.id);
        if (element) {
            const styles = window.getComputedStyle(element);
            results.push(`‚úÖ ${el.name} (${el.id}): –ù–∞–π–¥–µ–Ω`);
            results.push(`   - display: ${styles.display}`);
            results.push(`   - visibility: ${styles.visibility}`);
            results.push(`   - position: ${styles.position}`);
            if (el.id === 'chatToggleBtn') {
                results.push(`   - onclick: ${element.onclick ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'}`);
                results.push(`   - classList: ${element.className}`);
            }
        } else {
            results.push(`‚ùå ${el.name} (${el.id}): –ù–µ –Ω–∞–π–¥–µ–Ω`);
        }
        results.push('');
    });

    showResults(results.join('\n'));
    console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:', results);
}

function checkWidgetJS() {
    const results = [];
    results.push('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ JavaScript –≤–∏–¥–∂–µ—Ç–∞:');
    results.push('==================================');

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    results.push('–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:');
    results.push(`- window.AIChatWidget: ${window.AIChatWidget ? '‚úÖ –Ω–∞–π–¥–µ–Ω' : '‚ùå –Ω–µ –Ω–∞–π–¥–µ–Ω'}`);
    results.push(`- window.aiChatWidget: ${window.aiChatWidget ? '‚úÖ –Ω–∞–π–¥–µ–Ω' : '‚ùå –Ω–µ –Ω–∞–π–¥–µ–Ω'}`);
    results.push(`- window.aiChatWidgetV2: ${window.aiChatWidgetV2 ? '‚úÖ –Ω–∞–π–¥–µ–Ω' : '‚ùå –Ω–µ –Ω–∞–π–¥–µ–Ω'}`);
    results.push('');

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏
    results.push('–§—É–Ω–∫—Ü–∏–∏:');
    results.push(`- checkWidgetElements: ${typeof checkWidgetElements === 'function' ? '‚úÖ –Ω–∞–π–¥–µ–Ω–∞' : '‚ùå –Ω–µ –Ω–∞–π–¥–µ–Ω–∞'}`);
    results.push(`- checkWidgetJS: ${typeof checkWidgetJS === 'function' ? '‚úÖ –Ω–∞–π–¥–µ–Ω–∞' : '‚ùå –Ω–µ –Ω–∞–π–¥–µ–Ω–∞'}`);
    results.push('');

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤
    const scripts = document.getElementsByTagName('script');
    results.push('–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:');
    for (let script of scripts) {
        if (script.src && script.src.includes('ai-chat-widget')) {
            results.push(`‚úÖ ${script.src}`);
        }
    }
    results.push('');

    showResults(results.join('\n'));
    console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ JavaScript:', results);
}

function checkWidgetStyles() {
    const results = [];
    results.push('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ CSS —Å—Ç–∏–ª–µ–π –≤–∏–¥–∂–µ—Ç–∞:');
    results.push('==================================');

    const button = document.getElementById('chatToggleBtn');
    if (button) {
        const styles = window.getComputedStyle(button);
        results.push('–°—Ç–∏–ª–∏ –∫–Ω–æ–ø–∫–∏ –≤–∏–¥–∂–µ—Ç–∞:');
        results.push(`- position: ${styles.position}`);
        results.push(`- bottom: ${styles.bottom}`);
        results.push(`- right: ${styles.right}`);
        results.push(`- width: ${styles.width}`);
        results.push(`- height: ${styles.height}`);
        results.push(`- background: ${styles.background}`);
        results.push(`- z-index: ${styles.zIndex}`);
        results.push(`- display: ${styles.display}`);
        results.push(`- visibility: ${styles.visibility}`);
    } else {
        results.push('‚ùå –ö–Ω–æ–ø–∫–∞ –≤–∏–¥–∂–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
    }

    const container = document.getElementById('chatContainer');
    if (container) {
        const containerStyles = window.getComputedStyle(container);
        results.push('');
        results.push('–°—Ç–∏–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤–∏–¥–∂–µ—Ç–∞:');
        results.push(`- display: ${containerStyles.display}`);
        results.push(`- position: ${containerStyles.position}`);
        results.push(`- z-index: ${containerStyles.zIndex}`);
    }

    showResults(results.join('\n'));
    console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∏–ª–µ–π:', results);
}

function openWidgetManually() {
    const results = [];
    results.push('üîç –ü–æ–ø—ã—Ç–∫–∞ —Ä—É—á–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –≤–∏–¥–∂–µ—Ç–∞:');
    results.push('======================================');

    const button = document.getElementById('chatToggleBtn');
    if (button) {
        results.push('‚úÖ –ö–Ω–æ–ø–∫–∞ –Ω–∞–π–¥–µ–Ω–∞, –∏–º–∏—Ç–∏—Ä—É–µ–º –∫–ª–∏–∫...');

        // –ò–º–∏—Ç–∏—Ä—É–µ–º –∫–ª–∏–∫
        button.click();

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
        setTimeout(() => {
            const container = document.getElementById('chatContainer');
            if (container) {
                const styles = window.getComputedStyle(container);
                results.push(`- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: display=${styles.display}`);
                if (styles.display !== 'none') {
                    results.push('‚úÖ –í–∏–¥–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç!');
                } else {
                    results.push('‚ùå –í–∏–¥–∂–µ—Ç –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è');
                }
            }
            showResults(results.join('\n'));
        }, 1000);
    } else {
        results.push('‚ùå –ö–Ω–æ–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        showResults(results.join('\n'));
    }

    console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä—É—á–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è:', results);
}

function testAPI() {
    const results = [];
    results.push('üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI API:');
    results.push('==========================');

    results.push('–û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞...');

    fetch('/api/v1/ai/simplified/interactive/chat/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            message: '–ü—Ä–∏–≤–µ—Ç',
            user_email: 'test@fan-club.kz',
            state_id: null
        })
    })
    .then(response => {
        results.push(`‚úÖ API –æ—Ç–≤–µ—Ç–∏–ª: ${response.status}`);
        return response.json();
    })
    .then(data => {
        results.push(`‚úÖ AI –æ—Ç–≤–µ—Ç–∏–ª: "${data.message.substring(0, 50)}..."`);
        results.push('‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ');
        showResults(results.join('\n'));
    })
    .catch(error => {
        results.push(`‚ùå –û—à–∏–±–∫–∞ API: ${error.message}`);
        showResults(results.join('\n'));
    });

    console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API:', results);
}

function showResults(results) {
    const resultsDiv = document.getElementById('diagnosis-results');
    resultsDiv.textContent = results;

    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
    resultsDiv.scrollTop = resultsDiv.scrollHeight;
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
    console.log('üîç –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    console.log('üí° –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π');

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ AI –≤–∏–¥–∂–µ—Ç
    setTimeout(() => {
        if (document.getElementById('chatContainer')) {
            console.log('‚úÖ AI –≤–∏–¥–∂–µ—Ç –Ω–∞–π–¥–µ–Ω –≤ DOM');
        } else {
            console.log('‚ùå AI –≤–∏–¥–∂–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ DOM');
        }
    }, 1000);
});
</script>
{% endblock %}