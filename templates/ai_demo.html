{% extends 'base.html' %}
{% load static %}

{% block title %}AI –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/ai-chat-widget-v2.css' %}?v=2.5.5">
<style>
.demo-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 40px 0;
    margin: 40px 0;
    border-radius: 20px;
    text-align: center;
}

.demo-content {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 20px;
}

.demo-commands {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    padding: 20px;
    margin: 20px 0;
    backdrop-filter: blur(10px);
}

.command-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
    cursor: pointer;
    transition: all 0.3s ease;
}

.command-item:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
}

.command-example {
    font-family: 'Courier New', monospace;
    background: rgba(0, 0, 0, 0.2);
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 14px;
}

.info-box {
    background: #f8f9fa;
    border-left: 4px solid #667eea;
    padding: 20px;
    margin: 20px 0;
    border-radius: 8px;
    color: #333;
}

.response-area {
    background: #2d3748;
    color: #e2e8f0;
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
    min-height: 100px;
    font-family: 'Courier New', monospace;
}

.response-text {
    line-height: 1.6;
}
</style>
{% endblock %}

{% block content %}
<div class="demo-section">
    <div class="demo-content">
        <h1>ü§ñ AI –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è</h1>
        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–º–Ω–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã "–¶–ï–ù–¢–† –°–û–ë–´–¢–ò–ô"</p>

        <div class="demo-commands">
            <h3>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã:</h3>
            <div class="command-item" onclick="sendTestMessage('–ü—Ä–∏–≤–µ—Ç! –ü–æ–º–æ–≥–∏ —Å–æ–∑–¥–∞—Ç—å –∫–ª—É–±')">
                <h4>üèóÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—É–±–∞</h4>
                <p>–ü–æ–º–æ—â—å –≤ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</p>
                <div class="command-example">"–ü—Ä–∏–≤–µ—Ç! –ü–æ–º–æ–≥–∏ —Å–æ–∑–¥–∞—Ç—å –∫–ª—É–±"</div>
            </div>

            <div class="command-item" onclick="sendTestMessage('–ù–∞–π–¥–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∫–ª—É–±—ã')">
                <h4>üîç –ü–æ–∏—Å–∫ –∫–ª—É–±–æ–≤</h4>
                <p>–ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ–æ–±—â–µ—Å—Ç–≤</p>
                <div class="command-example">"–ù–∞–π–¥–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∫–ª—É–±—ã"</div>
            </div>

            <div class="command-item" onclick="sendTestMessage('–ö–∞–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã?')">
                <h4>üìä –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</h4>
                <p>–£–∑–Ω–∞—Ç—å –æ —Ñ—É–Ω–∫—Ü–∏—è—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</p>
                <div class="command-example">"–ö–∞–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã?"</div>
            </div>

            <div class="command-item" onclick="sendTestMessage('–ü–æ–º–æ—â—å')">
                <h4>üí¨ –ü–æ–º–æ—â—å</h4>
                <p>–û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ –ø–æ–º–æ—â—å</p>
                <div class="command-example">"–ü–æ–º–æ—â—å"</div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-lg-6">
            <div class="info-box">
                <h4>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∏–¥–∂–µ—Ç–µ:</h4>
                <ul>
                    <li>AI –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ fallback —Ä–µ–∂–∏–º–µ</li>
                    <li>Rate limiting: 30 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ IP</li>
                    <li>–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π</li>
                    <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏</li>
                </ul>
            </div>

            <div class="info-box">
                <h4>üîß –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:</h4>
                <ul>
                    <li>–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—É–±–æ–≤ (–ø–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏)</li>
                    <li>–ü–æ–∏—Å–∫ —Å–æ–æ–±—â–µ—Å—Ç–≤ –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º</li>
                    <li>–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é</li>
                    <li>–ü–æ–º–æ—â—å —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</li>
                </ul>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="info-box">
                <h4>‚ö° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API:</h4>
                <div class="command-example">
                    <h5>–ü—Ä—è–º–æ–π API –∑–∞–ø—Ä–æ—Å:</h5>
                    <code>
                        POST http://localhost:8002/api/v1/ai/chat/<br>
                        {"message": "–ü–æ–º–æ–≥–∏ —Å–æ–∑–¥–∞—Ç—å –∫–ª—É–±"}
                    </code>
                </div>

                <div class="mt-3">
                    <h5>–°—Ç–∞—Ç—É—Å:</h5>
                    <p>
                        <span class="badge badge-success">API —Ä–∞–±–æ—Ç–∞–µ—Ç</span>
                        <span class="badge badge-info">Rate limiting –∞–∫—Ç–∏–≤–µ–Ω</span>
                        <span class="badge badge-warning">Fallback —Ä–µ–∂–∏–º</span>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{% static 'js/ai-chat-widget-v2.js' %}?v=2.5.2"></script>

<script>
// –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
function sendTestMessage(message) {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –≤–∏–¥–∂–µ—Ç
    if (window.aiChatWidgetV2 && window.aiChatWidgetV2.sendMessage) {
        window.aiChatWidgetV2.sendMessage(message);
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–∂–µ—Ç –µ—Å–ª–∏ —Å–∫—Ä—ã—Ç
        if (window.aiChatWidgetV2.openChat) {
            window.aiChatWidgetV2.openChat();
        }
    } else {
        // Fallback: –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ fetch
        fetch('/api/v1/ai/chat/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                'message': message
            })
        })
        .then(response => response.json())
        .then(data => {
            showResponse(data.response || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞');
        })
        .catch(error => {
            showResponse('–û—à–∏–±–∫–∞: ' + error.message);
        });
    }
}

function showResponse(response) {
    // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –æ–±–ª–∞—Å—Ç—å –æ—Ç–≤–µ—Ç–∞
    let responseArea = document.querySelector('.response-area');
    if (!responseArea) {
        responseArea = document.createElement('div');
        responseArea.className = 'response-area';
        document.querySelector('.demo-section .demo-content').appendChild(responseArea);
    }

    responseArea.innerHTML = '<h4>–û—Ç–≤–µ—Ç AI:</h4><div class="response-text">' + response + '</div>';

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–ª–∞—Å—Ç—å –æ—Ç–≤–µ—Ç–∞
    responseArea.style.display = 'block';
    responseArea.scrollIntoView({ behavior: 'smooth' });
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    console.log('AI Demo page loaded');

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤–∏–¥–∂–µ—Ç–∞
    setTimeout(() => {
        const widget = document.getElementById('ai-chat-widget');
        console.log('AI Widget found:', !!widget);

        if (!widget) {
            console.warn('AI Widget not found, trying to initialize...');
            if (typeof initAIChatWidgetV2 === 'function') {
                initAIChatWidgetV2();
            }
        }
    }, 1000);
});
</script>
{% endblock %}